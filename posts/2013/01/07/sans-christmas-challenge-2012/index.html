<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="../../../../../theme/css/style.min.css">
  <link rel="stylesheet" type="text/css" href="../../../../../theme/css/pygments.min.css">
  <link rel="stylesheet" type="text/css" href="../../../../../theme/css/font-awesome.min.css">
  <link href="../../../../..//extras/style.css" rel="stylesheet">
  <link href="https://allyourbase.utouch.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="All Your Base Are Belong To Me Atom">
  <link rel="shortcut icon" href="/extras/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/extras/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />
<meta name="author" content="useless" />
<meta name="description" content="During December, SANS posted a Christmas challenge based on a Christmas story. This year, Santa is sad because he feels that nobody believes in him anymore, so he decides to cancel Christmas. Mrs. Claus wants to cheer her husband up, in order not to let children down, but her reindeer ..." />
<meta name="keywords" content="">
<meta property="og:site_name" content="All Your Base Are Belong To Me"/>
<meta property="og:title" content="SANS Christmas Challenge 2012"/>
<meta property="og:description" content="During December, SANS posted a Christmas challenge based on a Christmas story. This year, Santa is sad because he feels that nobody believes in him anymore, so he decides to cancel Christmas. Mrs. Claus wants to cheer her husband up, in order not to let children down, but her reindeer ..."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="../../../../../posts/2013/01/07/sans-christmas-challenge-2012/"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2013-01-07 12:20:00+01:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="../../../../../author/useless.html">
<meta property="article:section" content="Write-up"/>
<meta property="og:image" content="/images/useless_profile_pic.jpg">  <title>All Your Base Are Belong To Me &ndash; SANS Christmas Challenge 2012</title>
</head>
<body>
  <aside>
    <div>
      <a href="../../../../..">
        <img src="/images/useless_profile_pic.jpg" alt="All Your Base Are Belong To Me" title="All Your Base Are Belong To Me">
      </a>
      <h1><a href="../../../../..">All Your Base Are Belong To Me</a></h1>
      <p>You know, if that's alright with you</p>
      <nav>
        <ul class="list">
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-envelope-o" href="mailto:yannick at meheut dot org" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
        <li><a class="sc-github" href="https://github.com/the-useless-one/" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-rss" href="https://allyourbase.utouch.fr/feeds/all.atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>
    <nav>
      <a href="../../../../..">Home</a>
      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="https://allyourbase.utouch.fr/feeds/all.atom.xml">Atom</a>
    </nav>

<article>
  <header>
    <h1 id="sans-christmas-challenge-2012">SANS Christmas Challenge 2012</h1>
    <p>Posted on lun. 07 janvier 2013 in <a href="../../../../../category/write-up.html">Write-up</a></p>
  </header>
  <div>
    <img alt="sans_christmas_challenge_2012_logo.jpg" class="align-center" src="/images/sans-christmas-challenge-2012/sans_christmas_challenge_2012_logo.jpg" />
<p>During December, SANS posted a <a class="reference external" href="http://pen-testing.sans.org/holiday-challenge/2012">Christmas
challenge</a> based
on a Christmas story.</p>
<p>This year, Santa is sad because he feels that nobody believes in him
anymore, so he decides to cancel Christmas. Mrs. Claus wants to cheer
her husband up, in order not to let children down, but her reindeer gets
imprisoned in Southtown's dog pound. The mayor accepts to let Vixen, the
reindeer, go if Mrs. Claus can make it snow in Southtown, which is a
relatively hot region.</p>
<p>So Mrs. Claus goes to see Snow Miser, who is in charge of the cold
weather. Unfortunately, he refuses to make it snow in Southtown, because
it's in his brother's, Heat Miser, territory. But Heat Miser agrees to
make it snow in Southtown as long as he's allowed to melt the North
Pole. Unfortunately, the brothers are too stubborn, and refuse to let
each other have control over the other's territory. So Mrs. Claus takes
it to a higher authority: Mother Nature, who forces the brothers to
cooperate.</p>
<p>Since they have to collaborate, Snow Miser and Heat Miser decide to
have a little fun and make it a competition: they both have to hack
every level of the other brother's weather control. You can follow
<a class="reference external" href="https://twitter.com/sn0w_m1s3r">&#64;sn0w_m1s3r</a> and
<a class="reference external" href="https://twitter.com/h34t_m1s3r">&#64;h34t_m1s3r</a> on Twitter.</p>
<p>To make things interesting, SANS posted six questions, and will
reward the best answers:</p>
<ol class="arabic simple">
<li>Where did you find the remainder of Snow Miser's Zone 1 URL?</li>
<li>What is the key you used with steghide to extract Snow Miser's Zone 2
URL? Where did you find the key?</li>
<li>On Snow Miser's Zone 3 page, why is using the same key multiple times
a bad idea?</li>
<li>What was the coding error in Zone 4 of Heat Miser's site that allowed
you to find the URL for Zone 5?</li>
<li>How did you manipulate the cookie to get to Zone 5 of Heat Miser's
Control System?</li>
<li>Please briefly describe the process, steps, and tools you used to
conquer each zone, including all of the flags hidden in the comments
of each zone page.</li>
</ol>
<p>I'll focus on the sixth question, while answering the first questions in
my write up.</p>
<div class="section" id="snow-miser">
<h2><a class="reference external" href="http://snowmiser.counterhack.com/">Snow Miser</a></h2>
<div class="section" id="zone-0">
<h3>Zone 0</h3>
<p>flag: <code>3b5a630fc67251aa5555f4979787c93f</code></p>
<blockquote>
<p>Unlike my brother, my fridged minions (without freakish hair) didn't
mess up and leak our URLs to search engines or have to block them
from the search engines. There is no vulnerability to get to the
next zone and you will not find a vulnerability here. Move along.</p>
<p>Those of you with proper access, the URL you need starts with the
following:</p>
<p>zone-1-D2E31380-50E6-4869-8A85-XXXXXXXXXXXX</p>
</blockquote>
<p>The URL is composed only of digits (0 through 9) and letters (A through
F), which gives us 281.474.976.710.656 possible combinations. We can't
bruteforce so many combinations (plus, it's explicitly stated in the
challenge's rules that bruteforce is disallowed).</p>
<p>Fortunately, Snow Miser tweets this message:</p>
<img alt="snow_miser_tweet_1.png" class="align-center" src="/images/sans-christmas-challenge-2012/snow_miser_tweet_1.png" />
<p>Here's the posted image:</p>
<img alt="snow_miser_glass_reflection.jpg" class="align-center" src="/images/sans-christmas-challenge-2012/snow_miser_glass_reflection.jpg" />
<p>We can see in the something interesting in the screen's reflection in
the glass: the end of the URL we're looking for. With a tool like GIMP,
we can manipulate the image to make it easier to read it:</p>
<img alt="snow_miser_glass_reflection_enhanced.jpg" class="align-center" src="/images/sans-christmas-challenge-2012/snow_miser_glass_reflection_enhanced.jpg" />
<p>Which gives us this final URL:
zone-1-D2E31380-50E6-4869-8A85-F9CDB3AF6226</p>
</div>
<div class="section" id="zone-1">
<h3>Zone 1</h3>
<p>flag: <code>38bef0b61ba8edda377b626fe6708bfa</code></p>
<blockquote>
One of my minions, who has been turned into a snowman, messed up and
changed the URL for Zone 2. If you have access to this level you can
analyze the images and access the next zone.</blockquote>
<p>This message kind of points to some sort of steganography use. This is
where the second question helps us. We know the program steghide was
used on a image. While looking at the website's images, we can see that
they're all PNG, except for <a class="reference external" href="/images/sans-christmas-challenge-2012/off.jpg">this
one</a>,
which is JPG. Since steghide doesn't support PNG, we know that the URL
is hidden in the last image.</p>
<p>Now, we need to find the key, in order to extract the hidden file. If
you open the image in a hexadecimal editor, you'll find an ASCII string,
&quot;IceIceBaby!&quot;. Let's use it as the key:</p>
<div class="highlight"><pre><span class="nv">$ </span>steghide extract -sf off.jpg
Enter passphrase: IceIceBaby!
Extracted data written to tmpfile.txt
<span class="nv">$ </span>cat tmpfile.txt
zone-2-6D46A633-25D7-42C8-AF94-8E786142A3E3
</pre></div>
</div>
<div class="section" id="zone-2">
<h3>Zone 2</h3>
<p>flag: <code>b8231c2bac801b54f732cfbdcd7e47b7</code></p>
<blockquote>
<p>The same minion that messed up the Zone 2 link also messed up the
Zone 3 link. Make sure you use the new link that starts with:</p>
<p>zone-3-EAB6B031-4EFA-49F1-B542-XXXXXXXXXXXX</p>
<p>Please do not tweet the links or parts of the links.</p>
<p>All security issues that used to allow access to the next zone have
been fixed. There is no vulnerability to get to the next zone and
you will not find a vulnerability here. Move along.</p>
</blockquote>
<p>Heat Miser kindly tweets:</p>
<img alt="heat_miser_tweet_2.png" class="align-center" src="/images/sans-christmas-challenge-2012/heat_miser_tweet_2.png" />
<p>You can retrieve Snow Miser's data
<a class="reference external" href="/docs/sans-christmas-challenge-2012/android.data_.tar.gz">here</a>
(sha256:
<code>286387c77b533aae4d605d85a5e74c819f3e0ca7ca42b991ddd29abf9ff5a6b4</code>).</p>
<p>After extracting it, we can use some shell mojo to find files mentioning
the zone 3 URL:</p>
<div class="highlight"><pre><span class="nv">$ </span>tar -xzvf android.data.tgz
<span class="nv">$ </span><span class="nb">cd </span>data
<span class="nv">$ </span>grep -Rn <span class="s2">&quot;zone-3&quot;</span> . 2&gt; /dev/null
Binary file ./data/com.android.browser/cache/browser_state.parcel
concordant
Binary file
./data/com.android.browser/cache/webviewCacheChromium/data_1 concordant
Binary file
./data/com.android.browser/cache/webviewCacheChromium/data_2 concordant
Binary file ./data/com.android.browser/databases/browser2.db
concordant
Binary file ./data/com.android.browser/databases/browser2.db-wal
concordant
</pre></div>
<p>The first file looks is a browser cache file, which may contain the
wanted URL. By reading it, we'll find:
zone-3-EAB6B031-4EFA-49F1-B542-30EBE9EB3962</p>
</div>
<div class="section" id="zone-3">
<h3>Zone 3</h3>
<p>flag: <code>08ba610172aade5d1c8ea738013a2e99</code></p>
<blockquote>
<p>To reduce the impact of URL exposure or modification we have added a
new mechanism to distribute changes to the URL (thanks to that
minion that broke Zones 2+). Those of you with with access to Zone 4
should have received an encryption key. This key can be used to
decrypt the URL for Zone 4. This allows us to securely communicate
it to you without risk of unauthorized access.</p>
<p>To verify your key you can check the previous Zone 4 URL:</p>
<p>zone-4-F7677DA8-3D77-11E2-BB65-E4BF6188709B</p>
<p>20d916c6c29ee53c30ea1effc63b1c72147eb86b998a25c0cf1bf66939e8621b3132d83abb1683df619238</p>
<p>The new Zone 4 encrypted string is:
20d916c6c29ee54343e81ff1b14c1372650cbf19998f51b5c51bf66f49ec62184034a94fc9198fa9179849</p>
</blockquote>
<p>We know the cipher texts both encrypt plain texts starting with zone-4-,
and by looking at them, we can see that they both start with the same
letters. It hints to a bytewise encryption scheme. It turns out that
it's a XOR encryption. The first &quot;oops&quot; here, is that since we're given
a plain text and its cipher text, we can recover the whole key. Indeed,
by the propriety of the XOR operator (here denoted by <span class="formula">⊕</span>):</p>
<ul class="simple">
<li><span class="formula"><i>c</i> = <i>k</i>⊕<i>p</i></span></li>
<li><span class="formula"><i>c</i>⊕<i>p</i> = <i>k</i>⊕<i>p</i>⊕<i>p</i> = <i>k</i></span></li>
</ul>
<p>The second &quot;oops&quot; is using the same key twice, because now that we have
the key, we can decrypt the second cipher text:</p>
<div class="highlight"><pre><span class="c">#!/usr/bin/python</span>
<span class="c">#-*- encoding: Utf-8 -*-</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;usage: </span><span class="si">%s</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">plain1</span><span class="p">,</span> <span class="n">cipher1</span><span class="p">,</span> <span class="n">cipher2</span><span class="p">,</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">plain2</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">plain1</span><span class="p">)):</span>
        <span class="n">plain2</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">plain1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">^</span> <span class="nb">int</span><span class="p">(</span><span class="n">cipher1</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="o">^</span> <span class="nb">int</span><span class="p">(</span><span class="n">cipher2</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span> <span class="mi">16</span><span class="p">))</span>

    <span class="k">print</span> <span class="n">plain2</span>

    <span class="k">return</span> <span class="mi">0</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
<p>Now let's launch this program:</p>
<div class="highlight"><pre><span class="nv">$ </span>ls
xor_encrypt.py
<span class="nv">$ </span>./xor_enc.py zone-4-F7677DA8-3D77-11E2-BB65-E4BF6188709B
20d916c6c29ee53c30ea1effc63b1c72147eb86b998a25c0cf1bf66939e8621b3132d83abb1683df619238
20d916c6c29ee54343e81ff1b14c1372650cbf19998f51b5c51bf66f49ec62184034a94fc9198fa9179849
zone-4-9D469367-B60E-4E08-BDF1-FED7CC74AF33
</pre></div>
</div>
<div class="section" id="zone-4">
<h3>Zone 4</h3>
<p>flag: <code>de32b158f102a60aba7de3ee8d5d265a</code></p>
<blockquote>
<p>Zone 5 requires top security. We are updating the code using svn 1.7
and have implemented One-Time-Password (OTP) functionality to access
Zone 5.</p>
<p>The passwords are in a SHA1 format, so they are unguessable.</p>
</blockquote>
<p>If we look at the source code, we can see that the One Time Password is
sent to the zone 5 URL, so we don't have to look very far to find it.
But if we try to access it directly, we're redirected to a page,
noaccess.php. With this tweet, Heat Miser gives us a big hint:</p>
<img alt="heat_miser_tweet_3.png" class="align-center" src="/images/sans-christmas-challenge-2012/heat_miser_tweet_3.png" />
<p>By looking at <a class="reference external" href="http://pen-testing.sans.org/blog/pen-testing/2012/12/06/all-your-svn-are-belong-to-us">the tutorial he
gives</a>
(see, this meme doesn't get old!) we can get the index page source code:</p>
<div class="highlight"><pre><span class="cp">&lt;?php</span>
    <span class="k">function</span> <span class="nf">generate_otp</span><span class="p">(</span><span class="nv">$time</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$pass</span> <span class="o">=</span> <span class="nb">sha1</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$time</span><span class="s2"> 7998f77a7dc74f182a76219d7ee58db38be3841c&quot;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">(</span><span class="nv">$pass</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">verify_otp</span><span class="p">(</span><span class="nv">$inpass</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// passwords are valid for up to 3 minutes</span>
        <span class="c1">// don&#39;t forget to use the server time (see the noaccess.php page)</span>
        <span class="nv">$validstamps</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;+1 minute&#39;</span><span class="p">)),</span> <span class="c1">// added just in case the time sync is off</span>
            <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i&#39;</span><span class="p">),</span>
            <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;-1 minute&#39;</span><span class="p">)),</span>
            <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;-2 minute&#39;</span><span class="p">)),</span>
        <span class="p">);</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$validstamps</span> <span class="k">as</span> <span class="nv">$stamp</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">strtolower</span><span class="p">(</span><span class="nv">$inpass</span><span class="p">)</span> <span class="o">==</span> <span class="nx">generate_otp</span><span class="p">(</span><span class="nv">$stamp</span><span class="p">))</span>
                <span class="k">return</span> <span class="k">TRUE</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">FALSE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">((</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s1">&#39;otp&#39;</span><span class="p">,</span> <span class="nv">$_POST</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="nx">verify_otp</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;otp&#39;</span><span class="p">]))</span> <span class="o">||</span> <span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s1">&#39;otp&#39;</span><span class="p">,</span> <span class="nv">$_COOKIE</span><span class="p">)</span>
        <span class="o">&amp;&amp;</span> <span class="nx">verify_otp</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;otp&#39;</span><span class="p">])))</span> <span class="p">{</span>
            <span class="nb">setcookie</span><span class="p">(</span><span class="s1">&#39;otp&#39;</span><span class="p">,</span> <span class="nx">generate_otp</span><span class="p">(</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i&#39;</span><span class="p">)));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">header</span><span class="p">(</span> <span class="s1">&#39;Location: noaccess.php&#39;</span> <span class="p">);</span>
        <span class="k">die</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nv">$accessallowed</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span>
    <span class="nv">$zone</span><span class="o">=</span><span class="mi">5</span><span class="p">;</span>
    <span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;../include/template.inc.php&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
<p>Now we know how the One Time Passwords are generated. We just have to
send the correct SHA1 sum, using the server's current time, which we can
find in the source code of the noaccess.php page.</p>
</div>
<div class="section" id="zone-5">
<h3>Zone 5</h3>
<p>flag: <code>3ab1c5fa327343721bc798f116be8dc6</code></p>
<p>Game over for the North Pole.</p>
</div>
</div>
<div class="section" id="heat-miser">
<h2><a class="reference external" href="http://heatmiser.counterhack.com/">Heat Miser</a></h2>
<div class="section" id="id1">
<h3>Zone 0</h3>
<p>flag: <code>1732bcff12e6550ff9ea44d594001418</code></p>
<blockquote>
<p>We had a security concern where the Zone 1 URL ended up in search
engine results. We added a file to prevent the search engines from
caching these pages. The system is now secure an no unauthorized
users have access to the URL.</p>
<p>Don't even try to access the other zones, because you won't be able
to. And if you are helping my brother, GO AWAY!</p>
</blockquote>
<p>The important part here is the file to prevent indexing by search
engines. Heat Miser is talking about the robots.txt file, which tells
search engine crawlers what page they can crawl. By loading this file,
we find the wanted URL: zone-1-E919DBF1-E4FA-4141-97C4-3F38693D2161.</p>
</div>
<div class="section" id="id2">
<h3>Zone 1</h3>
<p>flag: <code>d8c94233daef256c42bb95bd61382e02</code></p>
<blockquote>
We had an issue with Zone 2 and we had to temporarily remove the
link. It is now back and in full operation. We appoligize to those
living in Zone 2 as it may have gotten a tad chilly. Everything is
fully operational now.</blockquote>
<p>Looking at the comment will give you the URL to the next zone:
zone-2-761EBBCF-099F-4DB0-B63F-9ADC61825D49</p>
</div>
<div class="section" id="id3">
<h3>Zone 2</h3>
<p>flag: <code>ef963731de7e886226fe4a6a6c2971f1</code></p>
<blockquote>
We are sorry, but due to the negligence of one of our fiery minions,
we had to change the link for Zone 3. If you should have access then
you should have received an email. The new zone 3 link starts with
zone-3-83FEE8BE-B1C6-4395-A56A-XXXXXXXXXXXX.</blockquote>
<p>There are 281,474,976,710,656 possibilities for the last set of numbers,
so don't bother brute forcing it. Once again, we have an incomplete URL.
But Heat Miser tweets this message:</p>
<img alt="heat_miser_tweet_1.png" class="align-center" src="/images/sans-christmas-challenge-2012/heat_miser_tweet_1.png" />
<p>The tweeted image is:</p>
<img alt="heat_miser_transparent_terminal.png" class="align-center" src="/images/sans-christmas-challenge-2012/heat_miser_transparent_terminal.png" />
<p>And, as Snow Miser says:</p>
<img alt="snow_miser_tweet_2.png" class="align-center" src="/images/sans-christmas-challenge-2012/snow_miser_tweet_2.png" />
<p>This is looks just like the first level of Snow Miser. Using GIMP, we
can make the end of the URL appear:</p>
<img alt="heat_miser_transparent_terminal_enhanced.png" class="align-center" src="/images/sans-christmas-challenge-2012/heat_miser_transparent_terminal_enhanced.png" />
<p>Which gives us the URL: zone-3-83FEE8BE-B1C6-4395-A56A-BF933FC85254</p>
</div>
<div class="section" id="id4">
<h3>Zone 3</h3>
<p>flag: <code>0d524fb8d8f9f88eb9da5b286661a824</code></p>
<blockquote>
<p>We added a new security mechanism to Zone 4 so it won't matter if
SOMEONE LEAKS IT AGAIN!</p>
<p>Zone 4 (zone-4-0F2EA639-19BF-40DD-A38D-635E1344C02B)</p>
</blockquote>
<p>We can directly access zone 4, since Heat Miser posts a link to it. But
when we click it, we're redirected to another page, noaccess.php. The
hint comes from a tweet from Snow Miser:</p>
<img alt="snow_miser_tweet_3.png" class="align-center" src="/images/sans-christmas-challenge-2012/snow_miser_tweet_3.png" />
<p>The tweeted image is from <a class="reference external" href="http://knowyourmeme.com/memes/the-most-interesting-man-in-the-world">the most interesting man in the
world</a>:</p>
<img alt="snow_miser_most_interesting_man.jpg" class="align-center" src="/images/sans-christmas-challenge-2012/snow_miser_most_interesting_man.jpg" />
<p>Heat Miser redirects us, using a <code>header(&quot;location: new_url&quot;);</code>, but
forgets to use the <code>exit</code> function. It
means that the rest of the page is executed, then sent to our browser,
with a Location header, which our browser follows. But if we use a
client which does not follow redirection, we can recover the first page.</p>
<div class="highlight"><pre><span class="nv">$ </span>curl <span class="s2">&quot;http://heatmiser.counterhack.com/zone-4-0F2EA639-19BF-40DD-A38D-635E1344C02B/&quot;</span> <span class="p">|</span> grep <span class="s2">&quot;zone-5&quot;</span>
Link to &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;/zone-5-15614E3A-CEA7-4A28-A85A-D688CC418287/&quot;</span>&gt;Zone 5&lt;/a&gt;
</pre></div>
</div>
<div class="section" id="id5">
<h3>Zone 4</h3>
<p>flag: <code>e3ae414e6d428c3b0c7cff03783e305f</code></p>
<p>Okay, we have the URL to zone 5, but when we try to access it directly,
we're redirected again to noaccess.php. To give us a clue about where to
look, Snow Miser tweets:</p>
<img alt="snow_miser_tweet_4.png" class="align-center" src="/images/sans-christmas-challenge-2012/snow_miser_tweet_4.png" />
<p>So, we know that we should look at the cookies. There's only one:
<code>UID=b8c37e33defde51cf91e1e03e51657da</code>. A 32 byte hex string:
it looks like a MD5 hash. If we reverse it (using online tools, or
programs like John The Ripper), we find that it's the hash of the string
&quot;1001&quot;, which explains Snow Miser's tweet.</p>
<p>A value like 1001, and a name like UID indicates that this hash
corresponds to a user ID, and an unprivileged one, since he can't access
zone 5. The first value I tried was a UID of 0 (which means a MD5 of
<code>cfcd208495d565ef66e7dff9f98764da</code>) since it's root's UID on
Linux, but it turned out that the correct value was 1 (which means a MD5
<code>c4ca4238a0b923820dcc509a6f75849b</code>). We modify the cookie's
value, and we reload the page to access zone 5.</p>
</div>
<div class="section" id="id6">
<h3>Zone 5</h3>
<p>flag: <code>f478c549e37fa33467241d847f862e6f</code></p>
<p>Game over for Southtown.</p>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>I'll give it to you: this challenge wasn't really complicated. Mostly
because the first zones of both controllers where kinda easy, but also
because of all the hints in the tweets. Yet, I'm still glad I did it
because:</p>
<ul class="simple">
<li>I learned the SVN vulnerability</li>
<li>I learned common mistakes, like forgetting <code>exit</code> after a
redirect</li>
<li>I added new tricks to my &quot;to-do&quot; list when looking for
vulnerability/information disclosure (like the use of steghide, or
looking at files in docs leaks)</li>
</ul>
<p>I hoped this wasn't too long, and that you learned something from it. I
wish you a merry Christmas, a happy new year, and lots of pentesting ;)</p>
<p>Cheers.</p>
</div>

  </div>
  <div class="tag-cloud">
    <p>
    </p>
  </div>
</article>

    <footer>
<p>
  &copy; Yannick Méheut 2016 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "SANS Christmas Challenge 2012",
  "headline": "SANS Christmas Challenge 2012",
  "datePublished": "2013-01-07 12:20:00+01:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "useless",
    "url": "../../../../../author/useless.html"
  },
  "image": "/images/useless_profile_pic.jpg",
  "url": "../../../../../posts/2013/01/07/sans-christmas-challenge-2012/",
  "description": "During December, SANS posted a Christmas challenge based on a Christmas story. This year, Santa is sad because he feels that nobody believes in him anymore, so he decides to cancel Christmas. Mrs. Claus wants to cheer her husband up, in order not to let children down, but her reindeer ..."
}
</script></body>
</html>